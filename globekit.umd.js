function _loadWasmModule(t,e,n){var r=null;if("undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node)r=Buffer.from(e,"base64");else{var i=globalThis.atob(e),o=i.length;r=new Uint8Array(new ArrayBuffer(o));for(var a=0;a<o;a++)r[a]=i.charCodeAt(a)}if(n&&!t)return WebAssembly.instantiate(r,n);if(n||t){var s=new WebAssembly.Module(r);return n?new WebAssembly.Instance(s,n):s}return WebAssembly.compile(r)}!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).globekitjs={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?f(t):e}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=l(t);if(e){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}function d(t,e,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}
/* @license twgl.js 4.15.2 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
  Available via the MIT license.
  see: http://github.com/greggman/twgl.js for details */()}function v(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _=Float32Array;function x(t,e,n){var r=new _(3);return t&&(r[0]=t),e&&(r[1]=e),n&&(r[2]=n),r}function b(t,e,n){return(n=n||new _(3))[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function w(t,e,n){n=n||new _(3);var r=t[2]*e[0]-t[0]*e[2],i=t[0]*e[1]-t[1]*e[0];return n[0]=t[1]*e[2]-t[2]*e[1],n[1]=r,n[2]=i,n}function A(t,e){e=e||new _(3);var n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=Math.sqrt(n);return r>1e-5?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=0,e[1]=0,e[2]=0),e}var C,T,I,P=Float32Array;function S(t,e){return(e=e||new P(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function E(t){return(t=t||new P(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e){e=e||new P(16);var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],m=t[10],h=t[11],d=t[12],p=t[13],v=t[14],y=t[15],g=m*y,_=v*h,x=u*y,b=v*l,w=u*h,A=m*l,C=i*y,T=v*o,I=i*h,S=m*o,E=i*l,L=u*o,M=c*p,z=d*f,F=a*p,R=d*s,D=a*f,k=c*s,O=n*p,j=d*r,B=n*f,G=c*r,N=n*s,U=a*r,V=g*s+b*f+w*p-(_*s+x*f+A*p),W=_*r+C*f+S*p-(g*r+T*f+I*p),Y=x*r+T*s+E*p-(b*r+C*s+L*p),H=A*r+I*s+L*f-(w*r+S*s+E*f),X=1/(n*V+a*W+c*Y+d*H);return e[0]=X*V,e[1]=X*W,e[2]=X*Y,e[3]=X*H,e[4]=X*(_*a+x*c+A*d-(g*a+b*c+w*d)),e[5]=X*(g*n+T*c+I*d-(_*n+C*c+S*d)),e[6]=X*(b*n+C*a+L*d-(x*n+T*a+E*d)),e[7]=X*(w*n+S*a+E*c-(A*n+I*a+L*c)),e[8]=X*(M*l+R*h+D*y-(z*l+F*h+k*y)),e[9]=X*(z*o+O*h+G*y-(M*o+j*h+B*y)),e[10]=X*(F*o+j*l+N*y-(R*o+O*l+U*y)),e[11]=X*(k*o+B*l+U*h-(D*o+G*l+N*h)),e[12]=X*(F*m+k*v+z*u-(D*v+M*u+R*m)),e[13]=X*(B*v+M*i+j*m-(O*m+G*v+z*i)),e[14]=X*(O*u+U*v+R*i-(N*v+F*i+j*u)),e[15]=X*(N*m+D*i+G*u-(B*u+U*m+k*i)),e}function M(t,e,n){n=n||x();var r=e[0],i=e[1],o=e[2],a=r*t[3]+i*t[7]+o*t[11]+t[15];return n[0]=(r*t[0]+i*t[4]+o*t[8]+t[12])/a,n[1]=(r*t[1]+i*t[5]+o*t[9]+t[13])/a,n[2]=(r*t[2]+i*t[6]+o*t[10]+t[14])/a,n}function z(t,e,n){n=n||x();var r=e[0],i=e[1],o=e[2];return n[0]=r*t[0]+i*t[4]+o*t[8],n[1]=r*t[1]+i*t[5]+o*t[9],n[2]=r*t[2]+i*t[6]+o*t[10],n}var F=Object.freeze({__proto__:null,axisRotate:function(t,e,n,r){r=r||new P(16);var i=e[0],o=e[1],a=e[2],s=Math.sqrt(i*i+o*o+a*a),u=(i/=s)*i,l=(o/=s)*o,c=(a/=s)*a,f=Math.cos(n),m=Math.sin(n),h=1-f,d=u+(1-u)*f,p=i*o*h+a*m,v=i*a*h-o*m,y=i*o*h-a*m,g=l+(1-l)*f,_=o*a*h+i*m,x=i*a*h+o*m,b=o*a*h-i*m,w=c+(1-c)*f,A=t[0],C=t[1],T=t[2],I=t[3],S=t[4],E=t[5],L=t[6],M=t[7],z=t[8],F=t[9],R=t[10],D=t[11];return r[0]=d*A+p*S+v*z,r[1]=d*C+p*E+v*F,r[2]=d*T+p*L+v*R,r[3]=d*I+p*M+v*D,r[4]=y*A+g*S+_*z,r[5]=y*C+g*E+_*F,r[6]=y*T+g*L+_*R,r[7]=y*I+g*M+_*D,r[8]=x*A+b*S+w*z,r[9]=x*C+b*E+w*F,r[10]=x*T+b*L+w*R,r[11]=x*I+b*M+w*D,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},axisRotation:function(t,e,n){n=n||new P(16);var r=t[0],i=t[1],o=t[2],a=Math.sqrt(r*r+i*i+o*o),s=(r/=a)*r,u=(i/=a)*i,l=(o/=a)*o,c=Math.cos(e),f=Math.sin(e),m=1-c;return n[0]=s+(1-s)*c,n[1]=r*i*m+o*f,n[2]=r*o*m-i*f,n[3]=0,n[4]=r*i*m-o*f,n[5]=u+(1-u)*c,n[6]=i*o*m+r*f,n[7]=0,n[8]=r*o*m+i*f,n[9]=i*o*m-r*f,n[10]=l+(1-l)*c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},copy:S,frustum:function(t,e,n,r,i,o,a){var s=e-t,u=r-n,l=i-o;return(a=a||new P(16))[0]=2*i/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/u,a[6]=0,a[7]=0,a[8]=(t+e)/s,a[9]=(r+n)/u,a[10]=o/l,a[11]=-1,a[12]=0,a[13]=0,a[14]=i*o/l,a[15]=0,a},getAxis:function(t,e,n){var r=4*e;return(n=n||x())[0]=t[r+0],n[1]=t[r+1],n[2]=t[r+2],n},getTranslation:function(t,e){return(e=e||x())[0]=t[12],e[1]=t[13],e[2]=t[14],e},identity:E,inverse:L,lookAt:function(t,e,n,r){return r=r||new P(16),C=C||x(),T=T||x(),A(function(t,e,n){return(n=n||new _(3))[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}(t,e,I=I||x()),I),A(w(n,I,C),C),A(w(I,C,T),T),r[0]=C[0],r[1]=C[1],r[2]=C[2],r[3]=0,r[4]=T[0],r[5]=T[1],r[6]=T[2],r[7]=0,r[8]=I[0],r[9]=I[1],r[10]=I[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},multiply:function(t,e,n){n=n||new P(16);var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],m=t[9],h=t[10],d=t[11],p=t[12],v=t[13],y=t[14],g=t[15],_=e[0],x=e[1],b=e[2],w=e[3],A=e[4],C=e[5],T=e[6],I=e[7],S=e[8],E=e[9],L=e[10],M=e[11],z=e[12],F=e[13],R=e[14],D=e[15];return n[0]=r*_+s*x+f*b+p*w,n[1]=i*_+u*x+m*b+v*w,n[2]=o*_+l*x+h*b+y*w,n[3]=a*_+c*x+d*b+g*w,n[4]=r*A+s*C+f*T+p*I,n[5]=i*A+u*C+m*T+v*I,n[6]=o*A+l*C+h*T+y*I,n[7]=a*A+c*C+d*T+g*I,n[8]=r*S+s*E+f*L+p*M,n[9]=i*S+u*E+m*L+v*M,n[10]=o*S+l*E+h*L+y*M,n[11]=a*S+c*E+d*L+g*M,n[12]=r*z+s*F+f*R+p*D,n[13]=i*z+u*F+m*R+v*D,n[14]=o*z+l*F+h*R+y*D,n[15]=a*z+c*F+d*R+g*D,n},negate:function(t,e){return(e=e||new P(16))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},ortho:function(t,e,n,r,i,o,a){return(a=a||new P(16))[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(r-n),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2/(i-o),a[11]=0,a[12]=(e+t)/(t-e),a[13]=(r+n)/(n-r),a[14]=(o+i)/(i-o),a[15]=1,a},perspective:function(t,e,n,r,i){i=i||new P(16);var o=Math.tan(.5*Math.PI-.5*t),a=1/(n-r);return i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(n+r)*a,i[11]=-1,i[12]=0,i[13]=0,i[14]=n*r*a*2,i[15]=0,i},rotateX:function(t,e,n){n=n||new P(16);var r=t[4],i=t[5],o=t[6],a=t[7],s=t[8],u=t[9],l=t[10],c=t[11],f=Math.cos(e),m=Math.sin(e);return n[4]=f*r+m*s,n[5]=f*i+m*u,n[6]=f*o+m*l,n[7]=f*a+m*c,n[8]=f*s-m*r,n[9]=f*u-m*i,n[10]=f*l-m*o,n[11]=f*c-m*a,t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateY:function(t,e,n){n=n||new P(16);var r=t[0],i=t[1],o=t[2],a=t[3],s=t[8],u=t[9],l=t[10],c=t[11],f=Math.cos(e),m=Math.sin(e);return n[0]=f*r-m*s,n[1]=f*i-m*u,n[2]=f*o-m*l,n[3]=f*a-m*c,n[8]=f*s+m*r,n[9]=f*u+m*i,n[10]=f*l+m*o,n[11]=f*c+m*a,t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateZ:function(t,e,n){n=n||new P(16);var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=Math.cos(e),m=Math.sin(e);return n[0]=f*r+m*s,n[1]=f*i+m*u,n[2]=f*o+m*l,n[3]=f*a+m*c,n[4]=f*s-m*r,n[5]=f*u-m*i,n[6]=f*l-m*o,n[7]=f*c-m*a,t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotationX:function(t,e){e=e||new P(16);var n=Math.cos(t),r=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationY:function(t,e){e=e||new P(16);var n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationZ:function(t,e){e=e||new P(16);var n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},scale:function(t,e,n){n=n||new P(16);var r=e[0],i=e[1],o=e[2];return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=r*t[3],n[4]=i*t[4],n[5]=i*t[5],n[6]=i*t[6],n[7]=i*t[7],n[8]=o*t[8],n[9]=o*t[9],n[10]=o*t[10],n[11]=o*t[11],t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},scaling:function(t,e){return(e=e||new P(16))[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},setAxis:function(t,e,n,r){r!==t&&(r=S(t,r));var i=4*n;return r[i+0]=e[0],r[i+1]=e[1],r[i+2]=e[2],r},setDefaultType:function(t){var e=P;return P=t,e},setTranslation:function(t,e,n){return t!==(n=n||E())&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11]),n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},transformDirection:z,transformNormal:function(t,e,n){n=n||x();var r=L(t),i=e[0],o=e[1],a=e[2];return n[0]=i*r[0]+o*r[1]+a*r[2],n[1]=i*r[4]+o*r[5]+a*r[6],n[2]=i*r[8]+o*r[9]+a*r[10],n},transformPoint:M,translate:function(t,e,n){n=n||new P(16);var r=e[0],i=e[1],o=e[2],a=t[0],s=t[1],u=t[2],l=t[3],c=t[4],f=t[5],m=t[6],h=t[7],d=t[8],p=t[9],v=t[10],y=t[11],g=t[12],_=t[13],x=t[14],b=t[15];return t!==n&&(n[0]=a,n[1]=s,n[2]=u,n[3]=l,n[4]=c,n[5]=f,n[6]=m,n[7]=h,n[8]=d,n[9]=p,n[10]=v,n[11]=y),n[12]=a*r+c*i+d*o+g,n[13]=s*r+f*i+p*o+_,n[14]=u*r+m*i+v*o+x,n[15]=l*r+h*i+y*o+b,n},translation:function(t,e){return(e=e||new P(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},transpose:function(t,e){var n;if((e=e||new P(16))===t)return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,e;var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],m=t[9],h=t[10],d=t[11],p=t[12],v=t[13],y=t[14],g=t[15];return e[0]=r,e[1]=s,e[2]=f,e[3]=p,e[4]=i,e[5]=u,e[6]=m,e[7]=v,e[8]=o,e[9]=l,e[10]=h,e[11]=y,e[12]=a,e[13]=c,e[14]=d,e[15]=g,e}}),R={},D=R;function k(t){if(t instanceof Int8Array)return 5120;if(t instanceof Uint8Array)return 5121;if(t instanceof Uint8ClampedArray)return 5121;if(t instanceof Int16Array)return 5122;if(t instanceof Uint16Array)return 5123;if(t instanceof Int32Array)return 5124;if(t instanceof Uint32Array)return 5125;if(t instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}D[5120]=Int8Array,D[5121]=Uint8Array,D[5122]=Int16Array,D[5123]=Uint16Array,D[5124]=Int32Array,D[5125]=Uint32Array,D[5126]=Float32Array,D[32819]=Uint16Array,D[32820]=Uint16Array,D[33635]=Uint16Array,D[5131]=Uint16Array,D[33640]=Uint32Array,D[35899]=Uint32Array,D[35902]=Uint32Array,D[36269]=Uint32Array,D[34042]=Uint32Array;var O="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function j(){var t;(t=console).error.apply(t,arguments)}function B(){var t;(t=console).warn.apply(t,arguments)}function G(t,e){return"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture}var N="";function U(t,e,n,r,i){t.bindBuffer(e,n),t.bufferData(e,r,i||35044)}function V(t,e,n,r){if(i=e,"undefined"!=typeof WebGLBuffer&&i instanceof WebGLBuffer)return e;var i;n=n||34962;var o=t.createBuffer();return U(t,n,o,e,r),o}function W(t){return"indices"===t}function Y(t){return t.length?t:t.data}var H=/coord|texture/i,X=/color|colour/i;function q(t,e){var n;if(e%(n=H.test(t)?2:X.test(t)?4:3)>0)throw new Error("Can not guess numComponents for attribute '".concat(t,"'. Tried ").concat(n," but ").concat(e," values is not evenly divisible by ").concat(n,". You should specify it."));return n}function K(t,e){return t.numComponents||t.size||q(e,Y(t).length)}function Z(t,e){if(O(t))return t;if(O(t.data))return t.data;Array.isArray(t)&&(t={data:t});var n=t.type;return n||(n=W(e)?Uint16Array:Float32Array),new n(t.data)}function J(t,e){var n={};return Object.keys(e).forEach((function(r){if(!W(r)){var i=e[r],o=i.attrib||i.name||i.attribName||N+r;if(i.value){if(!Array.isArray(i.value)&&!O(i.value))throw new Error("array.value is not array or typedarray");n[o]={value:i.value}}else{var a,s,u,l;if(i.buffer&&i.buffer instanceof WebGLBuffer)a=i.buffer,l=i.numComponents||i.size,s=i.type,u=i.normalize;else if("number"==typeof i||"number"==typeof i.data){var c=i.data||i,f=i.type||Float32Array,m=c*f.BYTES_PER_ELEMENT;s=function(t){if(t===Int8Array)return 5120;if(t===Uint8Array)return 5121;if(t===Uint8ClampedArray)return 5121;if(t===Int16Array)return 5122;if(t===Uint16Array)return 5123;if(t===Int32Array)return 5124;if(t===Uint32Array)return 5125;if(t===Float32Array)return 5126;throw new Error("unsupported typed array type")}(f),u=void 0!==i.normalize?i.normalize:(d=f)===Int8Array||d===Uint8Array,l=i.numComponents||i.size||q(r,c),a=t.createBuffer(),t.bindBuffer(34962,a),t.bufferData(34962,m,i.drawType||35044)}else{var h=Z(i,r);a=V(t,h,void 0,i.drawType),s=k(h),u=void 0!==i.normalize?i.normalize:function(t){return t instanceof Int8Array||t instanceof Uint8Array}(h),l=K(i,r)}n[o]={buffer:a,numComponents:l,type:s,normalize:u,stride:i.stride||0,offset:i.offset||0,divisor:void 0===i.divisor?void 0:i.divisor,drawType:i.drawType}}}var d})),t.bindBuffer(34962,null),n}var Q=["position","positions","a_position"];function $(t,e,n){var r=J(t,e),i=Object.assign({},n||{});i.attribs=Object.assign({},n?n.attribs:{},r);var o=e.indices;if(o){var a=Z(o,"indices");i.indices=V(t,a,34963),i.numElements=a.length,i.elementType=k(a)}else i.numElements||(i.numElements=function(t,e){var n,r;for(r=0;r<Q.length&&!((n=Q[r])in e)&&!((n=N+n)in e);++r);r===Q.length&&(n=Object.keys(e)[0]);var i=e[n];t.bindBuffer(34962,i.buffer);var o=t.getBufferParameter(34962,34660);t.bindBuffer(34962,null);var a,s=o/(5120===(a=i.type)||5121===a?1:5122===a||5123===a?2:5124===a||5125===a||5126===a?4:0),u=i.numComponents||i.size,l=s/u;if(l%1!=0)throw new Error("numComponents ".concat(u," not correct for length ").concat(length));return l}(t,i.attribs));return i}function tt(t,e){var n={};return Object.keys(e).forEach((function(r){n[r]=function(t,e,n){var r="indices"===n?34963:34962;return V(t,Z(e,n),r)}(t,e[r],r)})),e.indices?(n.numElements=e.indices.length,n.elementType=k(Z(e.indices))):n.numElements=function(t){var e,n;for(n=0;n<Q.length&&!((e=Q[n])in t);++n);n===Q.length&&(e=Object.keys(t)[0]);var r=t[e],i=Y(r).length,o=K(r,e),a=i/o;if(i%o>0)throw new Error("numComponents ".concat(o," not correct for length ").concat(i));return a}(e),n}var et=Y,nt=K;function rt(t,e){var n=0;return t.push=function(){for(var e=0;e<arguments.length;++e){var r=arguments[e];if(r instanceof Array||O(r))for(var i=0;i<r.length;++i)t[n++]=r[i];else t[n++]=r}},t.reset=function(t){n=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}function it(t,e,n){return rt(new(n||Float32Array)(t*e),t)}function ot(t){return"indices"!==t}function at(t,e,n){for(var r=t.length,i=new Float32Array(3),o=0;o<r;o+=3)n(e,[t[o],t[o+1],t[o+2]],i),t[o]=i[0],t[o+1]=i[1],t[o+2]=i[2]}function st(t,e,n){n=n||x();var r=e[0],i=e[1],o=e[2];return n[0]=r*t[0]+i*t[1]+o*t[2],n[1]=r*t[4]+i*t[5]+o*t[6],n[2]=r*t[8]+i*t[9]+o*t[10],n}function ut(t,e){return at(t,e,z),t}function lt(t,e){return at(t,L(e),st),t}function ct(t,e){return at(t,e,M),t}function ft(t,e){return Object.keys(t).forEach((function(n){var r=t[n];n.indexOf("pos")>=0?ct(r,e):n.indexOf("tan")>=0||n.indexOf("binorm")>=0?ut(r,e):n.indexOf("norm")>=0&&lt(r,e)})),t}function mt(t,e,n){return t=t||2,{position:{numComponents:2,data:[(e=e||0)+-1*(t*=.5),(n=n||0)+-1*t,e+1*t,n+-1*t,e+-1*t,n+1*t,e+1*t,n+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function ht(t,e,n,r,i){t=t||1,e=e||1,n=n||1,r=r||1,i=i||E();for(var o=(n+1)*(r+1),a=it(3,o),s=it(3,o),u=it(2,o),l=0;l<=r;l++)for(var c=0;c<=n;c++){var f=c/n,m=l/r;a.push(t*f-.5*t,0,e*m-.5*e),s.push(0,1,0),u.push(f,m)}for(var h=n+1,d=it(3,n*r*2,Uint16Array),p=0;p<r;p++)for(var v=0;v<n;v++)d.push((p+0)*h+v,(p+1)*h+v,(p+0)*h+v+1),d.push((p+1)*h+v,(p+1)*h+v+1,(p+0)*h+v+1);return ft({position:a,normal:s,texcoord:u,indices:d},i)}function dt(t,e,n,r,i,o,a){if(e<=0||n<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");r=r||0,o=o||0;for(var s=(i=i||Math.PI)-r,u=(a=a||2*Math.PI)-o,l=(e+1)*(n+1),c=it(3,l),f=it(3,l),m=it(2,l),h=it(3,l),d=it(3,l),p=0;p<=n;p++)for(var v=0;v<=e;v++){var y=v/e,g=p/n,_=u*y+o,x=s*g+r,b=Math.sin(_),w=Math.cos(_),A=Math.sin(x),C=w*A,T=Math.cos(x),I=b*A,P=u*((v+1)/e)+o,S=s*(p/n)+r,E=Math.sin(P),L=Math.cos(P),M=Math.sin(S),z=Math.cos(S);h.push(L*M-C,z-T,E*M-I);var F=u*(v/e)+o,R=s*((p+1)/n)+r,D=Math.sin(F),k=Math.cos(F),O=Math.sin(R),j=k*O-C,B=Math.cos(R)-T,G=D*O-I;c.push(t*C,t*T,t*I),f.push(C,T,I),m.push(1-y,g),d.push(j,B,G)}for(var N=e+1,U=it(3,e*n*2,Uint16Array),V=0;V<e;V++)for(var W=0;W<n;W++)U.push((W+0)*N+V,(W+0)*N+V+1,(W+1)*N+V),U.push((W+1)*N+V,(W+0)*N+V+1,(W+1)*N+V+1);return{position:c,normal:f,texcoord:m,indices:U,tangent:h,bitangent:d}}var pt=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function vt(t){for(var e=(t=t||1)/2,n=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],o=it(3,24),a=it(3,24),s=it(2,24),u=it(3,12,Uint16Array),l=0;l<6;++l){for(var c=pt[l],f=0;f<4;++f){var m=n[c[f]],h=r[l],d=i[f];o.push(m),a.push(h),s.push(d)}var p=4*l;u.push(p+0,p+1,p+2),u.push(p+0,p+2,p+3)}return{position:o,normal:a,texcoord:s,indices:u}}function yt(t,e,n,r,i,o,a){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(i<1)throw new Error("verticalSubdivisions must be 1 or greater");for(var s=void 0===o||o,u=void 0===a||a,l=(s?2:0)+(u?2:0),c=(r+1)*(i+1+l),f=it(3,c),m=it(3,c),h=it(2,c),d=it(3,r*(i+l/2)*2,Uint16Array),p=r+1,v=Math.atan2(t-e,n),y=Math.cos(v),g=Math.sin(v),_=i+(u?2:0),x=s?-2:0;x<=_;++x){var b=x/i,w=n*b,A=void 0;x<0?(w=0,b=1,A=t):x>i?(w=n,b=1,A=e):A=t+x/i*(e-t),-2!==x&&x!==i+2||(A=0,b=0),w-=n/2;for(var C=0;C<p;++C){var T=Math.sin(C*Math.PI*2/r),I=Math.cos(C*Math.PI*2/r);f.push(T*A,w,I*A),x<0?m.push(0,-1,0):x>i?m.push(0,1,0):0===A?m.push(0,0,0):m.push(T*y,g,I*y),h.push(C/r,1-b)}}for(var P=0;P<i+l;++P)if(!(1===P&&s||P===i+l-2&&u))for(var S=0;S<r;++S)d.push(p*(P+0)+0+S,p*(P+0)+1+S,p*(P+1)+1+S),d.push(p*(P+0)+0+S,p*(P+1)+1+S,p*(P+1)+0+S);return{position:f,normal:m,texcoord:h,indices:d}}function gt(t,e){e=e||[];for(var n=[],r=0;r<t.length;r+=4){var i=t[r],o=t.slice(r+1,r+4);o.push.apply(o,e);for(var a=0;a<i;++a)n.push.apply(n,o)}return n}function _t(){var t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=gt([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=gt([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),r=t.length/3,i={position:it(3,r),texcoord:it(2,r),normal:it(3,r),color:it(4,r,Uint8Array),indices:it(3,r/3,Uint16Array)};i.position.push(t),i.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),i.normal.push(e),i.color.push(n);for(var o=0;o<r;++o)i.indices.push(o);return i}function xt(t,e,n,r,i,o,a){if(i<=0)throw new Error("subdivisionDown must be > 0");var s=(a=a||1)-(o=o||0),u=2*(i+1)*4,l=it(3,u),c=it(3,u),f=it(2,u);function m(t,e,n){return t+(e-t)*n}function h(e,n,a,u,h,d){for(var p=0;p<=i;p++){var v=n/1,y=p/i,g=2*(v-.5),x=(o+y*s)*Math.PI,w=Math.sin(x),A=Math.cos(x),C=m(t,e,w),T=g*r,I=A*t,P=w*C;l.push(T,I,P);var S=b((E=[0,w,A],L=a,(M=(M=void 0)||new _(3))[0]=E[0]*L[0],M[1]=E[1]*L[1],M[2]=E[2]*L[2],M),u);c.push(S),f.push(v*h+d,y)}var E,L,M}for(var d=0;d<2;d++){var p=2*(d/1-.5);h(e,d,[1,1,1],[0,0,0],1,0),h(e,d,[0,0,0],[p,0,0],0,0),h(n,d,[1,1,1],[0,0,0],1,0),h(n,d,[0,0,0],[p,0,0],0,1)}var v=it(3,2*i*4,Uint16Array);function y(t,e){for(var n=0;n<i;++n)v.push(t+n+0,t+n+1,e+n+0),v.push(t+n+1,e+n+1,e+n+0)}var g=i+1;return y(0*g,4*g),y(5*g,7*g),y(6*g,2*g),y(3*g,1*g),{position:l,normal:c,texcoord:f,indices:v}}function bt(t,e,n,r,i,o){return yt(t,t,e,n,r,i,o)}function wt(t,e,n,r,i,o){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<3)throw new Error("verticalSubdivisions must be 3 or greater");i=i||0;for(var a=(o=o||2*Math.PI)-i,s=n+1,u=r+1,l=s*u,c=it(3,l),f=it(3,l),m=it(2,l),h=it(3,n*r*2,Uint16Array),d=0;d<u;++d)for(var p=d/r,v=p*Math.PI*2,y=Math.sin(v),g=t+y*e,_=Math.cos(v),x=_*e,b=0;b<s;++b){var w=b/n,A=i+w*a,C=Math.sin(A),T=Math.cos(A),I=C*g,P=T*g,S=C*y,E=T*y;c.push(I,x,P),f.push(S,_,E),m.push(w,1-p)}for(var L=0;L<r;++L)for(var M=0;M<n;++M){var z=1+M,F=1+L;h.push(s*L+M,s*F+M,s*L+z),h.push(s*F+M,s*F+z,s*L+z)}return{position:c,normal:f,texcoord:m,indices:h}}function At(t,e,n,r,i){if(e<3)throw new Error("divisions must be at least 3");i=i||1,r=r||0;for(var o=(e+1)*((n=n||1)+1),a=it(3,o),s=it(3,o),u=it(2,o),l=it(3,n*e*2,Uint16Array),c=0,f=t-r,m=e+1,h=0;h<=n;++h){for(var d=r+f*Math.pow(h/n,i),p=0;p<=e;++p){var v=2*Math.PI*p/e,y=d*Math.cos(v),g=d*Math.sin(v);if(a.push(y,0,g),s.push(0,1,0),u.push(1-p/e,h/n),h>0&&p!==e){var _=c+(p+1),x=c+p,b=c+p-m,w=c+(p+1)-m;l.push(_,x,b),l.push(_,b,w)}}c+=e+1}return{position:a,normal:s,texcoord:u,indices:l}}function Ct(t){return function(e){var n=t.apply(this,Array.prototype.slice.call(arguments,1));return tt(e,n)}}function Tt(t){return function(e){var n=t.apply(null,Array.prototype.slice.call(arguments,1));return $(e,n)}}var It=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function Pt(t,e,n,r){r=r||0;for(var i=t.length,o=0;o<i;++o)e[n+o]=t[o]+r}function St(t,e){var n,r,i=et(t),o=new i.constructor(e),a=o;return i.numComponents&&i.numElements&&rt(o,i.numComponents),t.data&&(n=t,r=a={data:o},It.forEach((function(t){var e=n[t];void 0!==e&&(r[t]=e)}))),a}var Et=Tt(_t),Lt=Ct(_t),Mt=Tt(vt),zt=Ct(vt),Ft=Tt(ht),Rt=Ct(ht),Dt=Tt(dt),kt=Ct(dt),Ot=Tt(yt),jt=Ct(yt),Bt=Tt(mt),Gt=Ct(mt),Nt=Tt(xt),Ut=Ct(xt),Vt=Tt(bt),Wt=Ct(bt),Yt=Tt(wt),Ht=Ct(wt),Xt=Tt(At),qt=Ct(At),Kt=Nt,Zt=Ut,Jt=xt,Qt=Object.freeze({__proto__:null,create3DFBufferInfo:Et,create3DFBuffers:Lt,create3DFVertices:_t,createAugmentedTypedArray:it,createCubeBufferInfo:Mt,createCubeBuffers:zt,createCubeVertices:vt,createPlaneBufferInfo:Ft,createPlaneBuffers:Rt,createPlaneVertices:ht,createSphereBufferInfo:Dt,createSphereBuffers:kt,createSphereVertices:dt,createTruncatedConeBufferInfo:Ot,createTruncatedConeBuffers:jt,createTruncatedConeVertices:yt,createXYQuadBufferInfo:Bt,createXYQuadBuffers:Gt,createXYQuadVertices:mt,createCresentBufferInfo:Kt,createCresentBuffers:Zt,createCresentVertices:Jt,createCrescentBufferInfo:Nt,createCrescentBuffers:Ut,createCrescentVertices:xt,createCylinderBufferInfo:Vt,createCylinderBuffers:Wt,createCylinderVertices:bt,createTorusBufferInfo:Yt,createTorusBuffers:Ht,createTorusVertices:wt,createDiscBufferInfo:Xt,createDiscBuffers:qt,createDiscVertices:At,deindexVertices:function(t){var e=t.indices,n={},r=e.length;return Object.keys(t).filter(ot).forEach((function(i){for(var o=t[i],a=o.numComponents,s=it(a,r,o.constructor),u=0;u<r;++u)for(var l=e[u]*a,c=0;c<a;++c)s.push(o[l+c]);n[i]=s})),n},flattenNormals:function(t){if(t.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");for(var e=t.normal,n=e.length,r=0;r<n;r+=9){var i=e[r+0],o=e[r+1],a=e[r+2],s=e[r+3],u=e[r+4],l=e[r+5],c=i+s+e[r+6],f=o+u+e[r+7],m=a+l+e[r+8],h=Math.sqrt(c*c+f*f+m*m);c/=h,f/=h,m/=h,e[r+0]=c,e[r+1]=f,e[r+2]=m,e[r+3]=c,e[r+4]=f,e[r+5]=m,e[r+6]=c,e[r+7]=f,e[r+8]=m}return t},makeRandomVertexColors:function(t,e){e=e||{};var n=t.position.numElements,r=it(4,n,Uint8Array),i=e.rand||function(t,e){return e<3?(n=256,Math.random()*n|0):255;var n};if(t.color=r,t.indices)for(var o=0;o<n;++o)r.push(i(o,0),i(o,1),i(o,2),i(o,3));else for(var a=e.vertsPerColor||3,s=n/a,u=0;u<s;++u)for(var l=[i(u,0),i(u,1),i(u,2),i(u,3)],c=0;c<a;++c)r.push(l);return t},reorientDirections:ut,reorientNormals:lt,reorientPositions:ct,reorientVertices:ft,concatVertices:function(t){for(var e,n={},r=function(r){var i=t[r];Object.keys(i).forEach((function(t){n[t]||(n[t]=[]),e||"indices"===t||(e=t);var r=i[t],o=nt(r,t),a=et(r).length/o;n[t].push(a)}))},i=0;i<t.length;++i)r(i);var o=n[e],a={};return Object.keys(n).forEach((function(e){var n=function(e){for(var n,r=0,i=0;i<t.length;++i){var o=t[i][e];r+=et(o).length,n&&!o.data||(n=o)}return{length:r,spec:n}}(e),r=St(n.spec,n.length);!function(e,n,r){for(var i=0,o=0,a=0;a<t.length;++a){var s=t[a][e],u=et(s);"indices"===e?(Pt(u,r,o,i),i+=n[a]):Pt(u,r,o),o+=u.length}}(e,o,et(r)),a[e]=r})),a},duplicateVertices:function(t){var e={};return Object.keys(t).forEach((function(n){var r=t[n],i=et(r),o=St(r,i.length);Pt(i,et(o),0),e[n]=o})),e}});function $t(t){return!!t.texStorage2D}function te(t){return!t.texStorage2D}var ee,ne,re,ie=(ee={},ne={},function(t,e){return function(t){var e=t.constructor.name;if(!ee[e]){for(var n in t)if("number"==typeof t[n]){var r=ne[t[n]];ne[t[n]]=r?"".concat(r," | ").concat(n):n}ee[e]=!0}}(t),ne[e]||"0x"+e.toString(16)}),oe={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},ae=O;function se(){return re=re||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null)}var ue,le=6407,ce=33319,fe={6406:{numColorComponents:1},6409:{numColorComponents:1},6410:{numColorComponents:2},6407:{numColorComponents:3},6408:{numColorComponents:4},6403:{numColorComponents:1},36244:{numColorComponents:1},33319:{numColorComponents:2},33320:{numColorComponents:2}};function me(t){if(!ue){var e={6406:{textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},6409:{textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},6410:{textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[5121,5131,36193,5126]}};e[le]={textureFormat:le,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[5121,5131,36193,5126,33635]},e[6408]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[5121,5131,36193,5126,32819,32820]},e[33321]={textureFormat:6403,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[5121]},e[36756]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[5120]},e[33325]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[5126,5131]},e[33326]={textureFormat:6403,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[33330]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5121]},e[33329]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5120]},e[33332]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5123]},e[33331]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5122]},e[33334]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[33333]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5124]},e[33323]={textureFormat:ce,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[5121]},e[36757]={textureFormat:ce,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[5120]},e[33327]={textureFormat:ce,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[5126,5131]},e[33328]={textureFormat:ce,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[5126]},e[33336]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5121]},e[33335]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5120]},e[33338]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5123]},e[33337]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5122]},e[33340]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5125]},e[33339]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5124]},e[32849]={textureFormat:le,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[35905]={textureFormat:le,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5121]},e[36194]={textureFormat:le,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[5121,33635]},e[36758]={textureFormat:le,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5120]},e[35898]={textureFormat:le,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35899]},e[35901]={textureFormat:le,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35902]},e[34843]={textureFormat:le,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[5126,5131]},e[34837]={textureFormat:le,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5126]},e[36221]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5121]},e[36239]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5120]},e[36215]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5123]},e[36233]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5122]},e[36209]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5125]},e[36227]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5124]},e[32856]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[35907]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},e[36759]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[5120]},e[32855]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[5121,32820,33640]},e[32854]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[5121,32819]},e[32857]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[33640]},e[34842]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[5126,5131]},e[34836]={textureFormat:6408,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[5126]},e[36220]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5121]},e[36238]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5120]},e[36975]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[33640]},e[36214]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5123]},e[36232]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5122]},e[36226]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5124]},e[36208]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5125]},e[33189]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5123,5125]},e[33190]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},e[36012]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5126]},e[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},e[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(e).forEach((function(t){var n=e[t];n.bytesPerElementMap={},n.bytesPerElement.forEach((function(t,e){var r=n.type[e];n.bytesPerElementMap[r]=t}))})),ue=e}return ue[t]}function he(t){var e=me(t);if(!e)throw"unknown internal format";return{format:e.textureFormat,type:e.type[0]}}function de(t){return 0==(t&t-1)}function pe(t,e,n,r,i){if(i%1!=0)throw"can't guess dimensions";if(n||r){if(r){if(!n&&(n=i/r)%1)throw"can't guess dimensions"}else if((r=i/n)%1)throw"can't guess dimensions"}else{var o=Math.sqrt(i/(34067===e?6:1));o%1==0?(n=o,r=o):(n=i,r=1)}return{width:n,height:r}}fe[le]={numColorComponents:3},fe[36248]={numColorComponents:3},fe[6408]={numColorComponents:4},fe[36249]={numColorComponents:4},fe[6402]={numColorComponents:1},fe[34041]={numColorComponents:2};var ve={};function ye(t,e){void 0!==e.colorspaceConversion&&(ve.colorspaceConversion=t.getParameter(37443),t.pixelStorei(37443,e.colorspaceConversion)),void 0!==e.premultiplyAlpha&&(ve.premultiplyAlpha=t.getParameter(37441),t.pixelStorei(37441,e.premultiplyAlpha)),void 0!==e.flipY&&(ve.flipY=t.getParameter(37440),t.pixelStorei(37440,e.flipY))}function ge(t,e){void 0!==e.colorspaceConversion&&t.pixelStorei(37443,ve.colorspaceConversion),void 0!==e.premultiplyAlpha&&t.pixelStorei(37441,ve.premultiplyAlpha),void 0!==e.flipY&&t.pixelStorei(37440,ve.flipY)}function _e(t){ve.unpackAlignment=t.getParameter(3317),$t(t)&&(ve.unpackRowLength=t.getParameter(3314),ve.unpackImageHeight=t.getParameter(32878),ve.unpackSkipPixels=t.getParameter(3316),ve.unpackSkipRows=t.getParameter(3315),ve.unpackSkipImages=t.getParameter(32877))}function xe(t){t.pixelStorei(3317,ve.unpackAlignment),$t(t)&&(t.pixelStorei(3314,ve.unpackRowLength),t.pixelStorei(32878,ve.unpackImageHeight),t.pixelStorei(3316,ve.unpackSkipPixels),t.pixelStorei(3315,ve.unpackSkipRows),t.pixelStorei(32877,ve.unpackSkipImages))}function be(t,e,n,r){var i;r.minMag&&(n.call(t,e,10241,r.minMag),n.call(t,e,10240,r.minMag)),r.min&&n.call(t,e,10241,r.min),r.mag&&n.call(t,e,10240,r.mag),r.wrap&&(n.call(t,e,10242,r.wrap),n.call(t,e,10243,r.wrap),(32879===e||(i=e,"undefined"!=typeof WebGLSampler&&i instanceof WebGLSampler))&&n.call(t,e,32882,r.wrap)),r.wrapR&&n.call(t,e,32882,r.wrapR),r.wrapS&&n.call(t,e,10242,r.wrapS),r.wrapT&&n.call(t,e,10243,r.wrapT),r.minLod&&n.call(t,e,33082,r.minLod),r.maxLod&&n.call(t,e,33083,r.maxLod),r.baseLevel&&n.call(t,e,33084,r.baseLevel),r.maxLevel&&n.call(t,e,33085,r.maxLevel)}function we(t,e,n){var r=n.target||3553;t.bindTexture(r,e),be(t,r,t.texParameteri,n)}function Ae(t,e,n,r,i,o){o=o||6408;var a=(n=n||oe.textureOptions).target||3553;if(r=r||n.width,i=i||n.height,t.bindTexture(a,e),function(t,e,n,r){if(!$t(t))return de(e)&&de(n);var i=me(r);if(!i)throw"unknown internal format";return i.colorRenderable&&i.textureFilterable}(t,r,i,o))t.generateMipmap(a);else{var s=function(t){var e=me(t);if(!e)throw"unknown internal format";return e.textureFilterable}(o)?9729:9728;t.texParameteri(a,10241,s),t.texParameteri(a,10240,s),t.texParameteri(a,10242,33071),t.texParameteri(a,10243,33071)}}function Ce(t){return!0===t.auto||void 0===t.auto&&void 0===t.level}function Te(t,e){return(e=e||{}).cubeFaceOrder||[34069,34070,34071,34072,34073,34074]}function Ie(t,e){var n=Te(0,e).map((function(t,e){return{face:t,ndx:e}}));return n.sort((function(t,e){return t.face-e.face})),n}function Pe(t,e,n,r){var i=(r=r||oe.textureOptions).target||3553,o=r.level||0,a=n.width,s=n.height,u=r.internalFormat||r.format||6408,l=he(u),c=r.format||l.format,f=r.type||l.type;if(ye(t,r),t.bindTexture(i,e),34067===i){var m,h,d=n.width,p=n.height;if(d/6===p)m=p,h=[0,0,1,0,2,0,3,0,4,0,5,0];else if(p/6===d)m=d,h=[0,0,0,1,0,2,0,3,0,4,0,5];else if(d/3==p/2)m=d/3,h=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(d/2!=p/3)throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);m=d/2,h=[0,0,1,0,0,1,1,1,0,2,1,2]}var v=se();v?(v.canvas.width=m,v.canvas.height=m,a=m,s=m,Ie(0,r).forEach((function(e){var r=h[2*e.ndx+0]*m,i=h[2*e.ndx+1]*m;v.drawImage(n,r,i,m,m,0,0,m,m),t.texImage2D(e.face,o,u,c,f,v.canvas)})),v.canvas.width=1,v.canvas.height=1):"undefined"!=typeof createImageBitmap&&(a=m,s=m,Ie(0,r).forEach((function(l){var d=h[2*l.ndx+0]*m,p=h[2*l.ndx+1]*m;t.texImage2D(l.face,o,u,m,m,0,c,f,null),createImageBitmap(n,d,p,m,m,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(n){ye(t,r),t.bindTexture(i,e),t.texImage2D(l.face,o,u,c,f,n),ge(t,r),Ce(r)&&Ae(t,e,r,a,s,u)}))})))}else if(32879===i||35866===i){var y=Math.min(n.width,n.height),g=Math.max(n.width,n.height),_=g/y;if(_%1!=0)throw"can not compute 3D dimensions of element";var x=n.width===g?1:0,b=n.height===g?1:0;_e(t),t.pixelStorei(3317,1),t.pixelStorei(3314,n.width),t.pixelStorei(32878,0),t.pixelStorei(32877,0),t.texImage3D(i,o,u,y,y,y,0,c,f,null);for(var w=0;w<_;++w){var A=w*y*x,C=w*y*b;t.pixelStorei(3316,A),t.pixelStorei(3315,C),t.texSubImage3D(i,o,0,0,w,y,y,1,c,f,n)}xe(t)}else t.texImage2D(i,o,u,c,f,n);ge(t,r),Ce(r)&&Ae(t,e,r,a,s,u),we(t,e,r)}function Se(){}function Ee(t,e){return void 0!==e||function(t){if("undefined"!=typeof document){var e=document.createElement("a");return e.href=t,e.hostname===location.hostname&&e.port===location.port&&e.protocol===location.protocol}var n=new URL(location.href).origin;return new URL(t,location.href).origin===n}(t)?e:"anonymous"}function Le(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof ImageData&&t instanceof ImageData||"undefined"!=typeof HTMLElement&&t instanceof HTMLElement}function Me(t,e,n){return Le(t)?(setTimeout((function(){n(null,t)})),t):function(t,e,n){var r;if(n=n||Se,e=Ee(t,e=void 0!==e?e:oe.crossOrigin),"undefined"!=typeof Image){r=new Image,void 0!==e&&(r.crossOrigin=e);var i=function(){r.removeEventListener("error",o),r.removeEventListener("load",a),r=null},o=function(){var e="couldn't load image: "+t;j(e),n(e,r),i()},a=function(){n(null,r),i()};return r.addEventListener("error",o),r.addEventListener("load",a),r.src=t,r}if("undefined"!=typeof ImageBitmap){var s,u,l=function(){n(s,u)},c={};e&&(c.mode="cors"),fetch(t,c).then((function(t){if(!t.ok)throw t;return t.blob()})).then((function(t){return createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(t){u=t,setTimeout(l)})).catch((function(t){s=t,setTimeout(l)})),r=null}return r}(t,e,n)}function ze(t,e,n){var r=(n=n||oe.textureOptions).target||3553;if(t.bindTexture(r,e),!1!==n.color){var i=function(t){return ae(t=t||oe.textureColor)?t:new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}(n.color);if(34067===r)for(var o=0;o<6;++o)t.texImage2D(34069+o,0,6408,1,1,0,6408,5121,i);else 32879===r||35866===r?t.texImage3D(r,0,6408,1,1,1,0,6408,5121,i):t.texImage2D(r,0,6408,1,1,0,6408,5121,i)}}function Fe(t,e,n,r){r=r||Se;var i=n.src;if(6!==i.length)throw"there must be 6 urls for a cubemap";var o=n.level||0,a=n.internalFormat||n.format||6408,s=he(a),u=n.format||s.format,l=n.type||5121,c=n.target||3553;if(34067!==c)throw"target must be TEXTURE_CUBE_MAP";ze(t,e,n),n=Object.assign({},n);var f,m=6,h=[],d=Te(0,n);f=i.map((function(i,s){return Me(i,n.crossOrigin,(p=d[s],function(i,s){--m,i?h.push(i):s.width!==s.height?h.push("cubemap face img is not a square: "+s.src):(ye(t,n),t.bindTexture(c,e),5===m?Te().forEach((function(e){t.texImage2D(e,o,a,u,l,s)})):t.texImage2D(p,o,a,u,l,s),ge(t,n),Ce(n)&&t.generateMipmap(c)),0===m&&r(h.length?h:void 0,e,f)}));var p}))}function Re(t,e,n,r){r=r||Se;var i=n.src,o=n.internalFormat||n.format||6408,a=he(o),s=n.format||a.format,u=n.type||5121,l=n.target||35866;if(32879!==l&&35866!==l)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";ze(t,e,n),n=Object.assign({},n);var c,f=i.length,m=[],h=n.level||0,d=n.width,p=n.height,v=i.length,y=!0;c=i.map((function(i,a){return Me(i,n.crossOrigin,(g=a,function(i,a){if(--f,i)m.push(i);else{if(ye(t,n),t.bindTexture(l,e),y){y=!1,d=n.width||a.width,p=n.height||a.height,t.texImage3D(l,h,o,d,p,v,0,s,u,null);for(var _=0;_<v;++_)t.texSubImage3D(l,h,0,0,_,d,p,1,s,u,a)}else{var x,b=a;a.width===d&&a.height===p||(b=(x=se()).canvas,x.canvas.width=d,x.canvas.height=p,x.drawImage(a,0,0,d,p)),t.texSubImage3D(l,h,0,0,g,d,p,1,s,u,b),x&&b===x.canvas&&(x.canvas.width=0,x.canvas.height=0)}ge(t,n),Ce(n)&&t.generateMipmap(l)}0===f&&r(m.length?m:void 0,e,c)}));var g}))}function De(t,e,n,r){var i=(r=r||oe.textureOptions).target||3553;t.bindTexture(i,e);var o=r.width,a=r.height,s=r.depth,u=r.level||0,l=r.internalFormat||r.format||6408,c=he(l),f=r.format||c.format,m=r.type||function(t,e,n){return ae(e)?k(e):n||5121}(0,n,c.type);if(ae(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{var h=function(t){var e=R[t];if(!e)throw new Error("unknown gl type");return e}(m);n=new h(n)}var d,p=function(t,e){var n=me(t);if(!n)throw"unknown internal format";var r=n.bytesPerElementMap[e];if(void 0===r)throw"unknown internal format";return r}(l,m),v=n.byteLength/p;if(v%1)throw"length wrong size for format: "+ie(t,f);if(32879===i||35866===i)if(o||a||s)!o||a&&s?!a||o&&s?(d=pe(0,i,o,a,v/s),o=d.width,a=d.height):(d=pe(0,i,o,s,v/a),o=d.width,s=d.height):(d=pe(0,i,a,s,v/o),a=d.width,s=d.height);else{var y=Math.cbrt(v);if(y%1!=0)throw"can't guess cube size of array of numElements: "+v;o=y,a=y,s=y}else d=pe(0,i,o,a,v),o=d.width,a=d.height;if(_e(t),t.pixelStorei(3317,r.unpackAlignment||1),ye(t,r),34067===i){var g=v/6*(p/n.BYTES_PER_ELEMENT);Ie(0,r).forEach((function(e){var r=g*e.ndx,i=n.subarray(r,r+g);t.texImage2D(e.face,u,l,o,a,0,f,m,i)}))}else 32879===i||35866===i?t.texImage3D(i,u,l,o,a,s,0,f,m,n):t.texImage2D(i,u,l,o,a,0,f,m,n);return ge(t,r),xe(t),{width:o,height:a,depth:s,type:m}}function ke(t,e,n){n=n||Se,e=e||oe.textureOptions;var r=t.createTexture(),i=e.target||3553,o=e.width||1,a=e.height||1,s=e.internalFormat||6408;t.bindTexture(i,r),34067===i&&(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071));var u=e.src;if(u)if("function"==typeof u&&(u=u(t,e)),"string"==typeof u)!function(t,e,n,r){r=r||Se,ze(t,e,n=n||oe.textureOptions),Me((n=Object.assign({},n)).src,n.crossOrigin,(function(i,o){i?r(i,e,o):(Pe(t,e,o,n),r(null,e,o))}))}(t,r,e,n);else if(ae(u)||Array.isArray(u)&&("number"==typeof u[0]||Array.isArray(u[0])||ae(u[0]))){var l=De(t,r,u,e);o=l.width,a=l.height}else Array.isArray(u)&&("string"==typeof u[0]||Le(u[0]))?34067===i?Fe(t,r,e,n):Re(t,r,e,n):(Pe(t,r,u,e),o=u.width,a=u.height);else!function(t,e,n){var r=n.target||3553;t.bindTexture(r,e);var i=n.level||0,o=n.internalFormat||n.format||6408,a=he(o),s=n.format||a.format,u=n.type||a.type;if(ye(t,n),34067===r)for(var l=0;l<6;++l)t.texImage2D(34069+l,i,o,n.width,n.height,0,s,u,null);else 32879===r||35866===r?t.texImage3D(r,i,o,n.width,n.height,n.depth,0,s,u,null):t.texImage2D(r,i,o,n.width,n.height,0,s,u,null);ge(t,n)}(t,r,e);return Ce(e)&&Ae(t,r,e,o,a,s),we(t,r,e),r}var Oe=j;function je(t){return"undefined"!=typeof document&&document.getElementById?document.getElementById(t):null}var Be={};function Ge(t,e){return Be[e].bindPoint}function Ne(t,e){return function(n){t.uniform1i(e,n)}}function Ue(t,e){return function(n){t.uniform1iv(e,n)}}function Ve(t,e){return function(n){t.uniform2iv(e,n)}}function We(t,e){return function(n){t.uniform3iv(e,n)}}function Ye(t,e){return function(n){t.uniform4iv(e,n)}}function He(t,e,n,r){var i=Ge(0,e);return $t(t)?function(e){var o,a;G(0,e)?(o=e,a=null):(o=e.texture,a=e.sampler),t.uniform1i(r,n),t.activeTexture(33984+n),t.bindTexture(i,o),t.bindSampler(n,a)}:function(e){t.uniform1i(r,n),t.activeTexture(33984+n),t.bindTexture(i,e)}}function Xe(t,e,n,r,i){for(var o=Ge(0,e),a=new Int32Array(i),s=0;s<i;++s)a[s]=n+s;return $t(t)?function(e){t.uniform1iv(r,a),e.forEach((function(e,r){var i,s;t.activeTexture(33984+a[r]),G(0,e)?(i=e,s=null):(i=e.texture,s=e.sampler),t.bindSampler(n,s),t.bindTexture(o,i)}))}:function(e){t.uniform1iv(r,a),e.forEach((function(e,n){t.activeTexture(33984+a[n]),t.bindTexture(o,e)}))}}function qe(t,e){return function(n){if(n.value)switch(t.disableVertexAttribArray(e),n.value.length){case 4:t.vertexAttrib4fv(e,n.value);break;case 3:t.vertexAttrib3fv(e,n.value);break;case 2:t.vertexAttrib2fv(e,n.value);break;case 1:t.vertexAttrib1fv(e,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.numComponents||n.size,n.type||5126,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function Ke(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,n.value)}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5124,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function Ze(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,n.value)}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5125,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function Je(t,e,n){var r=n.size,i=n.count;return function(n){t.bindBuffer(34962,n.buffer);for(var o=n.size||n.numComponents||r,a=o/i,s=n.type||5126,u=Be[s].size*o,l=n.normalize||!1,c=n.offset||0,f=u/i,m=0;m<i;++m)t.enableVertexAttribArray(e+m),t.vertexAttribPointer(e+m,a,s,l,u,c+f*m),void 0!==n.divisor&&t.vertexAttribDivisor(e+m,n.divisor)}}Be[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(n){t.uniform1f(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1fv(e,n)}}},Be[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(n){t.uniform2fv(e,n)}}},Be[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(n){t.uniform3fv(e,n)}}},Be[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(n){t.uniform4fv(e,n)}}},Be[5124]={Type:Int32Array,size:4,setter:Ne,arraySetter:Ue},Be[35667]={Type:Int32Array,size:8,setter:Ve},Be[35668]={Type:Int32Array,size:12,setter:We},Be[35669]={Type:Int32Array,size:16,setter:Ye},Be[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(n){t.uniform1ui(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1uiv(e,n)}}},Be[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(n){t.uniform2uiv(e,n)}}},Be[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(n){t.uniform3uiv(e,n)}}},Be[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(n){t.uniform4uiv(e,n)}}},Be[35670]={Type:Uint32Array,size:4,setter:Ne,arraySetter:Ue},Be[35671]={Type:Uint32Array,size:8,setter:Ve},Be[35672]={Type:Uint32Array,size:12,setter:We},Be[35673]={Type:Uint32Array,size:16,setter:Ye},Be[35674]={Type:Float32Array,size:16,setter:function(t,e){return function(n){t.uniformMatrix2fv(e,!1,n)}}},Be[35675]={Type:Float32Array,size:36,setter:function(t,e){return function(n){t.uniformMatrix3fv(e,!1,n)}}},Be[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4fv(e,!1,n)}}},Be[35685]={Type:Float32Array,size:24,setter:function(t,e){return function(n){t.uniformMatrix2x3fv(e,!1,n)}}},Be[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x4fv(e,!1,n)}}},Be[35687]={Type:Float32Array,size:24,setter:function(t,e){return function(n){t.uniformMatrix3x2fv(e,!1,n)}}},Be[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x4fv(e,!1,n)}}},Be[35689]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix4x2fv(e,!1,n)}}},Be[35690]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix4x3fv(e,!1,n)}}},Be[35678]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:3553},Be[35680]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:34067},Be[35679]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:32879},Be[35682]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:3553},Be[36289]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:35866},Be[36292]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:35866},Be[36293]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:34067},Be[36298]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:3553},Be[36299]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:32879},Be[36300]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:34067},Be[36303]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:35866},Be[36306]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:3553},Be[36307]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:32879},Be[36308]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:34067},Be[36311]={Type:null,size:0,setter:He,arraySetter:Xe,bindPoint:35866};var Qe={};Qe[5126]={size:4,setter:qe},Qe[35664]={size:8,setter:qe},Qe[35665]={size:12,setter:qe},Qe[35666]={size:16,setter:qe},Qe[5124]={size:4,setter:Ke},Qe[35667]={size:8,setter:Ke},Qe[35668]={size:12,setter:Ke},Qe[35669]={size:16,setter:Ke},Qe[5125]={size:4,setter:Ze},Qe[36294]={size:8,setter:Ze},Qe[36295]={size:12,setter:Ze},Qe[36296]={size:16,setter:Ze},Qe[35670]={size:4,setter:Ke},Qe[35671]={size:8,setter:Ke},Qe[35672]={size:12,setter:Ke},Qe[35673]={size:16,setter:Ke},Qe[35674]={size:4,setter:Je,count:2},Qe[35675]={size:9,setter:Je,count:3},Qe[35676]={size:16,setter:Je,count:4};var $e=/^[ \t]*\n/;function tn(t,e,n,r){var i=r||Oe,o=t.createShader(n),a=0;if($e.test(e)&&(a=1,e=e.replace($e,"")),t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,35713)){var s=t.getShaderInfoLog(o);return i(function(t,e){return e=e||0,++e,t.split("\n").map((function(t,n){return n+e+": "+t})).join("\n")}(e,a)+"\n*** Error compiling shader: "+s),t.deleteShader(o),null}return o}function en(t,e,n){var r,i;if("function"==typeof e&&(n=e,e=void 0),"function"==typeof t)n=t,t=void 0;else if(t&&!Array.isArray(t)){if(t.errorCallback)return t;var o=t;n=o.errorCallback,t=o.attribLocations,r=o.transformFeedbackVaryings,i=o.transformFeedbackMode}var a={errorCallback:n||Oe,transformFeedbackVaryings:r,transformFeedbackMode:i};if(t){var s={};Array.isArray(t)?t.forEach((function(t,n){s[t]=e?e[n]:n})):s=t,a.attribLocations=s}return a}var nn=["VERTEX_SHADER","FRAGMENT_SHADER"];function rn(t,e){e.forEach((function(e){t.deleteShader(e)}))}function on(t,e,n,r,i){for(var o=en(n,r,i),a=[],s=0;s<e.length;++s){var u=tn(t,e[s],t[nn[s]],o.errorCallback);if(!u)return null;a.push(u)}return function(t,e,n,r,i){for(var o,a,s=en(n,r,i),u=[],l=[],c=0;c<e.length;++c){var f=e[c];if("string"==typeof f){var m=je(f),h=m?m.text:f,d=t[nn[c]];m&&m.type&&(d=((a=m.type).indexOf("frag")>=0?35632:a.indexOf("vert")>=0?35633:void 0)||d),f=tn(t,h,d,s.errorCallback),l.push(f)}o=f,"undefined"!=typeof WebGLShader&&o instanceof WebGLShader&&u.push(f)}if(u.length!==e.length)return s.errorCallback("not enough shaders for program"),rn(t,l),null;var p=t.createProgram();u.forEach((function(e){t.attachShader(p,e)})),s.attribLocations&&Object.keys(s.attribLocations).forEach((function(e){t.bindAttribLocation(p,s.attribLocations[e],e)}));var v=s.transformFeedbackVaryings;if(v&&(v.attribs&&(v=v.attribs),Array.isArray(v)||(v=Object.keys(v)),t.transformFeedbackVaryings(p,v,s.transformFeedbackMode||35981)),t.linkProgram(p),!t.getProgramParameter(p,35714)){var y=t.getProgramInfoLog(p);return s.errorCallback("Error in program linking:"+y),t.deleteProgram(p),rn(t,l),null}return p}(t,a,o)}function an(t){var e=t.name;return e.startsWith("gl_")||e.startsWith("webgl_")}function sn(t,e){for(var n=t.uniformSetters||t,r=arguments.length,i=1;i<r;++i){var o=arguments[i];if(Array.isArray(o))for(var a=o.length,s=0;s<a;++s)sn(n,o[s]);else for(var u in o){var l=n[u];l&&l(o[u])}}}function un(t,e,n){n.vertexArrayObject?t.bindVertexArray(n.vertexArrayObject):(!function(t,e){for(var n in e){var r=t[n];r&&r(e[n])}}(e.attribSetters||e,n.attribs),n.indices&&t.bindBuffer(34963,n.indices))}function ln(t,e){var n={program:e,uniformSetters:function(t,e){var n=0;function r(e,r,i){var o,a=r.size>1&&"[0]"===r.name.substr(-3),s=r.type,u=Be[s];if(!u)throw new Error("unknown type: 0x".concat(s.toString(16)));if(u.bindPoint){var l=n;n+=r.size,o=a?u.arraySetter(t,s,l,i,r.size):u.setter(t,s,l,i,r.size)}else o=u.arraySetter&&a?u.arraySetter(t,i):u.setter(t,i);return o.location=i,o}for(var i={},o=t.getProgramParameter(e,35718),a=0;a<o;++a){var s=t.getActiveUniform(e,a);if(!an(s)){var u=s.name;"[0]"===u.substr(-3)&&(u=u.substr(0,u.length-3));var l=t.getUniformLocation(e,s.name);l&&(i[u]=r(0,s,l))}}return i}(t,e),attribSetters:function(t,e){for(var n={},r=t.getProgramParameter(e,35721),i=0;i<r;++i){var o=t.getActiveAttrib(e,i);if(!an(o)){var a=t.getAttribLocation(e,o.name),s=Qe[o.type],u=s.setter(t,a,s);u.location=a,n[o.name]=u}}return n}(t,e)};return $t(t)&&(n.uniformBlockSpec=function(t,e){for(var n=t.getProgramParameter(e,35718),r=[],i=[],o=0;o<n;++o){i.push(o),r.push({});var a=t.getActiveUniform(e,o);if(an(a))break;r[o].name=a.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){var o=n[0],a=n[1];t.getActiveUniforms(e,i,t[o]).forEach((function(t,e){r[e][a]=t}))}));for(var s={},u=t.getProgramParameter(e,35382),l=0;l<u;++l){var c=t.getActiveUniformBlockName(e,l),f={index:t.getUniformBlockIndex(e,c),usedByVertexShader:t.getActiveUniformBlockParameter(e,l,35396),usedByFragmentShader:t.getActiveUniformBlockParameter(e,l,35398),size:t.getActiveUniformBlockParameter(e,l,35392),uniformIndices:t.getActiveUniformBlockParameter(e,l,35395)};f.used=f.usedByVertexShader||f.usedByFragmentShader,s[c]=f}return{blockSpecs:s,uniformData:r}}(t,e),n.transformFeedbackInfo=function(t,e){for(var n={},r=t.getProgramParameter(e,35971),i=0;i<r;++i){var o=t.getTransformFeedbackVarying(e,i);n[o.name]={index:i,type:o.type,size:o.size}}return n}(t,e)),n}function cn(t,e,n){var r=t.createVertexArray();return t.bindVertexArray(r),e.length||(e=[e]),e.forEach((function(e){un(t,e,n)})),t.bindVertexArray(null),{numElements:n.numElements,elementType:n.elementType,vertexArrayObject:r}}var fn=!0,mn=/^(.*?)_/;function hn(t,e){ie(t,0);var n=t.getExtension(e);if(n){var r={},i=mn.exec(e)[1],o="_"+i;for(var a in n){var s=n[a],u="function"==typeof s,l=u?i:o,c=a;a.endsWith(l)&&(c=a.substring(0,a.length-l.length)),void 0!==t[c]?u||t[c]===s||B(c,t[c],s,a):u?t[c]=function(t){return function(){return t.apply(n,arguments)}}(s):(t[c]=s,r[c]=s)}r.constructor={name:n.constructor.name},ie(r,0)}return n}var dn=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function pn(t){for(var e=0;e<dn.length;++e)hn(t,dn[e])}function vn(t,e){return function(t,e){for(var n=["webgl","experimental-webgl"],r=null,i=0;i<n.length;++i)if(r=t.getContext(n[i],e)){fn&&pn(r);break}return r}(t,e)}function yn(t,e){e=e||1,e=Math.max(0,e);var n=t.clientWidth*e|0,r=t.clientHeight*e|0;return(t.width!==n||t.height!==r)&&(t.width=n,t.height=r,!0)}var gn=function(){function t(e,r){var i=this;n(this,t),o(this,"gl",null),o(this,"isWebGL2",null),o(this,"init",(function(){var t=i.gl;t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)})),o(this,"resize",(function(t,e){i.gl.viewport(0,0,t,e)})),o(this,"prepareRenderFrame",(function(){i.gl.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT)})),this.gl=vn(e,r),this.isWebGL2=$t(this.gl)&&te(this.gl),pn(this.gl),this.gl.drawArraysInstanced&&this.gl.createVertexArray?yn(e):alert("need drawArraysInstanced and createVertexArray")}return i(t,[{key:"clearColor",set:function(t){this.gl.clearColor(t[0],t[1],t[2],t[3])}}]),t}(),_n="undefined"!=typeof Float32Array?Float32Array:Array;function xn(){var t=new _n(16);return _n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function bn(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],f=e[9],m=e[10],h=e[11],d=e[12],p=e[13],v=e[14],y=e[15],g=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,A=i*l-o*u,C=c*p-f*d,T=c*v-m*d,I=c*y-h*d,P=f*v-m*p,S=f*y-h*p,E=m*y-h*v,L=g*E-_*S+x*P+b*I-w*T+A*C;return L?(L=1/L,t[0]=(s*E-u*S+l*P)*L,t[1]=(i*S-r*E-o*P)*L,t[2]=(p*A-v*w+y*b)*L,t[3]=(m*w-f*A-h*b)*L,t[4]=(u*I-a*E-l*T)*L,t[5]=(n*E-i*I+o*T)*L,t[6]=(v*x-d*A-y*_)*L,t[7]=(c*A-m*x+h*_)*L,t[8]=(a*S-s*I+l*C)*L,t[9]=(r*I-n*S-o*C)*L,t[10]=(d*w-p*x+y*g)*L,t[11]=(f*x-c*w-h*g)*L,t[12]=(s*T-a*P-u*C)*L,t[13]=(n*P-r*T+i*C)*L,t[14]=(p*_-d*b-v*g)*L,t[15]=(c*b-f*_+m*g)*L,t):null}function An(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],m=e[9],h=e[10],d=e[11],p=e[12],v=e[13],y=e[14],g=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*f+w*p,t[1]=_*i+x*u+b*m+w*v,t[2]=_*o+x*l+b*h+w*y,t[3]=_*a+x*c+b*d+w*g,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*r+x*s+b*f+w*p,t[5]=_*i+x*u+b*m+w*v,t[6]=_*o+x*l+b*h+w*y,t[7]=_*a+x*c+b*d+w*g,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*r+x*s+b*f+w*p,t[9]=_*i+x*u+b*m+w*v,t[10]=_*o+x*l+b*h+w*y,t[11]=_*a+x*c+b*d+w*g,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*r+x*s+b*f+w*p,t[13]=_*i+x*u+b*m+w*v,t[14]=_*o+x*l+b*h+w*y,t[15]=_*a+x*c+b*d+w*g,t}function Cn(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}function Tn(t,e,n,r){var i,o,a,s,u,l,c,f,m,h,d=e[0],p=e[1],v=e[2],y=r[0],g=r[1],_=r[2],x=n[0],b=n[1],w=n[2];return Math.abs(d-x)<1e-6&&Math.abs(p-b)<1e-6&&Math.abs(v-w)<1e-6?bn(t):(c=d-x,f=p-b,m=v-w,i=g*(m*=h=1/Math.hypot(c,f,m))-_*(f*=h),o=_*(c*=h)-y*m,a=y*f-g*c,(h=Math.hypot(i,o,a))?(i*=h=1/h,o*=h,a*=h):(i=0,o=0,a=0),s=f*a-m*o,u=m*i-c*a,l=c*o-f*i,(h=Math.hypot(s,u,l))?(s*=h=1/h,u*=h,l*=h):(s=0,u=0,l=0),t[0]=i,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=a,t[9]=l,t[10]=m,t[11]=0,t[12]=-(i*d+o*p+a*v),t[13]=-(s*d+u*p+l*v),t[14]=-(c*d+f*p+m*v),t[15]=1,t)}function In(){var t=new _n(3);return _n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Pn(t,e,n){var r=new _n(3);return r[0]=t,r[1]=e,r[2]=n,r}function Sn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function En(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ln(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Mn(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function zn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Fn(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function Rn(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function Dn(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var kn,On=function(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)};kn=In();!function(){var t,e=(t=new _n(4),_n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function jn(){var t=new _n(4);return _n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Bn(t,e,n,r){var i,o,a,s,u,l=e[0],c=e[1],f=e[2],m=e[3],h=n[0],d=n[1],p=n[2],v=n[3];return(o=l*h+c*d+f*p+m*v)<0&&(o=-o,h=-h,d=-d,p=-p,v=-v),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*l+u*h,t[1]=s*c+u*d,t[2]=s*f+u*p,t[3]=s*m+u*v,t}var Gn,Nn,Un,Vn,Wn,Yn,Hn,Xn=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t};Gn=In(),Nn=Pn(1,0,0),Un=Pn(0,1,0),Vn=jn(),Wn=jn(),Yn=new _n(9),_n!=Float32Array&&(Yn[1]=0,Yn[2]=0,Yn[3]=0,Yn[5]=0,Yn[6]=0,Yn[7]=0),Yn[0]=1,Yn[4]=1,Yn[8]=1,Hn=Yn;!function(){var t=function(){var t=new _n(2);return _n!=Float32Array&&(t[0]=0,t[1]=0),t}()}();var qn=function t(e,r){var i=this;n(this,t),o(this,"fov",void 0),o(this,"width",void 0),o(this,"height",void 0),o(this,"aspect",void 0),o(this,"zNear",void 0),o(this,"zFar",void 0),o(this,"projection",void 0),o(this,"eye",void 0),o(this,"target",void 0),o(this,"up",void 0),o(this,"view",void 0),o(this,"viewProjection",void 0),o(this,"world",void 0),o(this,"resize",(function(t,e){i.width=t,i.height=e,i.aspect=t/e,i.projection=xn(),Cn(i.projection,i.fov,i.aspect,i.zNear,i.zFar)})),o(this,"update",(function(){Tn(i.view,i.eye,i.target,i.up),wn(i.camera,i.view),An(i.viewProjection,i.projection,i.view)})),o(this,"setPosition",(function(t){i.eye=t})),o(this,"getUniforms",(function(){var t={};return t.u_viewInverse=i.camera,t.u_world=i.world,t.u_worldInverseTranspose=xn(),t.u_view=i.view,t.u_resolution=[i.width,i.height],wn(t.u_worldInverseTranspose,i.world),function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(t.u_worldInverseTranspose,t.u_worldInverseTranspose),t.u_worldViewProjection=xn(),An(t.u_worldViewProjection,i.viewProjection,i.world),t.u_cameraPos=i.eye,t})),o(this,"getRayFromScreen",(function(t,e){var n=2*t-1,r=2*e-1,o=i.unproject([n,r,-1]),a=i.unproject([n,r,1]),s=In();return En(s,a,o),Mn(s,s),{origin:o,direction:s}})),o(this,"unproject",(function(t){var e=xn();wn(e,i.viewProjection);var n=Pn(t[0],t[1],t[2]);return Dn(n,n,e),n})),o(this,"project",(function(t){var e=function(t){var e=new _n(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}(t);return Dn(e,e,i.viewProjection),[(e[0]+1)/2,(e[1]+1)/2]})),this.fov=Math.PI/180*30,this.width=e,this.height=r,this.aspect=e/r,this.zNear=.01,this.zFar=100,this.projection=xn(),Cn(this.projection,this.fov,this.aspect,this.zNear,this.zFar),this.eye=[0,0,6],this.target=[0,0,0],this.up=[0,1,0],this.view=xn(),Tn(this.view,this.eye,this.target,this.up),this.camera=xn(),wn(this.camera,this.view),this.viewProjection=xn(),An(this.viewProjection,this.projection,this.view),this.world=xn(),bn(this.world)},Kn=function t(e,r){var i=this;n(this,t),o(this,"resize",(function(t,e){i.camera.resize(t,e)})),o(this,"update",(function(t){i.camera.update(t)})),o(this,"getUniforms",(function(t){var e=i.camera.getUniforms(t);return e.time=t,e})),this.camera=new qn(e,r)},Zn=function(){function t(e){var r=this;n(this,t),o(this,"programInfo",null),o(this,"textures",{}),o(this,"uniforms",null),o(this,"shaderStrings",null),o(this,"isInit",!1),o(this,"texturesLoaded",!1),o(this,"init",(function(t){r.programInfo=function(t,e,n,r,i){var o=en(n,r,i),a=!0;if(e=e.map((function(t){if(t.indexOf("\n")<0){var e=je(t);e?t=e.text:(o.errorCallback("no element with id: "+t),a=!1)}return t})),!a)return null;var s=on(t,e,o);return s?ln(t,s):null}(t,Object.values(r.shaderStrings)),r.isInit=!0})),o(this,"loadTextures",(function(t,e,n){if(e){var i=Object.keys(e).length,o=0;Object.entries(e).forEach((function(e){var a=p(e,2),s=a[0],u=a[1];r.textures[s]=ke(t,u,(function(){(o+=1)===i&&(r.texturesLoaded=!0,n&&n())}))}))}})),o(this,"updateUniforms",(function(t){Object.entries(t).forEach((function(t){var e=p(t,2),n=e[0],i=e[1];r.uniforms[n]=i}))})),this.shaderStrings=e}return i(t,[{key:"isReady",get:function(){return this.isInit&&this.texturesLoaded}}]),t}();let Jn;const Qn=new Array(32).fill(void 0);function $n(t){return Qn[t]}Qn.push(void 0,null,!0,!1);let tr=Qn.length;function er(t){const e=$n(t);return function(t){t<36||(Qn[t]=tr,tr=t)}(t),e}let nr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});nr.decode();let rr=null;function ir(){return null!==rr&&rr.buffer===Jn.memory.buffer||(rr=new Uint8Array(Jn.memory.buffer)),rr}function or(t,e){return nr.decode(ir().subarray(t,t+e))}function ar(t){tr===Qn.length&&Qn.push(Qn.length+1);const e=tr;return tr=Qn[e],Qn[e]=t,e}let sr=0,ur=new TextEncoder("utf-8");const lr="function"==typeof ur.encodeInto?function(t,e){return ur.encodeInto(t,e)}:function(t,e){const n=ur.encode(t);return e.set(n),{read:t.length,written:n.length}};function cr(t,e,n){if(void 0===n){const n=ur.encode(t),r=e(n.length);return ir().subarray(r,r+n.length).set(n),sr=n.length,r}let r=t.length,i=e(r);const o=ir();let a=0;for(;a<r;a++){const e=t.charCodeAt(a);if(e>127)break;o[i+a]=e}if(a!==r){0!==a&&(t=t.slice(a)),i=n(i,r,r=a+3*t.length);const e=ir().subarray(i+a,i+r);a+=lr(t,e).written}return sr=a,i}let fr=null;function mr(){return null!==fr&&fr.buffer===Jn.memory.buffer||(fr=new Int32Array(Jn.memory.buffer)),fr}function hr(t,e,n){Jn._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__ha5107d5f7795da4f(t,e,ar(n))}let dr=null;function pr(t,e){const n=e(4*t.length);return(null!==dr&&dr.buffer===Jn.memory.buffer||(dr=new Float32Array(Jn.memory.buffer)),dr).set(t,n/4),sr=t.length,n}let vr=null;function yr(t,e){const n=e(4*t.length);return(null!==vr&&vr.buffer===Jn.memory.buffer||(vr=new Uint32Array(Jn.memory.buffer)),vr).set(t,n/4),sr=t.length,n}class gr{free(){const t=this.ptr;this.ptr=0,Jn.__wbg_gkcollider_free(t)}static create_collision_geometry(t,e,n){var r=pr(t,Jn.__wbindgen_malloc),i=sr,o=pr(e,Jn.__wbindgen_malloc),a=sr,s=yr(n,Jn.__wbindgen_malloc),u=sr,l=Jn.gkcollider_create_collision_geometry(r,i,o,a,s,u);return xr.__wrap(l)}}class _r{free(){const t=this.ptr;this.ptr=0,Jn.__wbg_gkcollision_free(t)}}class xr{static __wrap(t){const e=Object.create(xr.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,Jn.__wbg_gkcollisiongeo_free(t)}raycast(t,e){var n=pr(t,Jn.__wbindgen_malloc),r=sr,i=pr(e,Jn.__wbindgen_malloc),o=sr;return er(Jn.gkcollisiongeo_raycast(this.ptr,n,r,i,o))}hitTest(t,e){var n=pr(t,Jn.__wbindgen_malloc),r=sr,i=pr(e,Jn.__wbindgen_malloc),o=sr;return 0!==Jn.gkcollisiongeo_hitTest(this.ptr,n,r,i,o)}}async function br(t){void 0===t&&console.log("You must specify wasm location");const e={wbg:{}};e.wbg.__wbindgen_object_drop_ref=function(t){er(t)},e.wbg.__wbindgen_json_parse=function(t,e){return ar(JSON.parse(or(t,e)))},e.wbg.__wbindgen_json_serialize=function(t,e){const n=$n(e);var r=cr(JSON.stringify(void 0===n?null:n),Jn.__wbindgen_malloc,Jn.__wbindgen_realloc),i=sr;mr()[t/4+1]=i,mr()[t/4+0]=r},e.wbg.__wbindgen_number_new=function(t){return ar(t)},e.wbg.__wbindgen_string_new=function(t,e){return ar(or(t,e))},e.wbg.__wbg_new_59cb74e423758ede=function(){return ar(new Error)},e.wbg.__wbg_stack_558ba5917b466edd=function(t,e){var n=cr($n(e).stack,Jn.__wbindgen_malloc,Jn.__wbindgen_realloc),r=sr;mr()[t/4+1]=r,mr()[t/4+0]=n},e.wbg.__wbg_error_4bb6c2a97407129a=function(t,e){try{console.error(or(t,e))}finally{Jn.__wbindgen_free(t,e)}},e.wbg.__wbg_debug_7020dcb48edf105b=function(t){console.debug($n(t))},e.wbg.__wbg_error_b23efba5bfb5cec5=function(t){console.error($n(t))},e.wbg.__wbg_info_8ce99578d0b91a35=function(t){console.info($n(t))},e.wbg.__wbg_log_c180b836187d3c94=function(t){console.log($n(t))},e.wbg.__wbg_warn_942f927afebcc748=function(t){console.warn($n(t))},e.wbg.__wbindgen_cb_drop=function(t){const e=er(t).original;if(1==e.cnt--)return e.a=0,!0;return!1},e.wbg.__wbg_call_d713ea0274dfc6d2=function(t){return function(){try{return t.apply(this,arguments)}catch(t){Jn.__wbindgen_exn_store(ar(t))}}}((function(t,e,n){return ar($n(t).call($n(e),$n(n)))})),e.wbg.__wbg_new_d0c63652ab4d825c=function(t,e){try{var n={a:t,b:e},r=new Promise((t,e)=>{const r=n.a;n.a=0;try{return function(t,e,n,r){Jn.wasm_bindgen__convert__closures__invoke2_mut__h8bf6a25e700c374c(t,e,ar(n),ar(r))}(r,n.b,t,e)}finally{n.a=r}});return ar(r)}finally{n.a=n.b=0}},e.wbg.__wbg_resolve_2529512c3bb73938=function(t){return ar(Promise.resolve($n(t)))},e.wbg.__wbg_then_4a7a614abbbe6d81=function(t,e){return ar($n(t).then($n(e)))},e.wbg.__wbindgen_throw=function(t,e){throw new Error(or(t,e))},e.wbg.__wbindgen_rethrow=function(t){throw er(t)},e.wbg.__wbindgen_closure_wrapper2042=function(t,e,n){return ar(function(t,e,n,r){const i={a:t,b:e,cnt:1,dtor:n},o=(...t)=>{i.cnt++;const e=i.a;i.a=0;try{return r(e,i.b,...t)}finally{0==--i.cnt?Jn.__wbindgen_export_2.get(i.dtor)(e,i.b):i.a=e}};return o.original=i,o}(t,e,61,hr))},("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:r}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if("application/wasm"==t.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,e);return Jn=n.exports,br.__wbindgen_wasm_module=r,Jn}var wr=function(){function t(){var e=this;n(this,t),o(this,"id",null),o(this,"geometry",null),o(this,"collisionGeometry",null),o(this,"material",null),o(this,"_translation",[0,0,0]),o(this,"_rotation",[0,0,0]),o(this,"_scale",[1,1,1]),o(this,"_modelMatrix",null),o(this,"_modelIsDirty",!0),o(this,"rayCast",!0),o(this,"isInteractive",!1),o(this,"isSelectable",!1),o(this,"isHoverable",!1),o(this,"shouldDraw",!0),o(this,"setInteractive",(function(t,n,r){e.isInteractive="boolean"==typeof t&&t,e.isSelectable="boolean"==typeof n&&n,e.isHoverable="boolean"==typeof r&&r})),this.id="_"+Math.random().toString(36).substr(2,9)}return i(t,[{key:"update",value:function(t){var e=this;t&&Object.entries(t).forEach((function(t){e.material.uniforms[t[0]]=t[1]}))}},{key:"isReady",get:function(){return!(!this.geometry||!this.material)&&(this.geometry.isReady&&this.material.isReady)}},{key:"translation",get:function(){return this._translation},set:function(t){this._translation=t,this._modelIsDirty=!0}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this._modelIsDirty=!0}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this._modelIsDirty=!0}},{key:"modelMatrix",get:function(){if(this._modelIsDirty){var t=F.identity(),e=F.translation(this._translation,t),n=F.scaling(this._scale);this._modelMatrix=e,F.rotateX(e,this._rotation[0],this._modelMatrix),F.rotateY(e,this._rotation[1],this._modelMatrix),F.rotateZ(e,this._rotation[2],this._modelMatrix),F.multiply(this._modelMatrix,n,this._modelMatrix),this._modelIsDirty=!1}return this._modelMatrix}}]),t}(),Ar=function(t){u(r,t);var e=h(r);function r(){return n(this,r),e.apply(this,arguments)}return r}(wr),Cr=function(){function t(e){var r=this;n(this,t),o(this,"isInit",!1),o(this,"isDirty",!1),o(this,"needsResize",!1),o(this,"bufferInfo",void 0),o(this,"vertices",void 0),o(this,"init",(function(t){0===Object.keys(r.vertices).length&&r.vertices.constructor===Object||(Object.keys(r.vertices).forEach((function(e){"DYNAMIC_DRAW"===r.vertices[e].drawType&&(r.vertices[e].drawType=t.DYNAMIC_DRAW)})),r.bufferInfo=$(t,r.vertices),r.isInit=!0,r.isDirty=!1)})),o(this,"resizeVertices",(function(){})),o(this,"updateGeometry",(function(t,e){void 0!==e&&"number"==typeof e||(e=0),Object.keys(t).forEach((function(n){for(var i=r.vertices[n].perInstance*e,o=0;o<t[n].data.length;o+=1)r.vertices[n].data[o+i]=t[n].data[o]})),r.isDirty=!0})),o(this,"updateBuffers",(function(t){Object.keys(r.bufferInfo.attribs).forEach((function(e){!function(t,e,n,r){n=Z(n),void 0!==r?(t.bindBuffer(34962,e.buffer),t.bufferSubData(34962,r,n)):U(t,34962,e.buffer,n,e.drawType)}(t,r.bufferInfo.attribs[e],r.vertices[e])})),r.isDirty=!1})),o(this,"reloadBuffers",(function(t){r.deleteBuffers(t),r.bufferInfo=$(t,r.vertices),r.isDirty=!1,r.needsResize=!1})),o(this,"deleteBuffers",(function(t){Object.keys(r.bufferInfo.attribs).forEach((function(e){t.deleteBuffer(e.buffer)})),t.deleteBuffer(r.bufferInfo.indices),r.bufferInfo={}})),this.vertices="sphere"===e?Qt.createSphereVertices(1,128,128):{}}return i(t,[{key:"isReady",get:function(){return this.isInit}}]),t}(),Tr={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec3 normal;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;uniform float shadowPower;varying float vAlpha;varying vec2 vTexture;void main(){vec4 pos=u_worldViewProjection*u_model*position;vec4 transformedCamera=vec4(-0.5,1.0,-1.0,1.0)*u_worldViewProjection;vAlpha=pow((1.0+(dot(normal,normalize(transformedCamera.xyz))))/2.0,shadowPower);vTexture=texcoord;gl_Position=pos;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D uTexture;varying float vAlpha;varying vec2 vTexture;vec3 yellow=vec3(255.0/255.0,210.0/255.0,28.0/255.0);void main(){vec4 textureColor=texture2D(uTexture,vec2(vTexture.x-0.25,vTexture.y));float alpha=vAlpha+(1.0-vAlpha)*0.05;alpha*=0.9;gl_FragColor=vec4(textureColor.rgb*vAlpha,1.0);}"},Ir={shadowPower:.3},Pr=function(t){u(r,t);var e=h(r);function r(t){var i,a;return n(this,r),o(f(a=e.call(this)),"material",null),o(f(a),"init",(function(t,e){a.geometry=new Cr("sphere"),a.geometry.init(t);var n={surface:{src:a.textureSrc.surface,minMag:t.LINEAR,wrap:t.REPEAT}};a.material.init(t),a.material.loadTextures(t,n,(function(){a.material.uniforms.uTexture=a.material.textures.surface,e&&e()})),a.material.uniforms.uModelMatrix=a.modelMatrix})),o(f(a),"createCollisionGeo",(function(){a.collisionGeometry&&a.collisionGeometry instanceof _r||(a.collisionGeometry=gr.create_collision_geometry(a.geometry.vertices.position,a.geometry.vertices.texcoord,a.geometry.vertices.indices))})),o(f(a),"rayCastFrom",(function(t){return a.collisionGeometry.raycast(t.origin,t.direction)})),o(f(a),"hitTest",(function(t){return a.collisionGeometry.hitTest(t.origin,t.direction)})),o(f(a),"onSelection",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix})),o(f(a),"draw",(function(t){a.isReady&&a.shouldDraw&&(t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElements(t.TRIANGLES,a.geometry.bufferInfo.numElements,t.UNSIGNED_SHORT,0))})),o(f(a),"setShadowPower",(function(t){console.log(t,"ShadowPower"),a.material.uniforms.shadowPower=t})),a.material=new Zn(Tr),a.material.uniforms=Ir,a.textureSrc={surface:t},a}return r}(Ar),Sr=function t(e,r){var i=this;n(this,t),o(this,"isLoaded",!1),o(this,"ctx",void 0),o(this,"canvas",void 0),o(this,"image",void 0),o(this,"getIdFromLatLon",(function(t,e){if(i.isLoaded){var n=1-(t/90+1)/2,r=(e/180+1)/2*i.canvas.width,o=n*i.canvas.height;return i.ctx.getImageData(r,o,1,1).data[0]}})),this.image=new Image,this.image.src=e,this.image.addEventListener("load",(function(){i.canvas=document.createElement("canvas"),i.canvas.width=i.image.width,i.canvas.height=i.image.height,i.ctx=i.canvas.getContext("2d"),i.ctx.drawImage(i.image,0,0),i.isLoaded=!0,r&&r()}))},Er=function t(e,r){var i=this;n(this,t),o(this,"isInit",!1),o(this,"useImageLookup",!1),o(this,"imageLookup",null),o(this,"getIdFromLatLon",(function(t,e){return i.imageLookup.getIdFromLatLon(t,e)})),o(this,"getFromId",(function(t){return i.data.find((function(e){return e.id===t}))})),o(this,"getFromCode",(function(t){return i.data.find((function(e){return e.code===t}))})),o(this,"getFromName",(function(t){return i.data.find((function(e){return e.name===t}))})),e instanceof Array&&(this.data=e,r&&(this.useImageLookup=!0,this.imageLookup=new Sr(r,(function(){i.isInit=!0}))))},Lr=function(){function t(){n(this,t)}return i(t,null,[{key:"radiansForPosition",value:function(t,e){return e>0?t>=0?Math.atan(t/e):2*Math.PI+Math.atan(t/e):e<0?Math.PI+Math.atan(t/e):t>0?Math.PI/2:3*Math.PI/2}},{key:"latLonFromWorld",value:function(t){var e=In();Mn(e,t);for(var n=Math.asin(e[1]),r=this.radiansForPosition(e[0],e[2]),i=180*n/Math.PI,o=180*r/Math.PI;o>180;)o-=360;return{lat:i,lon:o}}},{key:"distanceBetweenPoints",value:function(t,e){var n=function(t){return t*(Math.PI/180)},r=n(t.lat),i=n(e.lat),o=n(e.lat-t.lat),a=n(e.lon-t.lon),s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r)*Math.cos(i)*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}},{key:"worldFromLatLon",value:function(t,e,n){var r=n||0,i=t*Math.PI/180,o=e*Math.PI/180,a=Math.cos(i),s=Math.sin(i),u=Pn(Math.sin(o)*a,s,Math.cos(o)*a),l=In();return Mn(l,u),Sn(u,u,Ln(l,l,r)),u}},{key:"dotBetweenLatLon",value:function(e,n){return zn(t.worldFromLatLon(e[0],e[1]),t.worldFromLatLon(n[0],n[1]))}},{key:"hexToRGB",value:function(t,e){var n=0,r=0,i=0,o=!1!==e;return 4===t.length?(n="0x".concat(t[1]).concat(t[1]),r="0x".concat(t[2]).concat(t[2]),i="0x".concat(t[3]).concat(t[3])):7===t.length&&(n="0x".concat(t[1]).concat(t[2]),r="0x".concat(t[3]).concat(t[4]),i="0x".concat(t[5]).concat(t[6])),o?(n/=255,r/=255,i/=255):(n=parseInt(n,16),r=parseInt(r,16),i=parseInt(i,16)),[n,r,i]}},{key:"hexToRGBA",value:function(t,e,n){var r=this.hexToRGB(t,n),i=!1!==n?e:255*e;return[r[0],r[1],r[2],i]}},{key:"isSubSet",value:function(t,e){return t.every((function(t){return void 0!==e.find((function(e){return e===t}))}))}},{key:"lerpColor",value:function(t,e,n){var r=this.hexToRGB(t),i=this.hexToRGB(e),o=Pn(r[0],r[1],r[2]),a=Pn(i[0],i[1],i[2]),s=In();return Rn(s,o,a,n),s}}]),t}();o(Lr,"RGBToHex",(function(t,e,n){var r=t.toString(16),i=e.toString(16),o=n.toString(16);return 1===r.length&&(r="0".concat(r)),1===i.length&&(i="0".concat(i)),1===o.length&&(o="0".concat(o)),"#".concat(r).concat(i).concat(o)}));var Mr=function(){function t(e,r,i,a){var u=this;n(this,t),o(this,"time",void 0),o(this,"delay",0),o(this,"ease",(function(t){return t})),o(this,"onComplete",(function(t){})),o(this,"onUpdate",(function(t){})),o(this,"endAt",void 0),o(this,"isNumeric",!1),o(this,"toObj",null),o(this,"fromObj",null),o(this,"currentObj",null),o(this,"mechanism",(function(){if(u.isRunning){if(u.stopped)return!1;var t=u.endAt-(new Date).getTime();t<=0?(clearTimeout(u.playTimeout),u.stopped=!0,u.advanceFrame(1,1),u.isNumeric?u.onUpdate(u.currentObj.value):u.onUpdate(u.currentObj),u.onComplete(!0),u.cleanup()):(u.advanceFrame(u.time-t,u.time),u.isNumeric?u.onUpdate(u.currentObj.value):u.onUpdate(u.currentObj))}})),a=a||{},this.time=i,this.endAt=(new Date).getTime()+this.time,this.isNumeric=!isNaN(e),this.isNumeric?(this.toObj={value:r},this.fromObj={value:e}):(this.toObj=s({},r),this.fromObj=s({},e)),this.currentObj=s({},this.fromObj),this.id=t.getId(),t.tweens[this.id]=this,a.onComplete&&(this.onComplete=a.onComplete,delete a.onComplete),a.onUpdate&&(this.onUpdate=a.onUpdate,delete a.onUpdate),a.ease&&(this.ease=a.ease,delete a.ease),a.delay&&(this.endAt+=a.delay,this.delay=a.delay,delete a.delay),this.playTimeout=setTimeout((function(){u.play()}),this.delay)}return i(t,[{key:"play",value:function(){this.endAt=(new Date).getTime()+this.time,this.isRunning=!0,t.isRunning||(t.isRunning=!0,requestAnimationFrame(t.mechanism))}},{key:"stop",value:function(){clearTimeout(this.playTimeout),this.stopped=!0,this.onComplete(!1),this.cleanup()}},{key:"currentValue",value:function(){return this.isNumeric?this.currentObj.value:this.currentObj}},{key:"cleanup",value:function(){this.isRunning=!1,delete t.tweens[this.id],0===Object.keys(t.tweens).length&&(t.isRunning=!1)}},{key:"advanceFrame",value:function(t,e){var n=0!==e?t/e:1;for(var r in n=this.ease(n),this.toObj){var i=this.fromObj[r],o=this.toObj[r]-i;this.currentObj[r]=i+o*n}}}]),t}();Mr.id=0,Mr.tweens={},Mr.killTweensOf=function(t){for(var e in Mr.tweens){var n=Mr.tweens[e];n.obj===t&&n.stop()}},Mr.getId=function(){return++Mr.id},Mr.isRunning=!1,Mr.mechanism=function(){for(var t in Mr.tweens)Mr.tweens[t].mechanism();Mr.isRunning&&requestAnimationFrame(Mr.mechanism)};var zr=function t(e,r){var i=this;n(this,t),o(this,"width",4),o(this,"height",4),o(this,"channels",4),o(this,"elementLength",1),o(this,"data",void 0),o(this,"texture",void 0),o(this,"isInit",!1),o(this,"init",(function(t){var e={width:i.width,height:i.height,mag:t.NEAREST,min:t.NEAREST,src:i.data};i.texture=ke(t,e),i.isInit=!0})),o(this,"updatePixel",(function(t,e,n,r){if(i.isInit){var o=new Uint8Array(e);t.bindTexture(t.TEXTURE_2D,i.texture),t.texSubImage2D(t.TEXTURE_2D,0,r,n,1,1,t.RGBA,t.UNSIGNED_BYTE,o)}})),o(this,"updatePixelId",(function(t,e,n){var r=Math.floor(n/i.width),o=n-r*i.width;e.forEach((function(t,e){i.data[4*n+e]=t})),i.updatePixel(t,e,r,o)})),o(this,"updateSubrect",(function(t,e){i.isInit&&(t.bindTexture(t.TEXTURE_2D,i.texture),t.texSubImage2D(t.TEXTURE_2D,0,0,0,i.width,i.height,t.RGBA,t.UNSIGNED_BYTE,e))})),o(this,"getIdColor",(function(t){return i.data.slice(4*t,4*t+4)})),this.width=e||this.width,this.height=r||this.height,this.data=new Uint8Array(this.width*this.height*this.channels).fill(0)},Fr={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec3 normal;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;varying float vAlpha;varying vec2 vTexture;void main(){vec4 pos=u_worldViewProjection*u_model*position;vAlpha=dot(normalize(u_cameraPos),normalize(position.xyz));vTexture=texcoord;gl_Position=pos;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_inactive;uniform sampler2D u_active;uniform sampler2D u_id;uniform sampler2D u_data;uniform float u_idAnimateIn;uniform float u_idAnimateOut;uniform float u_animateIn;uniform float u_animateOut;uniform vec3 u_animateHover;uniform vec3 u_animatable0;uniform vec3 u_animatable1;uniform vec3 u_animatable2;uniform vec3 u_animatable3;uniform vec3 u_animatable4;uniform vec3 u_animatable5;varying float vAlpha;varying vec2 vTexture;float when_eq(float x,float y){return 1.0-abs(sign(x-y));}float when_lt(float x,float y){return max(sign(y-x),0.0);}vec2 get_data_coords_from_id(float id){float width=16.0;float height=16.0;float w_pixel=1.0/width;float h_pixel=1.0/height;float row=floor(id/width);float col=id-(row*width);return vec2(col*w_pixel,row*h_pixel);}void main(){vec4 inactiveColor=texture2D(u_inactive,vec2(vTexture.x-0.25,vTexture.y));vec4 activeColor=texture2D(u_active,vec2(vTexture.x-0.25,vTexture.y));vec4 idColor=texture2D(u_id,vec2(vTexture.x-0.25,vTexture.y));vec4 dataColor=texture2D(u_data,get_data_coords_from_id(floor(idColor.r*255.0)))*idColor.a;vec3 base=inactiveColor.rgb*(1.0-dataColor.a)+dataColor.rgb*(dataColor.a);vec3 color=base;gl_FragColor=vec4(color,1.0);}"},Rr={},Dr=function(t){u(r,t);var e=h(r);function r(t){var i,a;return n(this,r),o(f(a=e.call(this)),"material",null),o(f(a),"lookup",null),o(f(a),"currentSelection",-1),o(f(a),"previousSelection",-1),o(f(a),"inAnimation",null),o(f(a),"outAnimation",null),o(f(a),"currentHover",-1),o(f(a),"hoverables",[]),o(f(a),"hoverableUniforms",["u_animatable0","u_animatable1","u_animatable2","u_animatable3","u_animatable4","u_animatable5"]),o(f(a),"inAnimations",{}),o(f(a),"outAnimations",{}),o(f(a),"highlighedCountries",[]),o(f(a),"selection0",236),o(f(a),"selection1",144),o(f(a),"current",236),o(f(a),"dataTexture",void 0),o(f(a),"dataTextureSize",16),o(f(a),"updateCMDs",[]),o(f(a),"highlightAnimationProps",{start:0,stop:1,duration:1e3,onUpdate:function(t){a.material.uniforms.u_animateIn=t}}),o(f(a),"init",(function(t,e){a.geometry=new Cr("sphere"),a.geometry.init(t);var n={inactive:{src:a.textureSrc.inactive,minMag:t.LINEAR},active:{src:a.textureSrc.active,minMag:t.LINEAR},id:{src:a.textureSrc.id,minMag:t.NEAREST}};a.material.init(t),a.material.loadTextures(t,n,(function(){a.material.uniforms.u_inactive=a.material.textures.inactive,a.material.uniforms.u_active=a.material.textures.active,a.material.uniforms.u_id=a.material.textures.id,a.dataTexture.init(t),a.material.uniforms.u_data=a.dataTexture.texture,e&&e()}))})),o(f(a),"getValueForId",(function(t){return a.lookup.getFromId(t)})),o(f(a),"getValueForCode",(function(t){return a.lookup.getFromCode(t)})),o(f(a),"getValueForName",(function(t){return a.lookup.getFromName(t)})),o(f(a),"setIdColor",(function(t,e,n){var r=void 0===n?1:n,i=Lr.hexToRGBA(e,r,!1);a.updateCMDs.push((function(e){a.dataTexture.updatePixelId(e,i,t)}))})),o(f(a),"getIdColor",(function(t){var e=a.dataTexture.getIdColor(t);return{color:Lr.RGBToHex(e[0],e[1],e[2]),alpha:e[3]/255}})),o(f(a),"createCollisionGeo",(function(){a.collisionGeometry&&a.collisionGeometry instanceof _r||(a.collisionGeometry=gr.create_collision_geometry(a.geometry.vertices.position,a.geometry.vertices.texcoord,a.geometry.vertices.indices))})),o(f(a),"rayCastFrom",(function(t){return a.collisionGeometry.raycast(t.origin,t.direction)})),o(f(a),"hitTest",(function(t){return a.collisionGeometry.hitTest(t.origin,t.direction)})),o(f(a),"onSelectionCB",(function(){})),o(f(a),"onSelection",(function(t,e,n){var r=Lr.latLonFromWorld(n.point);return a.current=a.lookup.getIdFromLatLon(r.lat,r.lon),{id:a.current,name:a.lookup.getFromId(a.current)}})),o(f(a),"onHover",(function(t){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix,a.updateCMDs.forEach((function(e){e(t)})),a.updateCMDs=[]})),o(f(a),"draw",(function(t){a.isReady&&a.shouldDraw&&(t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElements(t.TRIANGLES,a.geometry.bufferInfo.numElements,t.UNSIGNED_SHORT,0))})),o(f(a),"setCountryHover",(function(t){})),o(f(a),"highlightId",(function(t,e,n,r,i){if(!(a.inAnimations[t]instanceof Mr)){var o=e||"#ffffff",s=n||1,u=r||!0,l=0;a.outAnimations[t]instanceof Mr&&(l=a.outAnimations[t].currentValue(),a.outAnimations[t].stop());var c=i||{};if(c.duration=c.duration||500,c.onComplete=c.onComplete||function(){},c.outDuration=c.outDuration||c.duration,c.onOutComplete=c.onOutComplete||function(){},u){var f={duration:c.outDuration,onComplete:c.onOutComplete};a.highlighedCountries.forEach((function(e){e!==t&&a.unhighlightId(e,f)}))}a.inAnimations[t]=new Mr(l,s,c.duration,{onUpdate:function(e){a.setIdColor(t,o,e)},onComplete:function(e){delete a.inAnimations[t],c.onComplete(e)}}),a.highlighedCountries.push(t)}})),o(f(a),"unhighlightId",(function(t,e){if(-1!==a.highlighedCountries.indexOf(t)&&!(a.outAnimations[t]instanceof Mr)){var n=e||{};n.duration=n.duration||500,n.onComplete=n.onComplete||function(){};var r=a.getIdColor(t),i=r.alpha;a.inAnimations[t]instanceof Mr&&(i=a.inAnimations[t].currentValue(),a.inAnimations[t].stop()),a.outAnimations[t]=new Mr(i,0,n.duration,{onUpdate:function(e){a.setIdColor(t,r.color,e)},onComplete:function(e){if(e){var r=a.highlighedCountries.indexOf(t);a.highlighedCountries.splice(r,1)}delete a.outAnimations[t],n.onComplete(e,t)}})}})),o(f(a),"addDataset",(function(t){a.lookup=new Er(t,a.textureSrc.id)})),a.material=new Zn(Fr),a.material.uniforms=Rr,a.textureSrc={inactive:t.inactive,active:t.active,id:t.id},a.dataTexture=new zr(a.dataTextureSize,a.dataTextureSize),a}return r}(Ar),kr=function(){function t(){var e=this;n(this,t),o(this,"springStrength",.2),o(this,"drag",.875),o(this,"poleBufferThreshold",18),o(this,"panDeltaScale",42),o(this,"velocityDeltaScale",750),o(this,"_ambientController",null),o(this,"_animationController",null),o(this,"_interactionController",null),o(this,"_currentLatLonAlt",[0,0,4]),o(this,"_interactionStartLatLonAlt",null),o(this,"_interactionTargetLatLonAlt",null),o(this,"_latLonVelocity",[0,0,0]),o(this,"_ambientLonDirection",1),o(this,"_ambientLatIn",0),o(this,"_ambientLatDirection",1),o(this,"_prevTime",0),o(this,"_rotBounded",(function(t){return[Math.max(Math.min(t[0],90),-90),t[1]]})),o(this,"_rotSprung",(function(t){var n=.499*Math.PI,r=.499*-Math.PI,i=(90-e.poleBufferThreshold)/90,o=n*i,a=r*i,s=t[0]*(Math.PI/180),u=function(t){return Math.sin(t*Math.PI/2)},l=s;if(s>o){var c=s-o,f=n-o;l=o+f*u(Math.min(c/f,1))}if(s<a){var m=s-a,h=r-a;l=a+h*u(Math.min(m/h,1))}return[l*(180/Math.PI),t[1]]})),o(this,"_frustumDist",(function(t,e){return.5*t/Math.tan(.5*e*(Math.PI/180))})),o(this,"_rotForDelta",(function(t){var n=p(e._currentLatLonAlt,3)[2],r=t[0]*(e.pointsPerRadian*(n/e.zFullWidth)),i=t[1]*(e.pointsPerRadian*(n/e.zFullWidth)),o=180/Math.PI;return[-r*o,i*o]})),o(this,"_calcAmbientLatIn",(function(t){var n=t*(Math.PI/180)/(.5*Math.PI)*(90/(e._ambientController.latitudeVariance/2));return Math.abs(n)>1&&(n/=Math.abs(n)),Math.asin(n)}))}return i(t,[{key:"register",value:function(t,e,n){this._ambientController=t,this._animationController=e,this._interactionController=n}},{key:"resize",value:function(t,e,n,r){this.pointsPerRadian=Math.PI/(t/window.devicePixelRatio),this.camFov=r,this.camAspect=n,this.zFullWidth=this._frustumDist(1/this.camAspect*2,this.camFov)}},{key:"setLatLonAlt",value:function(t,e,n){this.setLatLon(t,e),this.setAlt(n)}},{key:"setLatLon",value:function(t,e){for(this._currentLatLonAlt=[t,e,this._currentLatLonAlt[2]],this._ambientLatIn=this._calcAmbientLatIn(t);this._currentLatLonAlt[1]>180;)this._currentLatLonAlt[1]-=360;for(;this._currentLatLonAlt[1]<-180;)this._currentLatLonAlt[1]+=360;this._animationController.cancelLatLon()}},{key:"setAlt",value:function(t){this._currentLatLonAlt=[this._currentLatLonAlt[0],this._currentLatLonAlt[1],t],this._animationController.cancelAlt()}},{key:"update",value:function(t,e){var n=t-this._prevTime;this.fov=e,this._updateAlt(n),this._updateLatLon(n),this._prevTime=t}},{key:"startPan",value:function(t){for(;this._currentLatLonAlt[1]>180;)this._currentLatLonAlt[1]-=360;for(;this._currentLatLonAlt[1]<-180;)this._currentLatLonAlt[1]+=360;this._interactionStartLatLonAlt=v(this._currentLatLonAlt);var e=this.panDeltaScale/devicePixelRatio,n=[t.deltaY*e,t.deltaX*e],r=p(this._currentLatLonAlt,3)[2],i=this._rotForDelta([this._interactionStartLatLonAlt[0]-n[0],this._interactionStartLatLonAlt[1]-n[1]]);this._interactionTargetLatLonAlt=[this._interactionStartLatLonAlt[0]+i[0],this._interactionStartLatLonAlt[1]+i[1],r],this._latLonVelocity=[0,0,0]}},{key:"continuePan",value:function(t){if(this._interactionStartLatLonAlt){var e=this.panDeltaScale/devicePixelRatio,n=[t.deltaY*e,t.deltaX*e],r=this._rotForDelta([this._interactionStartLatLonAlt[0]-n[0],this._interactionStartLatLonAlt[1]-n[1]]),i=this.velocityDeltaScale/devicePixelRatio,o=this._rotForDelta([t.velocityY,t.velocityX]);this._latLonVelocity=[-o[0]*i,-o[1]*i],this._ambientLonDirection=o[1]<0?1:-1;var a=p(this._interactionTargetLatLonAlt,3)[2],s=this._rotBounded([this._interactionStartLatLonAlt[0]+r[0],this._interactionStartLatLonAlt[1]+r[1]]);this._interactionTargetLatLonAlt=[s[0],s[1],a],this._lastGestureChange=t.timeStamp}}},{key:"endPan",value:function(t){this._interactionStartLatLonAlt=null,this._interactionTargetLatLonAlt=null;var e=t.timeStamp-this._lastGestureChange;this._ambientLatIn=this._calcAmbientLatIn(this._currentLatLonAlt[0]),e>.1&&(this._latLonVelocity=[0,0])}},{key:"_updateAlt",value:function(){if(this._animationController.isAnimatingAlt){var t=p(this._currentLatLonAlt,2),e=t[0],n=t[1];this._currentLatLonAlt=[e,n,this._animationController.currentAlt]}}},{key:"_updateLatLon",value:function(t){var e=p(this._currentLatLonAlt,3),n=e[0],r=e[1],i=e[2];if(this._interactionTargetLatLonAlt){var o=p(this._interactionTargetLatLonAlt,2),a=[o[0]-n,o[1]-r];this._currentLatLonAlt=[n+a[0]*this.springStrength,r+a[1]*this.springStrength,i]}else{var s=this._rotBounded([n+this._latLonVelocity[0],r+this._latLonVelocity[1]]);this._currentLatLonAlt=[s[0],s[1],i];var u=90-this.poleBufferThreshold,l=-90+this.poleBufferThreshold;if(s[0]>u){var c=s[0]-u;this._currentLatLonAlt[0]=u+.95*c}if(s[0]<l){var f=s[0]-l;this._currentLatLonAlt[0]=l+.95*f}if(this._latLonVelocity=[this._latLonVelocity[0]*this.drag,this._latLonVelocity[1]*this.drag],this._ambientController.isEnabled){var m=this._ambientController.ambientStrength,h=this._ambientLonDirection,d=this._ambientController.longitudeSpeed,v=p(this._currentLatLonAlt,2),y=v[0],g=v[1];g+=d*h*m,Math.abs(this._latLonVelocity[0])>1e-4&&(this._ambientLatIn=this._calcAmbientLatIn(n));var _=this._ambientController.latitudeSpeed;this._ambientLatIn+=t*this._ambientLatDirection*_*m;var x=this._ambientController.latitudeVariance/2;y+=(Math.sin(this._ambientLatIn)*x-y)*m*m,this._currentLatLonAlt=[y,g,i]}if(this._animationController.isAnimatingLatLon){var b=this._animationController.currentLatLon;this._currentLatLonAlt=[b[0],b[1],i]}else{for(;this._currentLatLonAlt[1]>180;)this._currentLatLonAlt[1]-=360;for(;this._currentLatLonAlt[1]<-180;)this._currentLatLonAlt[1]+=360}}}},{key:"currentLatLonAlt",get:function(){return v(this._currentLatLonAlt)}}]),t}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Or(t,e){return t(e={exports:{}},e.exports),e.exports}Or((function(t){
/*! Hammer.JS - v2.0.8 - 2016-04-23
     * http://hammerjs.github.io/
     *
     * Copyright (c) 2016 Jorik Tangelder;
     * Licensed under the MIT license */
!function(n,r,i,o){function a(t,e,n){return setTimeout(f(t,n),e)}function s(t,e,n){return!!Array.isArray(t)&&(u(t,n[e],n),!0)}function u(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==o)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function l(t,e,r){var i="DEPRECATED METHOD: "+e+"\n"+r+" AT \n";return function(){var e=new Error("get-stack-trace"),r=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=n.console&&(n.console.warn||n.console.log);return o&&o.call(n.console,i,r),t.apply(this,arguments)}}function c(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&ot(r,n)}function f(t,e){return function(){return t.apply(e,arguments)}}function m(t,n){return e(t)==ut?t.apply(n&&n[0]||o,n):t}function h(t,e){return t===o?e:t}function d(t,e,n){u(g(e),(function(e){t.addEventListener(e,n,!1)}))}function p(t,e,n){u(g(e),(function(e){t.removeEventListener(e,n,!1)}))}function v(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function y(t,e){return t.indexOf(e)>-1}function g(t){return t.trim().split(/\s+/g)}function _(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function x(t){return Array.prototype.slice.call(t,0)}function b(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];_(i,a)<0&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function w(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),a=0;a<at.length;){if((r=(n=at[a])?n+i:e)in t)return r;a++}return o}function A(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||n}function C(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){m(t.options.enable,[t])&&n.handler(e)},this.init()}function T(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,o=e&bt&&r-i==0,a=e&(At|Ct)&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=P(e)),i>1&&!n.firstMultiple?n.firstMultiple=P(e):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=e.center=S(r);e.timeStamp=ft(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=z(s,u),e.distance=M(s,u),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};e.eventType!==bt&&o.eventType!==At||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=L(e.deltaX,e.deltaY);var l=E(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=ct(l.x)>ct(l.y)?l.x:l.y,e.scale=a?function(t,e){return M(e[0],e[1],Rt)/M(t[0],t[1],Rt)}(a.pointers,r):1,e.rotation=a?function(t,e){return z(e[1],e[0],Rt)+z(t[1],t[0],Rt)}(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,I(n,e);var c=t.element;v(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function I(t,e){var n,r,i,a,s=t.lastInterval||e,u=e.timeStamp-s.timeStamp;if(e.eventType!=Ct&&(u>xt||s.velocity===o)){var l=e.deltaX-s.deltaX,c=e.deltaY-s.deltaY,f=E(u,l,c);r=f.x,i=f.y,n=ct(f.x)>ct(f.y)?f.x:f.y,a=L(l,c),t.lastInterval=e}else n=s.velocity,r=s.velocityX,i=s.velocityY,a=s.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=a}function P(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:lt(t.pointers[n].clientX),clientY:lt(t.pointers[n].clientY)},n++;return{timeStamp:ft(),pointers:e,center:S(e),deltaX:t.deltaX,deltaY:t.deltaY}}function S(t){var e=t.length;if(1===e)return{x:lt(t[0].clientX),y:lt(t[0].clientY)};for(var n=0,r=0,i=0;e>i;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:lt(n/e),y:lt(r/e)}}function E(t,e,n){return{x:e/t||0,y:n/t||0}}function L(t,e){return t===e?Tt:ct(t)>=ct(e)?0>t?It:Pt:0>e?St:Et}function M(t,e,n){n||(n=Ft);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function z(t,e,n){n||(n=Ft);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}function F(){this.evEl=kt,this.evWin=Ot,this.pressed=!1,C.apply(this,arguments)}function R(){this.evEl=Gt,this.evWin=Nt,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function D(){this.evTarget=Vt,this.evWin=Wt,this.started=!1,C.apply(this,arguments)}function k(t,e){var n=x(t.touches),r=x(t.changedTouches);return e&(At|Ct)&&(n=b(n.concat(r),"identifier",!0)),[n,r]}function O(){this.evTarget=Ht,this.targetIds={},C.apply(this,arguments)}function j(t,e){var n=x(t.touches),r=this.targetIds;if(e&(bt|wt)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=x(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return v(t.target,u)})),e===bt)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),e&(At|Ct)&&delete r[a[i].identifier],i++;return s.length?[b(o.concat(s),"identifier",!0),s]:void 0}function B(){C.apply(this,arguments);var t=f(this.handler,this);this.touch=new O(this.manager,t),this.mouse=new F(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function G(t,e){t&bt?(this.primaryTouch=e.changedPointers[0].identifier,N.call(this,e)):t&(At|Ct)&&N.call(this,e)}function N(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),Xt)}}function U(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(qt>=o&&qt>=a)return!0}return!1}function V(t,e){this.manager=t,this.set(e)}function W(t){this.options=ot({},this.defaults,t||{}),this.id=dt++,this.manager=null,this.options.enable=h(this.options.enable,!0),this.state=ie,this.simultaneous={},this.requireFail=[]}function Y(t){return t&le?"cancel":t&se?"end":t&ae?"move":t&oe?"start":""}function H(t){return t==Et?"down":t==St?"up":t==It?"left":t==Pt?"right":""}function X(t,e){var n=e.manager;return n?n.get(t):t}function q(){W.apply(this,arguments)}function K(){q.apply(this,arguments),this.pX=null,this.pY=null}function Z(){q.apply(this,arguments)}function J(){W.apply(this,arguments),this._timer=null,this._input=null}function Q(){q.apply(this,arguments)}function $(){q.apply(this,arguments)}function tt(){W.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function et(t,e){return(e=e||{}).recognizers=h(e.recognizers,et.defaults.preset),new nt(t,e)}function nt(t,e){this.options=ot({},et.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function(t){var e=t.options.inputClass;return new(e||(vt?R:yt?O:pt?B:F))(t,T)}(this),this.touchAction=new V(this,this.options.touchAction),rt(this,!0),u(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function rt(t,e){var n,r=t.element;r.style&&(u(t.options.cssProps,(function(i,o){n=w(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}function it(t,e){var n=r.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}var ot,at=["","webkit","Moz","MS","ms","o"],st=r.createElement("div"),ut="function",lt=Math.round,ct=Math.abs,ft=Date.now;ot="function"!=typeof Object.assign?function(t){if(t===o||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==o&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var mt=l((function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&t[r[i]]===o)&&(t[r[i]]=e[r[i]]),i++;return t}),"extend","Use `assign`."),ht=l((function(t,e){return mt(t,e,!0)}),"merge","Use `assign`."),dt=1,pt="ontouchstart"in n,vt=w(n,"PointerEvent")!==o,yt=pt&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),gt="touch",_t="mouse",xt=25,bt=1,wt=2,At=4,Ct=8,Tt=1,It=2,Pt=4,St=8,Et=16,Lt=It|Pt,Mt=St|Et,zt=Lt|Mt,Ft=["x","y"],Rt=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(A(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(A(this.element),this.evWin,this.domHandler)}};var Dt={mousedown:bt,mousemove:wt,mouseup:At},kt="mousedown",Ot="mousemove mouseup";c(F,C,{handler:function(t){var e=Dt[t.type];e&bt&&0===t.button&&(this.pressed=!0),e&wt&&1!==t.which&&(e=At),this.pressed&&(e&At&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:_t,srcEvent:t}))}});var jt={pointerdown:bt,pointermove:wt,pointerup:At,pointercancel:Ct,pointerout:Ct},Bt={2:gt,3:"pen",4:_t,5:"kinect"},Gt="pointerdown",Nt="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(Gt="MSPointerDown",Nt="MSPointerMove MSPointerUp MSPointerCancel"),c(R,C,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=jt[r],o=Bt[t.pointerType]||t.pointerType,a=o==gt,s=_(e,t.pointerId,"pointerId");i&bt&&(0===t.button||a)?0>s&&(e.push(t),s=e.length-1):i&(At|Ct)&&(n=!0),0>s||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var Ut={touchstart:bt,touchmove:wt,touchend:At,touchcancel:Ct},Vt="touchstart",Wt="touchstart touchmove touchend touchcancel";c(D,C,{handler:function(t){var e=Ut[t.type];if(e===bt&&(this.started=!0),this.started){var n=k.call(this,t,e);e&(At|Ct)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:gt,srcEvent:t})}}});var Yt={touchstart:bt,touchmove:wt,touchend:At,touchcancel:Ct},Ht="touchstart touchmove touchend touchcancel";c(O,C,{handler:function(t){var e=Yt[t.type],n=j.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:gt,srcEvent:t})}});var Xt=2500,qt=25;c(B,C,{handler:function(t,e,n){var r=n.pointerType==gt,i=n.pointerType==_t;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)G.call(this,e,n);else if(i&&U.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Kt=w(st.style,"touchAction"),Zt=Kt!==o,Jt="compute",Qt="auto",$t="manipulation",te="none",ee="pan-x",ne="pan-y",re=function(){if(!Zt)return!1;var t={},e=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){t[r]=!e||n.CSS.supports("touch-action",r)})),t}();V.prototype={set:function(t){t==Jt&&(t=this.compute()),Zt&&this.manager.element.style&&re[t]&&(this.manager.element.style[Kt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return u(this.manager.recognizers,(function(e){m(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(y(t,te))return te;var e=y(t,ee),n=y(t,ne);return e&&n?te:e||n?e?ee:ne:y(t,$t)?$t:Qt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(!this.manager.session.prevented){var r=this.actions,i=y(r,te)&&!re[te],o=y(r,ne)&&!re[ne],a=y(r,ee)&&!re[ee];if(i){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}return a&&o?void 0:i||o&&n&Lt||a&&n&Mt?this.preventSrc(e):void 0}e.preventDefault()},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var ie=1,oe=2,ae=4,se=8,ue=se,le=16;W.prototype={defaults:{},set:function(t){return ot(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(s(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=X(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return s(t,"dropRecognizeWith",this)||(t=X(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(s(t,"requireFailure",this))return this;var e=this.requireFail;return-1===_(e,t=X(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(s(t,"dropRequireFailure",this))return this;t=X(t,this);var e=_(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){n.manager.emit(e,t)}var n=this,r=this.state;se>r&&e(n.options.event+Y(r)),e(n.options.event),t.additionalEvent&&e(t.additionalEvent),r>=se&&e(n.options.event+Y(r))},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=32)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|ie)))return!1;t++}return!0},recognize:function(t){var e=ot({},t);return m(this.options.enable,[this,e])?(this.state&(ue|le|32)&&(this.state=ie),this.state=this.process(e),void(this.state&(oe|ae|se|le)&&this.tryEmit(e))):(this.reset(),void(this.state=32))},process:function(t){},getTouchAction:function(){},reset:function(){}},c(q,W,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=e&(oe|ae),i=this.attrTest(t);return r&&(n&Ct||!i)?e|le:r||i?n&At?e|se:e&oe?e|ae:oe:32}}),c(K,q,{defaults:{event:"pan",threshold:10,pointers:1,direction:zt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Lt&&e.push(ne),t&Mt&&e.push(ee),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(e.direction&Lt?(i=0===o?Tt:0>o?It:Pt,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?Tt:0>a?St:Et,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return q.prototype.attrTest.call(this,t)&&(this.state&oe||!(this.state&oe)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=H(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),c(Z,q,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[te]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&oe)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),c(J,W,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Qt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||t.eventType&(At|Ct)&&!i)this.reset();else if(t.eventType&bt)this.reset(),this._timer=a((function(){this.state=ue,this.tryEmit()}),e.time,this);else if(t.eventType&At)return ue;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===ue&&(t&&t.eventType&At?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=ft(),this.manager.emit(this.options.event,this._input)))}}),c(Q,q,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[te]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&oe)}}),c($,q,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Lt|Mt,pointers:1},getTouchAction:function(){return K.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(Lt|Mt)?e=t.overallVelocity:n&Lt?e=t.overallVelocityX:n&Mt&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&ct(e)>this.options.velocity&&t.eventType&At},emit:function(t){var e=H(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),c(tt,W,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$t]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),t.eventType&bt&&0===this.count)return this.failTimeout();if(r&&i&&n){if(t.eventType!=At)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||M(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=a((function(){this.state=ue,this.tryEmit()}),e.interval,this),oe):ue}return 32},failTimeout:function(){return this._timer=a((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ue&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),et.VERSION="2.0.8",et.defaults={domEvents:!1,touchAction:Jt,enable:!0,inputTarget:null,inputClass:null,preset:[[Q,{enable:!1}],[Z,{enable:!1},["rotate"]],[$,{direction:Lt}],[K,{direction:Lt},["swipe"]],[tt],[tt,{event:"doubletap",taps:2},["tap"]],[J]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};nt.prototype={set:function(t){return ot(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var n,r=this.recognizers,i=e.curRecognizer;(!i||i&&i.state&ue)&&(i=e.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&n.state&(oe|ae|se)&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof W)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(s(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(s(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=_(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==o&&e!==o){var n=this.handlers;return u(g(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==o){var n=this.handlers;return u(g(t),(function(t){e?n[t]&&n[t].splice(_(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&it(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&rt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ot(et,{INPUT_START:bt,INPUT_MOVE:wt,INPUT_END:At,INPUT_CANCEL:Ct,STATE_POSSIBLE:ie,STATE_BEGAN:oe,STATE_CHANGED:ae,STATE_ENDED:se,STATE_RECOGNIZED:ue,STATE_CANCELLED:le,STATE_FAILED:32,DIRECTION_NONE:Tt,DIRECTION_LEFT:It,DIRECTION_RIGHT:Pt,DIRECTION_UP:St,DIRECTION_DOWN:Et,DIRECTION_HORIZONTAL:Lt,DIRECTION_VERTICAL:Mt,DIRECTION_ALL:zt,Manager:nt,Input:C,TouchAction:V,TouchInput:O,MouseInput:F,PointerEventInput:R,TouchMouseInput:B,SingleTouchInput:D,Recognizer:W,AttrRecognizer:q,Tap:tt,Pan:K,Swipe:$,Pinch:Z,Rotate:Q,Press:J,on:d,off:p,each:u,merge:ht,extend:mt,assign:ot,inherit:c,bindFn:f,prefixed:w}),(void 0!==n?n:"undefined"!=typeof self?self:{}).Hammer=et,t.exports?t.exports=et:n.Hammer=et}(window,document)}));var jr=function(){function t(e,r,i){var a=this;n(this,t),o(this,"targetElement",window),o(this,"targetDrawable",null),o(this,"camera",null),o(this,"boundingRect",null),o(this,"onTapCB",null),o(this,"onMouseMoveCB",null),o(this,"options",{tap:!0,pan:!0,pinch:!0}),o(this,"_movementModel",null),o(this,"_ambientController",null),o(this,"_animationController",null),o(this,"_isInteractive",!1),o(this,"resize",(function(){a.boundingRect=a.targetElement.getBoundingClientRect(),a._movementModel.resize(a.boundingRect.width,a.boundingRect.height,a.camera.aspect,a.camera.fov)})),o(this,"update",(function(){a._movementModel.update(a.camera.fov)})),o(this,"isOverTarget",(function(t,e){var n=t-a.boundingRect.x,r=e-a.boundingRect.y,i=n/a.boundingRect.width,o=(a.boundingRect.height-r)/a.boundingRect.height,s=a.camera.getRayFromScreen(i,o);return a.targetDrawable.hitTest(s)})),o(this,"onPanStart",(function(t){a.isOverTarget(t.center.x,t.center.y)&&(a._movementModel.startPan(t),a._ambientController.pauseMotion())})),o(this,"onPanContinue",(function(t){a._movementModel.continuePan(t)})),o(this,"onPanEnd",(function(t){a._movementModel.endPan(t),a._ambientController.isEnabled&&a._ambientController.resumeMotionAnimated()})),o(this,"onTap",(function(t){var e=t.center.x-a.boundingRect.x,n=t.center.y-a.boundingRect.y;a.onTapCB&&a.onTapCB(e,n)})),o(this,"onMouseMove",(function(t){var e=t.offsetX-a.boundingRect.x,n=t.offsetY-a.boundingRect.y;a.onMouseMoveCB&&a.onMouseMoveCB(e,n)})),e&&(this.targetElement=e,this.boundingRect=this.targetElement.getBoundingClientRect()),this.camera=r,i&&(i.tap&&(this.options.tap=i.tap),i.pan&&(this.options.pan=i.pan),i.pinch&&(this.options.pinch=i.pinch));var s=window.Hammer;this.hammer=s(this.targetElement,null),this.hammer.get("pan").set({direction:s.DIRECTION_ALL}),this.targetElement.addEventListener("mousemove",this.onMouseMove),this.isInteractive=!0}return i(t,[{key:"register",value:function(t,e,n){this._movementModel=n,this._movementModel.resize(this.boundingRect.width,this.boundingRect.height,this.camera.aspect,this.camera.fov),this._ambientController=t,this._animationController=e}},{key:"target",set:function(t){this.targetDrawable=t}},{key:"isInteractive",get:function(){return this._isInteractive},set:function(t){t!==this._isInteractive&&(t?(this.options.tap&&this.hammer.on("tap",this.onTap),this.options.pan&&this.hammer.on("panstart",this.onPanStart),this.options.pan&&this.hammer.on("pan",this.onPanContinue),this.options.pan&&this.hammer.on("panend",this.onPanEnd),this.options.pinch&&this.hammer.on("tap",this.onPinch),this._isInteractive=t):(this.options.tap&&this.hammer.off("tap",this.onTap),this.options.pan&&this.hammer.off("panstart",this.onPanStart),this.options.pan&&this.hammer.off("pan",this.onPanContinue),this.options.pan&&this.hammer.off("panend",this.onPanEnd),this.options.pinch&&this.hammer.off("tap",this.onPinch),this._isInteractive=t))}}]),t}(),Br=function(){function t(){n(this,t)}return i(t,null,[{key:"create",value:function(t,e,n,r){var i=3*t,o=3*(n-t)-i,a=1-i-o,s=3*e,u=3*(r-e)-s,l=1-s-u,c=function(t){return((a*t+o)*t+i)*t};return function(t){return function(t){return((l*t+u)*t+s)*t}(function(t,e){var n,r,s,u,l,f;s=t;for(var m=0;m<8;m++){if(u=c(s)-t,Math.abs(u)<e)return s;if(l=(3*a*(f=s)+2*o)*f+i,Math.abs(l)<1e-6)break;s-=u/l}if((s=t)<(n=0))return n;if(s>(r=1))return r;for(;n<r;){if(u=c(s),Math.abs(u-t)<e)return s;t>u?n=s:r=s,s=.5*(r-n)+n}return s}(t,1e-9))}}}]),t}(),Gr=function(){function t(){n(this,t),o(this,"_latLonTween",null),o(this,"_altTween",null),o(this,"_currentLatLon",null),o(this,"_currentAlt",null),o(this,"_movementModel",null),o(this,"_interactionController",null),o(this,"_ambientController",null)}return i(t,[{key:"register",value:function(t,e,n){this._movementModel=n,this._interactionController=e,this._ambientController=t}},{key:"animateLatLonAlt",value:function(e,n,r,i){var o=i||{};if(!o.duration&&0!==o.duration){var a=this._movementModel.currentLatLonAlt,u=[e,n];o.duration=t._defaultDuration(a,u)}this.animateLatLon(e,n,o),this.animateAlt(r,s(s({},o),{},{onComplete:null}))}},{key:"animateLatLon",value:function(e,n,r){var i=this,o=r||{},a=this._movementModel.currentLatLonAlt;this._currentLatLon=[a[0],a[1]];var s=v(this._currentLatLon),u=[e,n],l=n+360,c=n-360,f=Math.abs(n-s[1]),m=Math.abs(l-s[1]),h=Math.abs(c-s[1]);m<=h&&m<=f&&(u[1]=l),h<=f&&h<=m&&(u[1]=c);var d,p=o.duration;if(p||0===p||(p=t._defaultDuration(s,u)),d=o.ease&&"function"==typeof o.ease?o.ease:t._defaultLatLonEase(p),!this._ambientController.isPaused){var y=Math.min(250,p/4);this._ambientController.pauseMotionAnimated({duration:y})}this._latLonTween&&this._latLonTween.stop(),this._latLonTween=new Mr(0,1,p,{onUpdate:function(t){var e=d(t);i._currentLatLon=[s[0]+(u[0]-s[0])*e,s[1]+(u[1]-s[1])*e]},onComplete:function(t){t&&(i._latLonTween=null,i._currentLatLon=null,i._movementModel.setLatLon(u[0],u[1]),i._ambientController.isEnabled&&i._ambientController.isPaused&&i._ambientController.resumeMotionAnimated()),o.onComplete&&"function"==typeof o.onComplete&&o.onComplete(t)}})}},{key:"animateAlt",value:function(t,e){var n=this,r=e||{};this._currentAlt=this._movementModel.currentLatLonAlt[2];var i,o=this._currentAlt,a=t,s=r.duration;if(s||0===s||(s=500),i=r.ease&&"function"==typeof r.ease?r.ease:function(t){return t},!this._ambientController.isPaused){var u=Math.min(250,s/4);this._ambientController.pauseMotionAnimated({duration:u})}this._altTween&&this._altTween.stop(),this._altTween=new Mr(0,1,s,{onUpdate:function(t){var e=i(t);n._currentAlt=o+(a-o)*e},onComplete:function(t){t&&(n._altTween=null,n._currentAlt=null,n._movementModel.setAlt(a),n._ambientController.isEnabled&&n._ambientController.isPaused&&n._ambientController.resumeMotionAnimated()),r.onComplete&&"function"==typeof r.onComplete&&r.onComplete(t)}})}},{key:"cancelLatLonAlt",value:function(){this.cancelLatLon(),this.cancelAlt()}},{key:"cancelLatLon",value:function(){this._latLonTween&&(this._latLonTween.stop(),this._latLonTween=null,this._currentLatLon=null)}},{key:"cancelAlt",value:function(){this._altTween&&(this._altTween.stop(),this._altTween=null,this._currentAlt=null)}},{key:"isAnimatingLatLon",get:function(){return null!=this._latLonTween}},{key:"isAnimatingAlt",get:function(){return null!=this._altTween}},{key:"currentLatLon",get:function(){return this._currentLatLon}},{key:"currentAlt",get:function(){return this._currentAlt}}],[{key:"_defaultDuration",value:function(t,e){return 300+700*(1-(Lr.dotBetweenLatLon(t,e)+1)/2)}},{key:"_defaultLatLonEase",value:function(t){var e=t-350,n=.55+(.85-.55)*Math.min(Math.max(e/100,0),1);return Br.create(.315,.015,1-n,1)}}]),t}(),Nr=function(){function t(){n(this,t),o(this,"latitudeVariance",100),o(this,"latitudeSpeed",.5),o(this,"longitudeSpeed",.05),o(this,"isEnabled",!0),o(this,"_ambientStrength",1),o(this,"_ambientTween",null),o(this,"_isPaused",!1),o(this,"_movementController",null),o(this,"_animationController",null),o(this,"_interactionController",null)}return i(t,[{key:"register",value:function(t,e,n){this._movementModel=n,this._interactionController=e,this._animationController=t}},{key:"pauseMotion",value:function(){this._isPaused=!0,this._ambientTween&&this._ambientTween.stop(),this._ambientTween=null,this._ambientStrength=0}},{key:"pauseMotionAnimated",value:function(t){var e=this;this._isPaused=!0;var n,r=t||{},i=500;(r.duration||0===r.duration)&&(i=r.duration),n=r.ease&&"function"==typeof r.ease?r.ease:function(t){return t};var o=1;this._ambientTween&&(o=this._ambientTween.currentValue(),this._ambientTween.stop());this._ambientTween=new Mr(o,0,(o-0)*i,{onUpdate:function(t){e._ambientStrength=n(t)},onComplete:function(t){t&&(e._ambientTween=null),r.onComplete&&"function"==typeof r.onComplete&&r.onComplete(t)}})}},{key:"resumeMotion",value:function(){this._isPaused=!1,this._ambientTween.stop(),this._ambientTween=null,this._ambientStrength=1}},{key:"resumeMotionAnimated",value:function(t){var e=this;this._isPaused=!1;var n,r=t||{},i=1e3;(r.duration||0===r.duration)&&(i=r.duration),n=r.ease&&"function"==typeof r.ease?r.ease:function(t){return t};var o=0;this._ambientTween&&(o=this._ambientTween.currentValue(),this._ambientTween.stop());this._ambientTween=new Mr(o,1,(1-o)*i,{onUpdate:function(t){e._ambientStrength=1-n(1-t)},onComplete:function(t){t&&(e._ambientTween=null),r.onComplete&&"function"==typeof r.onComplete&&r.onComplete(t)}})}},{key:"ambientStrength",get:function(){return this._ambientStrength}},{key:"isPaused",get:function(){return this._isPaused}}]),t}(),Ur=function(){function t(e){var r=this;n(this,t),o(this,"_container",null),o(this,"_callouts",{}),o(this,"_calloutDefinitions",[]),o(this,"_currentlyRemoving",[]),o(this,"onAutoRemove",null),o(this,"autoRemoveCallouts",!0),o(this,"autoRemoveThresholdSimilarity",.5),o(this,"autoRemoveThresholdMargins",{top:0,right:0,left:0,bottom:0}),o(this,"shouldAutoRemoveCallout",null),e&&"DIV"===e.tagName?(this._container=e,this._container.style.pointerEvents="none",this.resizeObserver=new ResizeObserver((function(t){t.length&&(r.bounds=t[0].contentRect)})),this.resizeObserver.observe(this._container)):console.warn("CalloutManager expects a DIV element as a container."),this._removeCalloutComplete=this._removeCalloutComplete.bind(this)}return i(t,[{key:"release",value:function(){this.resizeObserver.disconnect()}},{key:"addCallout",value:function(t){this.replaceCallouts([].concat(v(this._calloutDefinitions),[t]))}},{key:"removeCallout",value:function(t){var e=this._calloutDefinitions.findIndex((function(e){return e.id===t.id}));-1!==e&&this.replaceCallouts([].concat(v(this._calloutDefinitions.slice(0,e)),v(this._calloutDefinitions.slice(e+1))))}},{key:"replaceCallouts",value:function(t){var e=this,n=t.filter((function(t){return!e._calloutDefinitions.includes(t)})),r=this._calloutDefinitions.filter((function(e){return!t.includes(e)})).filter((function(t){return!e._currentlyRemoving.includes(t)}));this._currentlyRemoving=[].concat(v(this._currentlyRemoving),v(r)),this._calloutDefinitions=[].concat(v(this._calloutDefinitions),v(n)),n.map((function(t){var n=t.calloutClass;if(n){var r=new n(t);if(e.positionProvider){var i=e.positionProvider([t]);r.setPosition(i[0])}return r}})).filter((function(t){return t})).forEach((function(t){e._callouts[t.definition.id]=t,e._container.appendChild(t.element),t.animateIn()})),r.map((function(t){return e._callouts[t.id]})).forEach((function(t){t.animateOut(e._removeCalloutComplete)}))}},{key:"removeAllCallouts",value:function(){this.replaceCallouts([])}},{key:"getCalloutForDefinition",value:function(t){return this._callouts[t.id]}},{key:"update",value:function(t){var e=this;if(this.positionProvider){var n=[],r=this.positionProvider(this._calloutDefinitions);this._calloutDefinitions.forEach((function(i,o){var a=e._callouts[i.id],s=r[o];if(a&&(a.setPosition(s),a.update(t)),e.autoRemoveCallouts){var u=e.autoRemoveThresholdSimilarity,l=e.autoRemoveThresholdMargins;(s.world.similarityToCameraVector<u||s.screen.x<l.left||s.screen.x>e.bounds.width-l.right||s.screen.y<l.top||s.screen.y>e.bounds.height-l.bottom)&&n.push(i)}})),n.forEach((function(t){e.shouldAutoRemoveCallout&&!e.shouldAutoRemoveCallout(t)||(e.removeCallout(t),e.onAutoRemove&&e.onAutoRemove(t))}))}}},{key:"_removeCalloutComplete",value:function(t){var e=t.definition.id,n=this._calloutDefinitions.findIndex((function(t){return t.id===e}));-1!==n&&(this._calloutDefinitions=[].concat(v(this._calloutDefinitions.slice(0,n)),v(this._calloutDefinitions.slice(n+1))),n=this._currentlyRemoving.findIndex((function(t){return t.id===e})),this._currentlyRemoving=[].concat(v(this._currentlyRemoving.slice(0,n)),v(this._currentlyRemoving.slice(n+1))),this._container.removeChild(this._callouts[e].element),this._callouts[e].release(),delete this._callouts[e])}},{key:"drawables",get:function(){var t=this;return this._calloutDefinitions.map((function(e){return t._callouts[e.id].drawables}))}}]),t}(),Vr=function(){function t(e,r,i){var a=this;n(this,t),o(this,"_wasmLoaded",!1),o(this,"isInit",!1),o(this,"shouldDraw",!1),o(this,"renderer",null),o(this,"scene",null),o(this,"targetDrawable",null),o(this,"calloutManager",null),o(this,"boundingRect",null),o(this,"_onWasmLoad",[]),o(this,"drawqueue",[]),o(this,"onInit",void 0),o(this,"onSelection",void 0),o(this,"onTap",void 0),o(this,"onUpdate",void 0),o(this,"_movementModel",null),o(this,"_interactionController",null),o(this,"_ambientController",null),o(this,"_animationController",null),o(this,"_storedMouseXY",null),o(this,"loadWasm",(function(t,e){return br(void 0===t?"./gkweb_bg.wasm":t).then((function(){(function(t){var e=cr(t,Jn.__wbindgen_malloc,Jn.__wbindgen_realloc),n=sr;return er(Jn.init_runtime(e,n))})(e).then((function(){a._wasmLoaded=!0,a._onWasmLoad.forEach((function(t){t()})),a._onInitCB()}))}))})),o(this,"init",(function(t){a.renderer=new gn(t,a.gkOptions.attributes),a.renderer.init(),a.gkOptions.clearColor&&(a.renderer.clearColor=a.gkOptions.clearColor),a.scene=new Kn(t.width,t.height),a.gkOptions.movementModel?a._movementModel=a.gkOptions.movementModel:a._movementModel=new kr,a._interactionController=new jr(t,a.scene.camera),a._interactionController.onTapCB=a.onTapCB,a._interactionController.onMouseMoveCB=a.onMouseMoveCB,a._animationController=new Gr,a._ambientController=new Nr,a._ambientController.register(a._animationController,a._interactionController,a._movementModel),a._animationController.register(a._ambientController,a._interactionController,a._movementModel),a._interactionController.register(a._ambientController,a._animationController,a._movementModel),a._movementModel.register(a._ambientController,a._animationController,a._interactionController),window.addEventListener("resize",a.onResizeCB),window.addEventListener("scroll",a.onResizeCB),a._resizeObserver=new ResizeObserver((function(t){t.length&&a.onResizeCB()})),a._resizeObserver.observe(t),a.loadWasm(a.gkOptions.wasmPath,a.gkOptions.apiKey),a.isInit=!0})),o(this,"_onInitCB",(function(){a.onInit&&a.onInit(a),a.renderloop(0)})),o(this,"onResizeCB",(function(){a.boundingRect=a.renderer.gl.canvas.getBoundingClientRect(),yn(a.renderer.gl.canvas),a.scene.resize(a.boundingRect.width,a.boundingRect.height),a.renderer.resize(a.boundingRect.width,a.boundingRect.height),a.interactionController.resize()})),o(this,"setCameratargetDrawable",(function(t){a.interactionController.hitTarget=t.hitTest})),o(this,"addDrawable",(function(t,e){return t instanceof wr&&(t instanceof Ar&&null===a.targetDrawable&&(a.targetDrawable=t,a.interactionController.target=t),t.init(a.renderer.gl,e),a.drawqueue.push(t),a._wasmLoaded?t.createCollisionGeo():a._onWasmLoad.push(t.createCollisionGeo),!0)})),o(this,"startDrawing",(function(){a.shouldDraw=!0,a.renderloop(0)})),o(this,"stopDrawing",(function(){a.shouldDraw=!1})),o(this,"renderloop",(function(t){var e=t/1e4;if(a.shouldDraw){a.movementModel.update(e,a.scene.camera.fov);var n=p(a.movementModel.currentLatLonAlt,3),r=n[0],i=n[1],o=n[2],s=Lr.worldFromLatLon(r,i,o);a.scene.camera.setPosition(s),a.renderer.prepareRenderFrame(),a.scene.update(e);var u=a.scene.getUniforms(e);if(a.drawqueue.forEach((function(t){t.update(a.renderer.gl,u,e)})),a.calloutManager&&a.calloutManager.update(e),a.drawqueue.forEach((function(t){t.draw(a.renderer.gl)})),a.onUpdate&&"function"==typeof a.onUpdate)if(a._storedMouseXY){var l=p(a._storedMouseXY,2),c=l[0],f=l[1],m=c/a.boundingRect.width,h=(a.boundingRect.height-f)/a.boundingRect.height,d=a.scene.camera.getRayFromScreen(m,h),v=a.targetLatLon(d);v?a.onUpdate(a.getPosition(v.lat,v.lon,0)):a.onUpdate()}else a.onUpdate();requestAnimationFrame(a.renderloop)}})),o(this,"onTapCB",(function(t,e){if(a._wasmLoaded){var n=t/a.boundingRect.width,r=(a.boundingRect.height-e)/a.boundingRect.height,i=a.scene.camera.getRayFromScreen(n,r),o=a.targetLatLon(i),s={drawables:[]};o&&(s.lat=o.lat,s.lon=o.lon),a.drawqueue.forEach((function(t){if(t.isInteractive&&t.isSelectable){var e={};e.obj=t;var n=t.rayCastFrom(i);n&&t.isSelectable&&(e.selection=t.onSelection(o.lat,o.lon,n)),s.drawables.push(e)}})),a.onSelection&&"function"==typeof a.onSelection&&a.onSelection(s),a.onTap&&"function"==typeof a.onTap&&(o?a.onTap(a.getPosition(o.lat,o.lon,0)):a.onTap())}})),o(this,"targetLatLon",(function(t){var e,n=a.targetDrawable.rayCastFrom(t);return!1!==n&&(e=Lr.latLonFromWorld(n.point)),e})),o(this,"onMouseMoveCB",(function(t,e){if(a._wasmLoaded){var n=t/a.boundingRect.width,r=(a.boundingRect.height-e)/a.boundingRect.height,i=a.scene.camera.getRayFromScreen(n,r);a.drawqueue.forEach((function(t){if(t.isInteractive&&t.isHoverable){var e=t.rayCastFrom(i);e&&t.isHoverable&&t.onHover(e)}})),a._storedMouseXY=[t,e]}})),o(this,"getPosition",(function(t,e,n){n||(n=0);var r=Lr.worldFromLatLon(t,e,n),i=a.scene.camera.project(r);i[0]*=a.boundingRect.width,i[1]*=a.boundingRect.height,i[1]=a.boundingRect.height-i[1];var o=a.scene.camera.project(a.scene.camera.target);o[0]*=a.boundingRect.width,o[1]*=a.boundingRect.height,o[1]=a.boundingRect.height-o[1];var s=[];s.push(i[0]-o[0]),s.push(i[1]-o[1]);var u=In();Mn(u,r);var l=a.scene.camera.eye,c=In();Mn(c,l);var f=zn(u,c);return{coord:{lat:t,lon:e,alt:n},screen:{x:i[0],y:i[1]},world:{x:s[0],y:s[1],similarityToCameraVector:f}}})),o(this,"registerCalloutManager",(function(t){t&&t instanceof Ur?(t.positionProvider=function(t){return t.map((function(t){return a.getPosition(t.latitude,t.longitude,t.altitude)}))},a.calloutManager=t):console.warn("registerCalloutManager must be passed an instance of CalloutManager")})),o(this,"computeGlobeSize",(function(){var t,e,n,r,i,o=a.scene.camera.fov,s=(t=a.scene.camera.eye,e=a.targetDrawable.translation,n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],Math.hypot(n,r,i));return 2*Math.asin(1/s)/o*a.boundingRect.height})),o(this,"setGlobeSize",(function(t){var e=a.scene.camera.fov;return 1*Math.sin(t/a.boundingRect.height*e/2)})),this.gkOptions=void 0===r?{}:r,i&&(this.onInit=i),this.boundingRect=e.getBoundingClientRect(),this.init(e)}return i(t,[{key:"movementModel",get:function(){return this._movementModel}},{key:"ambientController",get:function(){return this._ambientController}},{key:"animationController",get:function(){return this._animationController}},{key:"interactionController",get:function(){return this._interactionController}}]),i(t,[{key:"isWebGL1",get:function(){return!!this.gl&&te(this.gl)}},{key:"isWebGL2",get:function(){return!!this.gl&&$t(this.gl)}},{key:"VERSION",get:function(){return{version:"1.0.4",wasmVersion:this.WASM_VERSION}}},{key:"WASM_VERSION",get:function(){return!!this._wasmLoaded&&function(){try{const n=Jn.__wbindgen_export_4.value-16;Jn.__wbindgen_export_4.value=n,Jn.get_wasm_version(n);var t=mr()[n/4+0],e=mr()[n/4+1];return or(t,e)}finally{Jn.__wbindgen_export_4.value+=16,Jn.__wbindgen_free(t,e)}}()}}]),t}(),Wr=Or((function(t,e){
/**
   * k-d Tree JavaScript - V 1.01
   *
   * https://github.com/ubilabs/kd-tree-javascript
   *
   * @author Mircea Pricop <pricop@ubilabs.net>, 2012
   * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
   * @author Ubilabs http://ubilabs.net, 2012
   * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
   */
!function(t){function e(t,e,n){this.obj=t,this.left=null,this.right=null,this.parent=n,this.dimension=e}function n(t){this.content=[],this.scoreFunction=t}n.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var r=this.content.pop();return void(n!=e-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i=2*(t+1),o=i-1,a=null;if(o<e){var s=this.content[o],u=this.scoreFunction(s);u<r&&(a=o)}if(i<e){var l=this.content[i];this.scoreFunction(l)<(null==a?r:u)&&(a=i)}if(null==a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}},t.kdTree=function(t,r,i){var o=this;Array.isArray(t)?this.root=function t(n,r,o){var a,s,u=r%i.length;return 0===n.length?null:1===n.length?new e(n[0],u,o):(n.sort((function(t,e){return t[i[u]]-e[i[u]]})),(s=new e(n[a=Math.floor(n.length/2)],u,o)).left=t(n.slice(0,a),r+1,s),s.right=t(n.slice(a+1),r+1,s),s)}(t,0,null):function(t){o.root=t,function t(e){e.left&&(e.left.parent=e,t(e.left)),e.right&&(e.right.parent=e,t(e.right))}(o.root)}(t),this.toJSON=function(t){t||(t=this.root);var n=new e(t.obj,t.dimension,null);return t.left&&(n.left=o.toJSON(t.left)),t.right&&(n.right=o.toJSON(t.right)),n},this.insert=function(t){var n,r,o=function e(n,r){if(null===n)return r;var o=i[n.dimension];return t[o]<n.obj[o]?e(n.left,n):e(n.right,n)}(this.root,null);null!==o?(n=new e(t,(o.dimension+1)%i.length,o),r=i[o.dimension],t[r]<o.obj[r]?o.left=n:o.right=n):this.root=new e(t,0,null)},this.remove=function(t){var e;null!==(e=function e(n){if(null===n)return null;if(n.obj===t)return n;var r=i[n.dimension];return t[r]<n.obj[r]?e(n.left):e(n.right)}(o.root))&&function t(e){function n(t,e){var r,o,a,s,u;return null===t?null:(r=i[e],t.dimension===e?null!==t.left?n(t.left,e):t:(o=t.obj[r],a=n(t.left,e),s=n(t.right,e),u=t,null!==a&&a.obj[r]<o&&(u=a),null!==s&&s.obj[r]<u.obj[r]&&(u=s),u))}var r,a,s;if(null===e.left&&null===e.right)return null===e.parent?void(o.root=null):(s=i[e.parent.dimension],void(e.obj[s]<e.parent.obj[s]?e.parent.left=null:e.parent.right=null));null!==e.right?(a=(r=n(e.right,e.dimension)).obj,t(r),e.obj=a):(a=(r=n(e.left,e.dimension)).obj,t(r),e.right=e.left,e.left=null,e.obj=a)}(e)},this.nearest=function(t,e,a){var s,u,l;if(l=new n((function(t){return-t[1]})),a)for(s=0;s<e;s+=1)l.push([null,a]);for(o.root&&function n(o){function a(t,n){l.push([t,n]),l.size()>e&&l.pop()}var s,u,c,f,m=i[o.dimension],h=r(t,o.obj),d={};for(f=0;f<i.length;f+=1)f===o.dimension?d[i[f]]=t[i[f]]:d[i[f]]=o.obj[i[f]];u=r(d,o.obj),null!==o.right||null!==o.left?(n(s=null===o.right?o.left:null===o.left?o.right:t[m]<o.obj[m]?o.left:o.right),(l.size()<e||h<l.peek()[1])&&a(o,h),(l.size()<e||Math.abs(u)<l.peek()[1])&&null!==(c=s===o.left?o.right:o.left)&&n(c)):(l.size()<e||h<l.peek()[1])&&a(o,h)}(o.root),u=[],s=0;s<Math.min(e,l.content.length);s+=1)l.content[s][0]&&u.push([l.content[s][0].obj,l.content[s][1]]);return u},this.balanceFactor=function(){return function t(e){return null===e?0:Math.max(t(e.left),t(e.right))+1}(o.root)/(Math.log(function t(e){return null===e?0:t(e.left)+t(e.right)+1}(o.root))/Math.log(2))}},t.BinaryHeap=n}(e)})),Yr=function(){function t(){var e=this;n(this,t),o(this,"data",[]),o(this,"types",[]),o(this,"kdtree",null),o(this,"isInit",!1),o(this,"init",(function(){e.isInit||(e.kdtree=new Wr.kdTree(e.data,Lr.distanceBetweenPoints,["lat","lon"]))})),o(this,"addGeojson",(function(t){if("FeatureCollection"===t.type&&t.features instanceof Array){var n=[];t.features.forEach((function(t){var r={id:"_".concat(Math.random().toString(36).substr(2,9)),lat:t.geometry.coordinates[1],lon:t.geometry.coordinates[0],properties:t.properties};e.data.push(r),n.push(n)})),e.isInit?e.kdtree.insert(n):e.init()}})),o(this,"addGeojsonPoint",(function(t){var n={id:"_".concat(Math.random().toString(36).substr(2,9)),lat:t.geometry.coordinates[1],lon:t.geometry.coordinates[0],properties:t.properties};return e.data.push(n),e.isInit?e.kdtree.insert(n):e.init(),n})),o(this,"addDataPoint",(function(t){var n=void 0===t.length?[t]:t,r=[];n.forEach((function(t){var n={id:"_".concat(Math.random().toString(36).substr(2,9)),lat:t.coordinates[1],lon:t.coordinates[0],properties:t.properties};e.data.push(n),r.push(n)})),e.isInit?e.kdtree.insert(r):e.init()})),o(this,"updateDataset",(function(t){t.features.forEach((function(t){var n=e.data.find((function(e){var n=e.lat===t.geometry.coordinates[1],r=e.lon===t.geometry.coordinates[0];return n&&r}));void 0===n?e.addGeojsonPoint(t):n.properties=t.properties}))})),o(this,"deleteDataset",(function(){e.data=[],e.init()})),o(this,"getNearest",(function(t,n,r,i){e.isInit||e.init();var o=e.kdtree.nearest({lat:t,lon:n},i,r);if(void 0!==o[0])return o})),o(this,"getElementFromId",(function(t){return e.data.find((function(e){return e.id===t}))})),o(this,"getElementFromKey",(function(t,n){return e.data.find((function(e){return e.properties[t]===n}))})),o(this,"getTypeList",(function(){var t=[];return t.push([e.data[0]]),e.data.forEach((function(e){var n=Object.keys(e.properties),r=!1;t.forEach((function(t){var i=Object.keys(t[0].properties),o=Lr.isSubSet(n,i),a=Lr.isSubSet(i,n);o&&a&&(t.push(e),r=!0)})),!1===r&&t.push([e])})),t})),o(this,"getMaxForKey",(function(t){var n,r=-1/0;if("number"==typeof e.data[0].properties[t])return e.data.forEach((function(e){var i=e.properties[t];i>=r&&(r=i,n=e.id)})),{max:r,id:n};console.warn("Cannot compare non-numbers")})),o(this,"getMinForKey",(function(t){var n,r=1/0;if("number"==typeof e.data[0].properties[t])return e.data.forEach((function(e){var i=e.properties[t];i<=r&&(r=i,n=e.id)})),{min:r,id:n};console.warn("Cannot compare non-numbers")})),o(this,"getRangeForKey",(function(t){return{min:e.getMinForKey(t),max:e.getMaxForKey(t)}})),o(this,"mapKeyToRange",(function(t,n,r){var i=e.getRangeForKey(t);return e.data.map((function(e){var o=(e.properties[t]-i.min.min)/(i.max.max-i.min.min)*(r-n)+n;return{id:e.properties.region_id,value:o}}))}))}return i(t,[{key:"isHomogeneous",get:function(){return 1===this.getTypeList().length}}]),t}(),Hr=function(t){u(r,t);var e=h(r);function r(){return n(this,r),e.apply(this,arguments)}return r}(wr),Xr="precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_texture;varying vec4 v_color;varying float v_alpha;void main(){vec4 surfaceColor=texture2D(u_texture,gl_PointCoord.xy);float d=(1.0+v_alpha)/2.0;float alpha=smoothstep(0.4,0.49,v_alpha);gl_FragColor=vec4(surfaceColor.rgb,surfaceColor.a*alpha);}",qr={},Kr=function(t){u(r,t);var e=h(r);function r(t){var i,a;n(this,r),o(f(a=e.call(this,t)),"datastore",void 0),o(f(a),"maxSelectionDistance",300),o(f(a),"maxSelectionCount",1),o(f(a),"maxDataPoints",1e4),o(f(a),"dataPointCount",0),o(f(a),"_resourceLoaded",!1),o(f(a),"_isDirty",!0),o(f(a),"_hasGeometry",!1),o(f(a),"useTexture",!1),o(f(a),"createEmptyVertices",(function(){a.geometry.vertices.position={numComponents:3,data:new Array(3*a.maxDataPoints).fill(0),perInstance:1},a.geometry.vertices.color={numComponents:4,data:new Array(4*a.maxDataPoints).fill(0),perInstance:4},a.geometry.vertices.size={numComponents:1,data:new Array(1*a.maxDataPoints).fill(0),perInstance:1},a.geometry.vertices.indices={numComponents:1,data:Array.from(Array(1*a.maxDataPoints).keys()),perInstance:1}})),o(f(a),"extendVerticesBy",(function(t){var e,n,r;(e=a.geometry.vertices.position.data).push.apply(e,v(Array(3*t).fill(0))),(n=a.geometry.vertices.color.data).push.apply(n,v(Array(4*t).fill(0))),(r=a.geometry.vertices.size.data).push.apply(r,v(Array(1*t).fill(0)));var i=a.geometry.vertices.indices.data.length;a.geometry.vertices.indices.data=Array.from(Array(1*(i+t)).keys()),a.geometry.needsResize=!0,a.maxDataPoints+=t})),o(f(a),"init",(function(t,e){if(a.geometry.init(t),a._hasGeometry=!0,a.material.init(t),a.useTexture){var n={texture:{src:a.textureSrc.texture,minMag:t.LINEAR}};a.material.loadTextures(t,n,(function(){e&&e(),a.material.uniforms.u_texture=a.material.textures.texture}))}else e&&e()})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix,a.geometry.needsResize&&a.geometry.reloadBuffers(t),a.geometry.isDirty&&a.geometry.updateBuffers(t)})),o(f(a),"draw",(function(t){(a.isReady||a._hasGeometry)&&0!==!a.dataPointCount&&(t.useProgram(a.material.programInfo.program),t.disable(t.DEPTH_TEST),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElements(t.POINTS,a.dataPointCount,t.UNSIGNED_SHORT,0),t.enable(t.DEPTH_TEST))})),o(f(a),"rayCastFrom",(function(){return!0})),o(f(a),"hitTest",(function(){return!0})),o(f(a),"onSelectionCB",(function(t){return t})),o(f(a),"onSelection",(function(t,e){var n=a.getNearest(t,e);return n=a.onSelectionCB(n)})),o(f(a),"transform",(function(t,e){return e})),o(f(a),"addGeojson",(function(t,e){if("string"!=typeof t){a.datastore.addGeojson(t);var n={position:{numComponents:3,data:[]},color:{numComponents:4,data:[]},size:{numComponents:1,data:[]},indices:{numComponents:1,data:[]}};a.datastore.data.forEach((function(t,e){var r,i,o={lat:t.lat,lon:t.lon,color:[1,1,1,1],size:10};(o=a.transform(t,o)).coords=Lr.worldFromLatLon(o.lat,o.lon,.01),(r=n.position.data).push.apply(r,v(o.coords)),(i=n.color.data).push.apply(i,v(o.color)),n.size.data.push(o.size),n.indices.data.push(e)})),a.geometry.updateGeometry(n,a.dataPointCount),a.dataPointCount+=t.features.length,void 0!==e&&e()}else console.warn("This function needs a geojson object at this time")})),o(f(a),"addDataPoint",(function(t,e){a.dataPointCount+1>=a.maxDataPoints&&(console.warn("More than ".concat(a.maxDataPoints," datapoints have been added, Increasing buffer size by: ").concat(a.maxDataPoints)),a.extendVerticesBy(a.maxDataPoints));var n=[];n.push(a.datastore.addGeojsonPoint(t));var r={position:{numComponents:3,data:[]},color:{numComponents:4,data:[]},size:{numComponents:1,data:[]},indices:{numComponents:1,data:[]}};n.forEach((function(t,e){var n,i,o={lat:t.lat,lon:t.lon,color:[1,1,1,1],size:10};(o=a.transform(t,o)).coords=Lr.worldFromLatLon(o.lat,o.lon,.01),(n=r.position.data).push.apply(n,v(o.coords)),(i=r.color.data).push.apply(i,v(o.color)),r.size.data.push(o.size),r.indices.data.push(e)})),a.geometry.updateGeometry(r,a.dataPointCount),a.dataPointCount+=1,void 0!==e&&e()})),o(f(a),"updatePoint",(function(t,e){var n,r,i={};void 0!==e.position&&(i.position={numComponents:3,data:[]},(n=i.position.data).push.apply(n,v(e.position)));void 0!==e.color&&(i.color={numComponents:4,data:[]},(r=i.color.data).push.apply(r,v(e.color)));void 0!==e.size&&(i.size={numComponents:1,data:[]},i.size.data.push(e.size)),a.geometry.updateGeometry(i,t)})),o(f(a),"getNearest",(function(t,e){return a.datastore.getNearest(t,e,a.maxSelectionDistance,a.maxSelectionCount)}));var s={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec4 color;attribute float size;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;varying vec4 v_color;varying float v_alpha;void main(){vec4 pos=u_worldViewProjection*u_model*position;gl_PointSize=size;gl_Position=pos;v_color=color;v_alpha=dot(position.xyz,normalize(u_cameraPos));}",fragment:"precision mediump float;\n#define GLSLIFY 1\nvarying vec4 v_color;varying float v_alpha;void main(){float d=distance(vec2(0.5),gl_PointCoord.xy);float c=1.0-smoothstep(0.40,0.5,d);gl_FragColor=vec4(v_color.rgb,v_color.a*v_alpha*c);}"};return t&&(t.maxSelectionCount&&(a.maxSelectionCount=t.maxSelectionCount),t.maxSelectionDistance&&(a.maxSelectionDistance=t.maxSelectionDistance),t.maxDataPoints&&(a.maxDataPoints=t.maxDataPoints),!0===t.useTexture&&void 0!==t.texture&&(a.useTexture=!0,s.fragment=Xr,a.textureSrc={texture:t.texture})),a.material=new Zn(s),a.datastore=new Yr,a.material.uniforms=qr,a.geometry=new Cr,a.createEmptyVertices(),a}return r}(Hr),Zr={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec3 normal;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;varying vec2 vTexture;varying float vAlpha;void main(){vec4 pos=u_worldViewProjection*u_model*position;gl_PointSize=10.0;vec3 transformedNormal=(u_worldViewProjection*u_model*vec4(normal,1.0)).xyz;vec4 transformedCamera=vec4(0.0,0.0,-1.0,1.0)*u_worldViewProjection;vAlpha=pow((1.0+(dot(normal,normalize(transformedCamera.xyz))))/2.0,9.0);vTexture=texcoord.xy;gl_Position=pos+0.00000000000000001*normal.x*texcoord.x;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_surface;varying vec2 vTexture;varying float vAlpha;void main(){vec4 surfaceColor=texture2D(u_surface,vec2(vTexture.x,1.0-vTexture.y));vec3 color=surfaceColor.rgb*vAlpha;gl_FragColor=vec4(color,1.0);}"},Jr={},Qr=function(t){u(r,t);var e=h(r);function r(t,i){var a,s;n(this,r),o(f(s=e.call(this)),"material",null),o(f(s),"lookup",null),o(f(s),"currentSelection",-1),o(f(s),"previousSelection",-1),o(f(s),"inAnimation",null),o(f(s),"outAnimation",null),o(f(s),"selection0",236),o(f(s),"selection1",144),o(f(s),"current",236),o(f(s),"dataTexture",void 0),o(f(s),"dataTextureSize",16),o(f(s),"updateCMDs",[]),o(f(s),"highlightAnimationProps",{start:0,stop:1,duration:1e3,onUpdate:function(t){s.material.uniforms.u_animateIn=t}}),o(f(s),"init",(function(t,e){s.geometry.init(t);var n={surface:{src:s.textureSrc.surface,minMag:t.LINEAR}};s.material.init(t),s.material.uniforms.uModelMatrix=s.modelMatrix,s.material.loadTextures(t,n,(function(){s.material.uniforms.u_surface=s.material.textures.surface,e&&e()}))})),o(f(s),"getValueForId",(function(t){return s.lookup.getFromId(t)})),o(f(s),"getValueForCode",(function(t){return s.lookup.getFromCode(t)})),o(f(s),"getValueForName",(function(t){return s.lookup.getFromName(t)})),o(f(s),"setIdColor",(function(t,e,n){var r=void 0===n?1:n,i=Lr.hexToRGBA(e,r,!1);s.updateCMDs.push((function(e){s.dataTexture.updatePixelId(e,i,t)}))})),o(f(s),"createCollisionGeo",(function(){s.collisionGeometry&&s.collisionGeometry instanceof _r||(s.collisionGeometry=gr.create_collision_geometry(s.geometry.vertices.position.data,s.geometry.vertices.texcoord.data,s.geometry.vertices.indices.data))})),o(f(s),"rayCastFrom",(function(t){return s.collisionGeometry.raycast(t.origin,t.direction)})),o(f(s),"hitTest",(function(t){return s.collisionGeometry.hitTest(t.origin,t.direction)})),o(f(s),"onSelectionCB",(function(){})),o(f(s),"onSelection",(function(t,e,n){var r=Lr.latLonFromWorld(n.point);return s.current=s.lookup.getIdFromLatLon(r.lat,r.lon),s.setHighlightId(s.current),s.onSelectionCB(s.current),{id:s.current,name:s.lookup.getFromId(s.current)}})),o(f(s),"onHover",(function(){})),o(f(s),"update",(function(t,e,n){d((a=f(s),l(r.prototype)),"update",a).call(a,e,n),s.material.uniforms.u_model=s.modelMatrix,s.updateCMDs.forEach((function(e){e(t)})),s.updateCMDs=[]})),o(f(s),"draw",(function(t){s.isReady&&s.shouldDraw&&(t.useProgram(s.material.programInfo.program),un(t,s.material.programInfo,s.geometry.bufferInfo),sn(s.material.programInfo,s.material.uniforms),t.drawArrays(t.TRIANGLES,0,s.geometry.bufferInfo.numElements))})),o(f(s),"setCountryHover",(function(t){})),o(f(s),"setHighlightId",(function(t){s.previousSelection=s.currentSelection,s.currentSelection=t;var e=s.inAnimation?s.inAnimation.currentValue():1,n=300*e;s.animateIn(s.currentSelection,500),s.animateOut(s.previousSelection,n,e)})),o(f(s),"animateIn",(function(t,e){s.material.uniforms.u_idAnimateIn=t,s.inAnimation&&s.inAnimation.stop(),s.material.uniforms.u_animateIn=0,s.inAnimation=new Mr(s.highlightAnimationProps.start,s.highlightAnimationProps.stop,s.highlightAnimationProps.duration,{onUpdate:s.highlightAnimationProps.onUpdate,onComplete:function(){e&&e()}})})),o(f(s),"animateOut",(function(t,e,n,r){s.material.uniforms.u_idAnimateOut=t,s.outAnimation&&s.outAnimation.stop(),s.material.uniforms.u_animateOut=n,s.outAnimation=new Mr(n,0,e,{onUpdate:function(t){s.material.uniforms.u_animateOut=t},onComplete:function(){r&&r()}})})),o(f(s),"addDataset",(function(t){s.lookup=new Er(t,s.textureSrc.id)})),s.textureSrc={surface:t.surface},s.material=new Zn(Zr),s.material.uniforms=Jr,s.geometry=new Cr;var u=0,c=new Float32Array(i),m=new Int32Array(i),h=c.subarray(u,u+34992);u+=34992;var p=c.subarray(u,u+34992);u+=34992;var v=c.subarray(u,u+34992);u+=34992;var y=m.subarray(u,u+11664);return s.geometry.vertices.position={numComponents:3,data:h},s.geometry.vertices.normal={numComponents:3,data:p},s.geometry.vertices.texcoord={numComponents:3,data:v},s.geometry.vertices.indices={numComponents:3,data:y},s}return r}(Ar),$r={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;varying float vAlpha;varying vec2 vTexture;void main(){vTexture=texcoord;gl_Position=position;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_background;uniform vec2 u_resolution;varying float vAlpha;varying vec2 vTexture;void main(){vec2 texture=u_resolution/256.0;vec4 textureColor=texture2D(u_background,vTexture*texture);gl_FragColor=vec4(textureColor.rgb,1.0);}"},ti={},ei=function(t){u(r,t);var e=h(r);function r(t){var i,a;return n(this,r),o(f(a=e.call(this)),"material",null),o(f(a),"init",(function(t,e){a.geometry=new Cr,a.geometry.vertices.position=[-1,-1,1,-1,1,1,1,1,1,1,-1,1],a.geometry.vertices.texcoord=[0,0,0,1,1,1,1,0],a.geometry.vertices.indices=[0,2,1,0,3,2],a.geometry.init(t);var n={background:{src:a.textureSrc.background,minMag:t.LINEAR}};a.material.init(t),a.material.loadTextures(t,n,(function(){a.material.uniforms.u_background=a.material.textures.background,e&&e()}))})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"rayCastFrom",(function(){return!1})),o(f(a),"hitTest",(function(){return!1})),o(f(a),"onSelection",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix})),o(f(a),"draw",(function(t){a.isReady&&(t.disable(t.DEPTH_TEST),t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElements(t.TRIANGLES,a.geometry.bufferInfo.numElements,t.UNSIGNED_SHORT,0),t.enable(t.DEPTH_TEST))})),a.material=new Zn($r),a.material.uniforms=ti,a.textureSrc={background:t},a}return r}(wr),ni={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform mat4 u_view;uniform float u_scale;uniform vec3 u_cameraPos;varying float vAlpha;varying vec2 vTexture;void main(){vec3 cameraRight=normalize(vec3(u_view[0][0],u_view[1][0],u_view[2][0]));vec3 cameraUp=normalize(vec3(u_view[0][1],u_view[1][1],u_view[2][1]));vec3 cameraForward=normalize(u_cameraPos);vec3 worldPos=cameraRight*position.x*u_scale+cameraUp*position.y*u_scale;vec4 pos=u_worldViewProjection*vec4(worldPos,1.0);gl_Position=pos;vTexture=texcoord;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_background;varying float vAlpha;varying vec2 vTexture;void main(){gl_FragColor=vec4(1.0);}"},ri={u_scale:1},ii=function(t){u(r,t);var e=h(r);function r(t){var i,a;return n(this,r),o(f(a=e.call(this)),"material",null),o(f(a),"useTexture",!1),o(f(a),"nScale",1),o(f(a),"init",(function(t,e){if(a.geometry=new Cr,a.geometry.vertices.position=[-1,-1,0,-1,1,0,1,1,0,1,-1,0],a.geometry.vertices.texcoord=[0,0,0,1,1,1,1,0],a.geometry.vertices.indices=[0,2,1,0,3,2],a.geometry.init(t),a.material.init(t),a.useTexture){var n={background:{src:a.textureSrc.texture,minMag:t.LINEAR,flipY:!0}};a.material.loadTextures(t,n,(function(){a.material.uniforms.u_background=a.material.textures.background,e&&e()}))}else a.material.texturesLoaded=!0,e&&e()})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"rayCastFrom",(function(){return!1})),o(f(a),"hitTest",(function(){return!1})),o(f(a),"onSelection",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix,a.material.uniforms.u_scale=a.nScale})),o(f(a),"draw",(function(t){a.isReady&&(t.disable(t.DEPTH_TEST),t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElements(t.TRIANGLES,a.geometry.bufferInfo.numElements,t.UNSIGNED_SHORT,0),t.enable(t.DEPTH_TEST))})),t.texture&&(a.useTexture=!0,ni.fragment="precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_background;varying float vAlpha;varying vec2 vTexture;void main(){vec4 textureColor=texture2D(u_background,vTexture);gl_FragColor=textureColor;}",a.textureSrc={texture:t.texture}),a.material=new Zn(ni),a.material.uniforms=ri,a}return r}(wr),oi={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform mat4 u_view;uniform float u_scale;uniform vec3 u_point;uniform vec2 u_resolution;uniform vec3 u_cameraPos;varying float vAlpha;varying vec2 vTexture;void main(){vec4 pos=u_worldViewProjection*vec4(u_point,1.0);float size=u_scale*16.0;pos.y+=(size*4.0/u_resolution.y);gl_PointSize=size;gl_Position=pos;vTexture=texcoord;float d=(1.0+dot(u_point,normalize(u_cameraPos)))/2.0;vAlpha=smoothstep(0.4,0.5,d);}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_background;varying float vAlpha;varying vec2 vTexture;void main(){vec4 textureColor=texture2D(u_background,gl_PointCoord);gl_FragColor=vec4(textureColor.rgb,vAlpha*textureColor.a);}"},ai={u_scale:1,u_point:[0,0,1]},si=function(t){u(r,t);var e=h(r);function r(t){var i,a;return n(this,r),o(f(a=e.call(this)),"material",null),o(f(a),"useTexture",!1),o(f(a),"nScale",1),o(f(a),"point",[0,0,1]),o(f(a),"init",(function(t,e){a.geometry=new Cr,a.geometry.vertices.position=[0,0,1],a.geometry.init(t),a.material.init(t);var n={background:{src:a.textureSrc.texture,minMag:t.LINEAR}};a.material.loadTextures(t,n,(function(){a.material.uniforms.u_background=a.material.textures.background,e&&e()}))})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"rayCastFrom",(function(){return!1})),o(f(a),"hitTest",(function(){return!1})),o(f(a),"onSelection",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix,a.material.uniforms.u_scale=a.nScale,a.material.uniforms.u_point=a.point})),o(f(a),"draw",(function(t){a.isReady&&(t.disable(t.DEPTH_TEST),t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawArrays(t.POINTS,0,a.geometry.bufferInfo.numElements),t.enable(t.DEPTH_TEST))})),o(f(a),"setPoint",(function(t,e,n){var r=void 0===n?0:n;a.point=Lr.worldFromLatLon(t,e,r)})),a.textureSrc={texture:t.texture},a.material=new Zn(oi),a.material.uniforms=ai,a}return r}(wr),ui=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){t.exports=n(1)},function(t,n,r){var i="function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?function(t){return e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)};!function(){var e=Math.abs,n=Math.min,o=Math.max,a=Math.cos,s=Math.sin,u=Math.acos,l=Math.sqrt,c=Math.PI,f={x:0,y:0,z:0},m=r(2),h=r(3),d=function(t){var n=t&&t.forEach?t:[].slice.call(arguments),r=!1;if("object"===i(n[0])){r=n.length;var o=[];n.forEach((function(t){["x","y","z"].forEach((function(e){void 0!==t[e]&&o.push(t[e])}))})),n=o}var a=!1,s=n.length;if(r){if(r>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");a=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var u=!a&&(9===s||12===s)||t&&t[0]&&void 0!==t[0].z;this._3d=u;for(var l=[],c=0,f=u?3:2;c<s;c+=f){var h={x:n[c],y:n[c+1]};u&&(h.z=n[c+2]),l.push(h)}this.order=l.length-1,this.points=l;var d=["x","y"];u&&d.push("z"),this.dims=d,this.dimlen=d.length,function(t){for(var n=t.order,r=t.points,i=m.align(r,{p1:r[0],p2:r[n]}),o=0;o<i.length;o++)if(e(i[o].y)>1e-4)return void(t._linear=!1);t._linear=!0}(this),this._t1=0,this._t2=1,this.update()},p=r(4);function v(t,e,n,r,i){void 0===i&&(i=.5);var o=m.projectionratio(i,t),a=1-o,s={x:o*e.x+a*r.x,y:o*e.y+a*r.y},u=m.abcratio(i,t);return{A:{x:n.x+(n.x-s.x)/u,y:n.y+(n.y-s.y)/u},B:n,C:s}}d.SVGtoBeziers=function(t){return p(d,t)},d.quadraticFromPoints=function(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new d(e,e,n);if(1===r)return new d(t,e,e);var i=v(2,t,e,n,r);return new d(t,i.A,n)},d.cubicFromPoints=function(t,e,n,r,i){void 0===r&&(r=.5);var o=v(3,t,e,n,r);void 0===i&&(i=m.dist(e,o.C));var a=i*(1-r)/r,s=m.dist(t,n),u=(n.x-t.x)/s,l=(n.y-t.y)/s,c=i*u,f=i*l,h=a*u,p=a*l,y=e.x-c,g=e.y-f,_=e.x+h,x=e.y+p,b=o.A,w=b.x+(y-b.x)/(1-r),A=b.y+(g-b.y)/(1-r),C=b.x+(_-b.x)/r,T=b.y+(x-b.y)/r,I={x:t.x+(w-t.x)/r,y:t.y+(A-t.y)/r},P={x:n.x+(C-n.x)/(1-r),y:n.y+(T-n.y)/(1-r)};return new d(t,I,P,n)};var y=function(){return m};d.getUtils=y,d.PolyBezier=h,d.prototype={getUtils:y,valueOf:function(){return this.toString()},toString:function(){return m.pointsToString(this.points)},toSVG:function(t){if(this._3d)return!1;for(var e=this.points,n=["M",e[0].x,e[0].y,2===this.order?"Q":"C"],r=1,i=e.length;r<i;r++)n.push(e[r].x),n.push(e[r].y);return n.join(" ")},setRatios:function(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]},verify:function(){var t=this.coordDigest();t!==this._print&&(this._print=t,this.update())},coordDigest:function(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")},update:function(t){this._lut=[],this.dpoints=m.derive(this.points,this._3d),this.computedirection()},computedirection:function(){var t=this.points,e=m.angle(t[0],t[this.order],t[1]);this.clockwise=e>0},length:function(){return m.length(this.derivative.bind(this))},_lut:[],getLUT:function(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(var e=0;e<=t;e++)this._lut.push(this.compute(e/t));return this._lut},on:function(t,e){e=e||5;for(var n,r=this.getLUT(),i=[],o=0,a=0;a<r.length;a++)n=r[a],m.dist(n,t)<e&&(i.push(n),o+=a/r.length);return!!i.length&&o/i.length},project:function(t){var e,n,r,i,o=this.getLUT(),a=o.length-1,s=m.closest(o,t),u=s.mdist,l=s.mpos,c=(l+1)/a,f=.1/a;for(u+=1,e=n=(l-1)/a;n<c+f;n+=f)r=this.compute(n),(i=m.dist(t,r))<u&&(u=i,e=n);return(r=this.compute(e)).t=e,r.d=u,r},get:function(t){return this.compute(t)},point:function(t){return this.points[t]},compute:function(t){return this.ratios?m.computeWithRatios(t,this.points,this.ratios,this._3d):m.compute(t,this.points,this._3d,this.ratios)},raise:function(){for(var t,e,n=this.points,r=[n[0]],i=n.length,o=1;o<i;o++)t=n[o],e=n[o-1],r[o]={x:(i-o)/i*t.x+o/i*e.x,y:(i-o)/i*t.y+o/i*e.y};return r[i]=n[i-1],new d(r)},derivative:function(t){var e,n,r=1-t,i=0,o=this.dpoints[0];2===this.order&&(o=[o[0],o[1],f],e=r,n=t),3===this.order&&(e=r*r,n=r*t*2,i=t*t);var a={x:e*o[0].x+n*o[1].x+i*o[2].x,y:e*o[0].y+n*o[1].y+i*o[2].y};return this._3d&&(a.z=e*o[0].z+n*o[1].z+i*o[2].z),a},curvature:function(t){return m.curvature(t,this.points,this._3d)},inflections:function(){return m.inflections(this.points)},normal:function(t){return this._3d?this.__normal3(t):this.__normal2(t)},__normal2:function(t){var e=this.derivative(t),n=l(e.x*e.x+e.y*e.y);return{x:-e.y/n,y:e.x/n}},__normal3:function(t){var e=this.derivative(t),n=this.derivative(t+.01),r=l(e.x*e.x+e.y*e.y+e.z*e.z),i=l(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;var o={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},a=l(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=a,o.y/=a,o.z/=a;var s=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z];return{x:s[0]*e.x+s[1]*e.y+s[2]*e.z,y:s[3]*e.x+s[4]*e.y+s[5]*e.z,z:s[6]*e.x+s[7]*e.y+s[8]*e.z}},hull:function(t){var e,n=this.points,r=[],i=[],o=0,a=0,s=0;for(i[o++]=n[0],i[o++]=n[1],i[o++]=n[2],3===this.order&&(i[o++]=n[3]);n.length>1;){for(r=[],a=0,s=n.length-1;a<s;a++)e=m.lerp(t,n[a],n[a+1]),i[o++]=e,r.push(e);n=r}return i},split:function(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;var n=this.hull(t),r={left:2===this.order?new d([n[0],n[3],n[5]]):new d([n[0],n[4],n[7],n[9]]),right:2===this.order?new d([n[5],n[4],n[2]]):new d([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=m.map(0,0,1,this._t1,this._t2),r.left._t2=m.map(t,0,1,this._t1,this._t2),r.right._t1=m.map(t,0,1,this._t1,this._t2),r.right._t2=m.map(1,0,1,this._t1,this._t2),e?(e=m.map(e,t,1,0,1),r.right.split(e).left):r},extrema:function(){var t,e,n=this.dims,r={},i=[];return n.forEach(function(n){e=function(t){return t[n]},t=this.dpoints[0].map(e),r[n]=m.droots(t),3===this.order&&(t=this.dpoints[1].map(e),r[n]=r[n].concat(m.droots(t))),r[n]=r[n].filter((function(t){return t>=0&&t<=1})),i=i.concat(r[n].sort(m.numberSort))}.bind(this)),i=i.sort(m.numberSort).filter((function(t,e){return i.indexOf(t)===e})),r.values=i,r},bbox:function(){var t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=m.getminmax(this,n,t[n])}.bind(this)),e},overlaps:function(t){var e=this.bbox(),n=t.bbox();return m.bboxoverlap(e,n)},offset:function(t,e){if(void 0!==e){var n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){var o=this.normal(0),a=this.points.map((function(e){var n={x:e.x+t*o.x,y:e.y+t*o.y};return e.z&&r.z&&(n.z=e.z+t*o.z),n}));return[new d(a)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))},simple:function(){if(3===this.order){var t=m.angle(this.points[0],this.points[3],this.points[1]),n=m.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&n<0||t<0&&n>0)return!1}var r=this.normal(0),i=this.normal(1),o=r.x*i.x+r.y*i.y;return this._3d&&(o+=r.z*i.z),e(u(o))<c/3},reduce:function(){var t,n,r=0,i=0,o=[],a=[],s=this.extrema().values;for(-1===s.indexOf(0)&&(s=[0].concat(s)),-1===s.indexOf(1)&&s.push(1),r=s[0],t=1;t<s.length;t++)i=s[t],(n=this.split(r,i))._t1=r,n._t2=i,o.push(n),r=i;return o.forEach((function(t){for(r=0,i=0;i<=1;)for(i=r+.01;i<=1.01;i+=.01)if(!(n=t.split(r,i)).simple()){if(e(r-(i-=.01))<.01)return[];(n=t.split(r,i))._t1=m.map(r,0,1,t._t1,t._t2),n._t2=m.map(i,0,1,t._t1,t._t2),a.push(n),r=i;break}r<1&&((n=t.split(r,1))._t1=m.map(r,0,1,t._t1,t._t2),n._t2=t._t2,a.push(n))})),a},scale:function(t){var e=this.order,n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);var r=this.clockwise,i=n?n(0):t,o=n?n(1):t,a=[this.offset(0,10),this.offset(1,10)],s=m.lli4(a[0],a[0].c,a[1],a[1].c);if(!s)throw new Error("cannot scale this curve. Try reducing it first.");var u=this.points,c=[];return[0,1].forEach(function(t){var n=c[t*e]=m.copy(u[t*e]);n.x+=(t?o:i)*a[t].n.x,n.y+=(t?o:i)*a[t].n.y}.bind(this)),n?([0,1].forEach(function(i){if(2!==this.order||!i){var o=u[i+1],a={x:o.x-s.x,y:o.y-s.y},f=n?n((i+1)/e):t;n&&!r&&(f=-f);var m=l(a.x*a.x+a.y*a.y);a.x/=m,a.y/=m,c[i+1]={x:o.x+f*a.x,y:o.y+f*a.y}}}.bind(this)),new d(c)):([0,1].forEach(function(t){if(2!==this.order||!t){var n=c[t*e],r=this.derivative(t),i={x:n.x+r.x,y:n.y+r.y};c[t+1]=m.lli4(n,i,s,u[t+1])}}.bind(this)),new d(c))},outline:function(t,e,n,r){e=void 0===e?t:e;var i,o=this.reduce(),a=o.length,s=[],u=[],l=0,c=this.length(),f=void 0!==n&&void 0!==r;function d(t,e,n,r,i){return function(o){var a=r/n,s=(r+i)/n,u=e-t;return m.map(o,0,1,t+a*u,t+s*u)}}o.forEach((function(i){w=i.length(),f?(s.push(i.scale(d(t,n,c,l,w))),u.push(i.scale(d(-e,-r,c,l,w)))):(s.push(i.scale(t)),u.push(i.scale(-e))),l+=w})),u=u.map((function(t){return(i=t.points)[3]?t.points=[i[3],i[2],i[1],i[0]]:t.points=[i[2],i[1],i[0]],t})).reverse();var p=s[0].points[0],v=s[a-1].points[s[a-1].points.length-1],y=u[a-1].points[u[a-1].points.length-1],g=u[0].points[0],_=m.makeline(y,p),x=m.makeline(v,g),b=[_].concat(s).concat([x]).concat(u),w=b.length;return new h(b)},outlineshapes:function(t,e,n){e=e||t;for(var r=this.outline(t,e).curves,i=[],o=1,a=r.length;o<a/2;o++){var s=m.makeshape(r[o],r[a-o],n);s.startcap.virtual=o>1,s.endcap.virtual=o<a/2-1,i.push(s)}return i},intersects:function(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof d&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)},lineIntersects:function(t){var e=n(t.p1.x,t.p2.x),r=n(t.p1.y,t.p2.y),i=o(t.p1.x,t.p2.x),a=o(t.p1.y,t.p2.y),s=this;return m.roots(this.points,t).filter((function(t){var n=s.get(t);return m.between(n.x,e,i)&&m.between(n.y,r,a)}))},selfintersects:function(t){var e,n,r,i,o=this.reduce(),a=o.length-2,s=[];for(e=0;e<a;e++)r=o.slice(e,e+1),i=o.slice(e+2),n=this.curveintersects(r,i,t),s=s.concat(n);return s},curveintersects:function(t,e,n){var r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));var i=[];return r.forEach((function(t){var e=m.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))})),i},arcs:function(t){t=t||.5;return this._iterate(t,[])},_error:function(t,n,r,i){var o=(i-r)/4,a=this.get(r+o),s=this.get(i-o),u=m.dist(t,n),l=m.dist(t,a),c=m.dist(t,s);return e(l-u)+e(c-u)},_iterate:function(t,e){var n,r=0,i=1;do{n=0,i=1;var o,u,l,c,f,h=this.get(r),d=!1,p=!1,v=i,y=1;do{if(p=d,c=l,v=(r+i)/2,o=this.get(v),u=this.get(i),(l=m.getccenter(h,o,u)).interval={start:r,end:i},d=this._error(l,h,r,i)<=t,(f=p&&!d)||(y=i),d){if(i>=1){if(l.interval.end=y=1,c=l,i>1){var g={x:l.x+l.r*a(l.e),y:l.y+l.r*s(l.e)};l.e+=m.angle({x:l.x,y:l.y},g,this.get(1))}break}i+=(i-r)/2}else i=v}while(!f&&n++<100);if(n>=100)break;c=c||l,e.push(c),r=y}while(i<1);return e}},t.exports=d}()},function(t,e,n){var r,i,o,a,s,u,l,c,f,m,h,d,p,v,y;r=Math.abs,i=Math.cos,o=Math.sin,a=Math.acos,s=Math.atan2,u=Math.sqrt,l=Math.pow,c=function(t){return t<0?-l(-t,1/3):l(t,1/3)},f=Math.PI,m=2*f,h=f/2,d=Number.MAX_SAFE_INTEGER||9007199254740991,p=Number.MIN_SAFE_INTEGER||-9007199254740991,v={x:0,y:0,z:0},y={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){var n=e(t),r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),u(r)},compute:function(t,e,n){if(0===t)return e[0];var r=e.length-1;if(1===t)return e[r];var i=e,o=1-t;if(0===r)return e[0];if(1===r)return m={x:o*i[0].x+t*i[1].x,y:o*i[0].y+t*i[1].y},n&&(m.z=o*i[0].z+t*i[1].z),m;if(r<4){var a,s,u,l=o*o,c=t*t,f=0;2===r?(i=[i[0],i[1],i[2],v],a=l,s=o*t*2,u=c):3===r&&(a=l*o,s=l*t*3,u=o*c*3,f=t*c);var m={x:a*i[0].x+s*i[1].x+u*i[2].x+f*i[3].x,y:a*i[0].y+s*i[1].y+u*i[2].y+f*i[3].y};return n&&(m.z=a*i[0].z+s*i[1].z+u*i[2].z+f*i[3].z),m}for(var h=JSON.parse(JSON.stringify(e));h.length>1;){for(var d=0;d<h.length-1;d++)h[d]={x:h[d].x+(h[d+1].x-h[d].x)*t,y:h[d].y+(h[d+1].y-h[d].y)*t},void 0!==h[d].z&&(h[d]=h[d].z+(h[d+1].z-h[d].z)*t);h.splice(h.length-1,1)}return h[0]},computeWithRatios:function(t,e,n,r){var i,o=1-t,a=n,s=e,u=a[0],l=a[1],c=a[2],f=a[3];return u*=o,l*=t,2===s.length?(i=u+l,{x:(u*s[0].x+l*s[1].x)/i,y:(u*s[0].y+l*s[1].y)/i,z:!!r&&(u*s[0].z+l*s[1].z)/i}):(u*=o,l*=2*o,c*=t*t,3===s.length?(i=u+l+c,{x:(u*s[0].x+l*s[1].x+c*s[2].x)/i,y:(u*s[0].y+l*s[1].y+c*s[2].y)/i,z:!!r&&(u*s[0].z+l*s[1].z+c*s[2].z)/i}):(u*=o,l*=1.5*o,c*=3*o,f*=t*t*t,4===s.length?(i=u+l+c+f,{x:(u*s[0].x+l*s[1].x+c*s[2].x+f*s[3].x)/i,y:(u*s[0].y+l*s[1].y+c*s[2].y+f*s[3].y)/i,z:!!r&&(u*s[0].z+l*s[1].z+c*s[2].z+f*s[3].z)/i}):void 0))},derive:function(t,e){for(var n=[],r=t,i=r.length,o=i-1;i>1;i--,o--){for(var a,s=[],u=0;u<o;u++)a={x:o*(r[u+1].x-r[u].x),y:o*(r[u+1].y-r[u].y)},e&&(a.z=o*(r[u+1].z-r[u].z)),s.push(a);n.push(s),r=s}return n},between:function(t,e,n){return e<=t&&t<=n||y.approximately(t,e)||y.approximately(t,n)},approximately:function(t,e,n){return r(t-e)<=(n||1e-6)},length:function(t){var e,n,r=0,i=y.Tvalues.length;for(e=0;e<i;e++)n=.5*y.Tvalues[e]+.5,r+=y.Cvalues[e]*y.arcfn(n,t);return.5*r},map:function(t,e,n,r,i){return r+(t-e)/(n-e)*(i-r)},lerp:function(t,e,n){var r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return e.z&&n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){var e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(y.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-t.x,a=n.y-t.y;return s(r*a-i*o,r*o+i*a)},round:function(t,e){var n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){var n=t.x-e.x,r=t.y-e.y;return u(n*n+r*r)},closest:function(t,e){var n,r,i=l(2,63);return t.forEach((function(t,o){(r=y.dist(e,t))<i&&(i=r,n=o)})),{mdist:i,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var n=l(t,e)+l(1-t,e);return r((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var n=l(1-t,e);return n/(l(t,e)+n)},lli8:function(t,e,n,r,i,o,a,s){var u=(t-n)*(o-s)-(e-r)*(i-a);return 0!=u&&{x:((t*r-e*n)*(i-a)-(t-n)*(i*s-o*a))/u,y:((t*r-e*n)*(o-s)-(e-r)*(i*s-o*a))/u}},lli4:function(t,e,n,r){var i=t.x,o=t.y,a=e.x,s=e.y,u=n.x,l=n.y,c=r.x,f=r.y;return y.lli8(i,o,a,s,u,l,c,f)},lli:function(t,e){return y.lli4(t,t.c,e,e.c)},makeline:function(t,e){var r=n(1),i=t.x,o=t.y,a=e.x,s=e.y,u=(a-i)/3,l=(s-o)/3;return new r(i,o,i+u,o+l,i+2*u,o+2*l,a,s)},findbbox:function(t){var e=d,n=d,r=p,i=p;return t.forEach((function(t){var o=t.bbox();e>o.x.min&&(e=o.x.min),n>o.y.min&&(n=o.y.min),r<o.x.max&&(r=o.x.max),i<o.y.max&&(i=o.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+i)/2,max:i,size:i-n}}},shapeintersections:function(t,e,n,r,i){if(!y.bboxoverlap(e,r))return[];var o=[],a=[t.startcap,t.forward,t.back,t.endcap],s=[n.startcap,n.forward,n.back,n.endcap];return a.forEach((function(e){e.virtual||s.forEach((function(r){if(!r.virtual){var a=e.intersects(r,i);a.length>0&&(a.c1=e,a.c2=r,a.s1=t,a.s2=n,o.push(a))}}))})),o},makeshape:function(t,e,n){var r=e.points.length,i=t.points.length,o=y.makeline(e.points[r-1],t.points[0]),a=y.makeline(t.points[i-1],e.points[0]),s={startcap:o,forward:t,back:e,endcap:a,bbox:y.findbbox([o,t,e,a])},u=y;return s.intersections=function(t){return u.shapeintersections(s,s.bbox,t,t.bbox,n)},s},getminmax:function(t,e,n){if(!n)return{min:0,max:0};var r,i,o=d,a=p;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(var s=0,u=n.length;s<u;s++)r=n[s],(i=t.get(r))[e]<o&&(o=i[e]),i[e]>a&&(a=i[e]);return{min:o,mid:(o+a)/2,max:a,size:a-o}},align:function(t,e){var n=e.p1.x,r=e.p1.y,a=-s(e.p2.y-r,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*i(a)-(t.y-r)*o(a),y:(t.x-n)*o(a)+(t.y-r)*i(a)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};var n=t.length-1,r=y.align(t,e),o=function(t){return 0<=t&&t<=1};if(2===n){if(0!==(p=(v=r[0].y)-2*(g=r[1].y)+(_=r[2].y))){var s=-u(g*g-v*_),l=-v+g;return[-(s+l)/p,-(-s+l)/p].filter(o)}return g!==_&&0===p?[(2*g-_)/(2*g-2*_)].filter(o):[]}var f=r[0].y,h=r[1].y,d=r[2].y,p=3*h-f-3*d+r[3].y,v=3*f-6*h+3*d,g=-3*f+3*h,_=f;if(y.approximately(p,0)){if(y.approximately(v,0))return y.approximately(g,0)?[]:[-_/g].filter(o);var x=2*v;return[((b=u(g*g-4*v*_))-g)/x,(-g-b)/x].filter(o)}var b,w,A=(r=(3*(g/=p)-(v/=p)*v)/3)/3,C=(b=(2*v*v*v-9*v*g+27*(_/=p))/27)/2,T=C*C+A*A*A;if(T<0){var I=-r/3,P=u(I*I*I),S=-b/(2*P),E=a(S<-1?-1:S>1?1:S),L=2*c(P);return[L*i(E/3)-v/3,L*i((E+m)/3)-v/3,L*i((E+2*m)/3)-v/3].filter(o)}if(0===T)return[2*(w=C<0?c(-C):-c(C))-v/3,-w-v/3].filter(o);var M=u(T);return[(w=c(-C+M))-c(C+M)-v/3].filter(o)},droots:function(t){if(3===t.length){var e=t[0],n=t[1],r=t[2],i=e-2*n+r;if(0!==i){var o=-u(n*n-e*r),a=-e+n;return[-(o+a)/i,-(-o+a)/i]}return n!==r&&0===i?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length)return(e=t[0])!==(n=t[1])?[e/(e-n)]:[]},curvature:function(t,e,n,i){var o,a,s,c,f,m,h=y.derive(e),d=h[0],p=h[1],v=y.compute(t,d),g=y.compute(t,p),_=v.x*v.x+v.y*v.y;if(n?(o=u(l(v.y*g.z-g.y*v.z,2)+l(v.z*g.x-g.z*v.x,2)+l(v.x*g.y-g.x*v.y,2)),a=l(_+v.z*v.z,1.5)):(o=v.x*g.y-v.y*g.x,a=l(_,1.5)),0===o||0===a)return{k:0,r:0};if(f=o/a,m=a/o,!i){var x=y.curvature(t-.001,e,n,!0).k,b=y.curvature(t+.001,e,n,!0).k;c=(b-f+(f-x))/2,s=(r(b-f)+r(f-x))/2}return{k:f,r:m,dk:c,adk:s}},inflections:function(t){if(t.length<4)return[];var e=y.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,i=e[1].x*e[2].y,o=18*(-3*n+2*r+3*i-(f=e[3].x*e[2].y)),a=18*(3*n-r-3*i),s=18*(i-n);if(y.approximately(o,0)){if(!y.approximately(a,0)){var u=-s/a;if(0<=u&&u<=1)return[u]}return[]}var l=a*a-4*o*s,c=Math.sqrt(l),f=2*o;return y.approximately(f,0)?[]:[(c-a)/f,-(a+c)/f].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){var n,i,o,a,s,u=["x","y"],l=u.length;for(n=0;n<l;n++)if(o=t[i=u[n]].mid,a=e[i].mid,s=(t[i].size+e[i].size)/2,r(o-a)>=s)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){var r=t.bbox(),i=e.bbox(),o=1e5,a=n||.5;if(r.x.size+r.y.size<a&&i.x.size+i.y.size<a)return[(o*(t._t1+t._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];var s=t.split(.5),u=e.split(.5),l=[{left:s.left,right:u.left},{left:s.left,right:u.right},{left:s.right,right:u.right},{left:s.right,right:u.left}];l=l.filter((function(t){return y.bboxoverlap(t.left.bbox(),t.right.bbox())}));var c=[];return 0===l.length?c:(l.forEach((function(t){c=c.concat(y.pairiteration(t.left,t.right,a))})),c=c.filter((function(t,e){return c.indexOf(t)===e})))},getccenter:function(t,e,n){var r,a=e.x-t.x,u=e.y-t.y,l=n.x-e.x,c=n.y-e.y,f=a*i(h)-u*o(h),d=a*o(h)+u*i(h),p=l*i(h)-c*o(h),v=l*o(h)+c*i(h),g=(t.x+e.x)/2,_=(t.y+e.y)/2,x=(e.x+n.x)/2,b=(e.y+n.y)/2,w=g+f,A=_+d,C=x+p,T=b+v,I=y.lli8(g,_,w,A,x,b,C,T),P=y.dist(I,t),S=s(t.y-I.y,t.x-I.x),E=s(e.y-I.y,e.x-I.x),L=s(n.y-I.y,n.x-I.x);return S<L?((S>E||E>L)&&(S+=m),S>L&&(r=L,L=S,S=r)):L<E&&E<S?(r=L,L=S,S=r):L+=m,I.s=S,I.e=L,I.r=P,I},numberSort:function(t,e){return t-e}},t.exports=y},function(t,e,n){var r,i;r=n(2),(i=function(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}).prototype={valueOf:function(){return this.toString()},toString:function(){return"["+this.curves.map((function(t){return r.pointsToString(t.points)})).join(", ")+"]"},addCurve:function(t){this.curves.push(t),this._3d=this._3d||t._3d},length:function(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))},curve:function(t){return this.curves[t]},bbox:function(){for(var t=this.curves,e=t[0].bbox(),n=1;n<t.length;n++)r.expandbox(e,t[n].bbox());return e},offset:function(t){var e=[];return this.curves.forEach((function(n){e=e.concat(n.offset(t))})),new i(e)}},t.exports=i},function(t,e,n){var r=n(5),i={x:!1,y:!1};function o(t,e,n){if("Z"!==e){if("M"!==e){var r=[!1,i.x,i.y].concat(n),o=new(t.bind.apply(t,r)),a=n.slice(-2);return i={x:a[0],y:a[1]},o}i={x:n[0],y:n[1]}}}t.exports=function(t,e){for(var n,i,a=r(e).split(" "),s=new RegExp("[MLCQZ]",""),u=[],l={C:6,Q:4,L:2,M:2};a.length;)n=a.splice(0,1)[0],s.test(n)&&(i=o(t,n,a.splice(0,l[n]).map(parseFloat)))&&u.push(i);return new t.PolyBezier(u)}},function(t,e){t.exports=function(t){var e,n,r,i,o,a,s=(t=t.replace(/,/g," ").replace(/-/g," - ").replace(/-\s+/g,"-").replace(/([a-zA-Z])/g," $1 ")).replace(/([a-zA-Z])\s?/g,"|$1").split("|"),u=s.length,l=[],c=0,f=0,m=0,h=0,d=0,p=0,v=0,y=0,g="";for(e=1;e<u;e++)if(i=(r=(n=s[e]).substring(0,1)).toLowerCase(),o=(l=(l=n.replace(r,"").trim().split(" ")).filter((function(t){return""!==t})).map(parseFloat)).length,"m"===i){if(g+="M ","m"===r?(m+=l[0],h+=l[1]):(m=l[0],h=l[1]),c=m,f=h,g+=m+" "+h+" ",o>2)for(a=0;a<o;a+=2)"m"===r?(m+=l[a],h+=l[a+1]):(m=l[a],h=l[a+1]),g+=["L",m,h,""].join(" ")}else if("l"===i)for(a=0;a<o;a+=2)"l"===r?(m+=l[a],h+=l[a+1]):(m=l[a],h=l[a+1]),g+=["L",m,h,""].join(" ");else if("h"===i)for(a=0;a<o;a++)"h"===r?m+=l[a]:m=l[a],g+=["L",m,h,""].join(" ");else if("v"===i)for(a=0;a<o;a++)"v"===r?h+=l[a]:h=l[a],g+=["L",m,h,""].join(" ");else if("q"===i)for(a=0;a<o;a+=4)"q"===r?(d=m+l[a],p=h+l[a+1],m+=l[a+2],h+=l[a+3]):(d=l[a],p=l[a+1],m=l[a+2],h=l[a+3]),g+=["Q",d,p,m,h,""].join(" ");else if("t"===i)for(a=0;a<o;a+=2)d=m+(m-d),p=h+(h-p),"t"===r?(m+=l[a],h+=l[a+1]):(m=l[a],h=l[a+1]),g+=["Q",d,p,m,h,""].join(" ");else if("c"===i)for(a=0;a<o;a+=6)"c"===r?(d=m+l[a],p=h+l[a+1],v=m+l[a+2],y=h+l[a+3],m+=l[a+4],h+=l[a+5]):(d=l[a],p=l[a+1],v=l[a+2],y=l[a+3],m=l[a+4],h=l[a+5]),g+=["C",d,p,v,y,m,h,""].join(" ");else if("s"===i)for(a=0;a<o;a+=4)d=m+(m-v),p=h+(h-y),"s"===r?(v=m+l[a],y=h+l[a+1],m+=l[a+2],h+=l[a+3]):(v=l[a],y=l[a+1],m=l[a+2],h=l[a+3]),g+=["C",d,p,v,y,m,h,""].join(" ");else"z"===i&&(g+="Z ",m=c,h=f);return g.trim()}}]),li="#define GLSLIFY 1\nattribute vec4 position;attribute vec2 texcoord;attribute vec3 pointA;attribute vec3 pointB;attribute vec3 startColor;attribute vec3 endColor;attribute vec2 width;attribute float inst;attribute float shouldDraw;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;uniform vec2 u_resolution;uniform float u_segments;varying vec3 v_color;varying float v_alpha;varying float v_draw;float when_lt(float x,float y){return max(sign(y-x),0.0);}void main(){float rel_inst=inst+position.z;float width=mix(width.x,width.y,rel_inst);vec4 clip0=u_worldViewProjection*u_model*vec4(pointA,1.0);vec4 clip1=u_worldViewProjection*u_model*vec4(pointB,1.0);vec2 screen0=u_resolution*(0.5*clip0.xy/clip0.w+0.5);vec2 screen1=u_resolution*(0.5*clip1.xy/clip1.w+0.5);vec2 xBasis=normalize(screen1-screen0);vec2 yBasis=vec2(-xBasis.y,xBasis.x);vec2 pt0=screen0+width*(position.x*xBasis+position.y*yBasis);vec2 pt1=screen1+width*(position.x*xBasis+position.y*yBasis);vec2 pt=mix(pt0,pt1,position.z);vec4 clip=mix(clip0,clip1,position.z);gl_Position=vec4(clip.w*(2.0*pt/u_resolution-1.0),clip.z,clip.w)*when_lt(inst,u_segments);gl_PointSize=16.0;v_alpha=rel_inst/u_segments;v_color=mix(startColor,endColor,rel_inst/u_segments);v_draw=shouldDraw;}",ci="precision mediump float;\n#define GLSLIFY 1\nuniform float u_time;varying vec3 v_color;varying float v_alpha;varying float v_draw;void main(){if(v_alpha>v_draw){discard;}gl_FragColor=vec4(v_color,1.0);}",fi=function(t){u(r,t);var e=h(r);function r(t){var i,a;n(this,r),o(f(a=e.call(this,t)),"numInstances",1e4),o(f(a),"init",(function(t){a.geometry.init(t),a._hasGeometry=!0,a.material.init(t),a.material.texturesLoaded=!0,a.vertexArrayInfo=cn(t,a.material.programInfo,a.geometry.bufferInfo)})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix})),o(f(a),"draw",(function(t){a.isReady&&(t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.vertexArrayInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElementsInstanced(t.TRIANGLE_FAN,a.vertexArrayInfo.numElements,t.UNSIGNED_SHORT,0,3*a.segments-1),t.bindVertexArray(null))})),o(f(a),"rayCastFrom",(function(){return!1})),o(f(a),"hitTest",(function(){return!1})),o(f(a),"onSelectionCB",(function(t){return t})),o(f(a),"onSelection",(function(t,e){var n=a.getNearest(t,e);return n=a.onSelectionCB(n)})),t&&void 0!==t.numInstances&&(a.numInstances=t.numInstances);var s={vertex:li,fragment:ci};a.material=new Zn(s),a.material.uniforms={},a.geometry=new Cr;var u=[0,-.5,0,0,-.5,1,0,.5,1,0,-.5,0,0,.5,1,0,.5,0],c=Array.from(Array(101).keys());c.forEach((function(t){c.push(t)})),c.forEach((function(t){c.push(t)}));for(var m=Array.from(Array(3).keys()),h=0;h<15;h+=1){var p=Math.PI/2+(h+0)*Math.PI/15,y=Math.PI/2+(h+1)*Math.PI/15;u.push.apply(u,[0,0,0]),u.push.apply(u,[.5*Math.cos(p),.5*Math.sin(p),0]),u.push.apply(u,[.5*Math.cos(y),.5*Math.sin(y),0])}for(var g=0;g<15;g+=1){var _=3*Math.PI/2+(g+0)*Math.PI/15,x=3*Math.PI/2+(g+1)*Math.PI/15;u.push.apply(u,[0,0,1]),u.push.apply(u,[.5*Math.cos(_),.5*Math.sin(_),1]),u.push.apply(u,[.5*Math.cos(x),.5*Math.sin(x),1])}var b=[].concat(v(Lr.worldFromLatLon(41,-111,.001)),v(Lr.worldFromLatLon(20,-50,1)),v(Lr.worldFromLatLon(0,0,.001)));a.segments=100;var w=new ui(b).getLUT(a.segments+1),A=[];w.forEach((function(t){A.push.apply(A,v(Object.values(t)))}));new ui([-1,0,0,-2,0,-2,0,0,-1]).getLUT(a.segments+1).forEach((function(t){A.push.apply(A,v(Object.values(t)))}));return new ui([-1,1,-1,-2,0,-2,0,-1,-1]).getLUT(a.segments+1).forEach((function(t){A.push.apply(A,v(Object.values(t)))})),a.geometry.vertices.position={numComponents:3,data:u,divisor:0},a.geometry.vertices.pointA={numComponents:3,data:A,divisor:1,offset:0*Float32Array.BYTES_PER_ELEMENT},a.geometry.vertices.pointB={numComponents:3,data:A,divisor:1,offset:3*Float32Array.BYTES_PER_ELEMENT},a.geometry.vertices.inst={numComponents:1,data:c,divisor:1},a.geometry.vertices.arc={numComponents:1,data:m,divisor:101},a.geometry.vertices.indices={numComponents:1,data:Array.from(Array(96).keys()),divisor:0},a}return r}(Hr),mi=function(t){u(r,t);var e=h(r);function r(t){var i,a;n(this,r),o(f(a=e.call(this,t)),"numInstances",1e4),o(f(a),"segments",30),o(f(a),"capResolution",6),o(f(a),"_arcCount",0),o(f(a),"_tweens",[]),o(f(a),"init",(function(t){a.geometry.init(t),a._hasGeometry=!0,a.material.init(t),a.material.texturesLoaded=!0,a.vertexArrayInfo=cn(t,a.material.programInfo,a.geometry.bufferInfo)})),o(f(a),"createRandomArcs",(function(t){for(var e=0;e<t;e+=1){var n={from:[180*Math.random()-90,360*Math.random()-180],to:[180*Math.random()-90,360*Math.random()-180]};a.addArc(n)}})),o(f(a),"addArc",(function(t,e,n){var r=[],i={from:t.from,to:t.to,normalFactor:1,alt:.5,startColor:"#ff0000",endColor:"#00ff00",startWidth:4,endWidth:4,shouldDraw:1,arcNumber:a._arcCount};void 0!==a.transform&&(i=a.transform(t,i)),r.push.apply(r,v(a._createArcFrom(i)));var o=Array.from(Array(1).keys()),s=a._createInstArray(1),u=Lr.hexToRGB(i.startColor),l=Lr.hexToRGB(i.endColor),c=[i.startWidth,i.endWidth];if(void 0!==e){i.shouldDraw=0;var f=a._arcCount,m=new Mr(0,1,e,{onUpdate:function(t){a.geometry.updateGeometry({shouldDraw:{data:[t]}},f)},onComplete:function(){n&&n()}});a._tweens.push(m)}var h=[i.shouldDraw],d={pointA:{data:new Float32Array(r)},pointB:{data:r},inst:{data:s},arc:{data:o},startColor:{data:u},endColor:{data:l},width:{data:c},shouldDraw:{data:h}};a.geometry.updateGeometry(d,a._arcCount),a._arcCount+=1})),o(f(a),"updateArc",(function(t,e){var n=[],r={from:t.from,to:t.to,normalFactor:1,alt:.5,startColor:"#ff0000",endColor:"#00ff00",startWidth:4,endWidth:4,shouldDraw:1,arcNumber:a._arcCount};r=a.transform(t,r),n.push.apply(n,v(a._createArcFrom(r)));var i=Array.from(Array(1).keys()),o=a._createInstArray(1),s=Lr.hexToRGB(r.startColor),u=Lr.hexToRGB(r.endColor),l=[r.startWidth,r.endWidth],c=[r.shouldDraw],f={pointA:{data:new Float32Array(n)},pointB:{data:n},inst:{data:o},arc:{data:i},startColor:{data:s},endColor:{data:u},width:{data:l},shouldDraw:{data:c}};a.geometry.updateGeometry(f,e)})),o(f(a),"_createArcFrom",(function(t){var e=a._computeControlPoints(t),n=new ui(e.cp0),r=new ui(e.cp1),i=n.getLUT(a._pointsPerArcHalf),o=r.getLUT(a._pointsPerArcHalf),s=[];i.reverse().forEach((function(t){s.push(t)})),o.forEach((function(t){s.push(t)})),s.splice(a._pointsPerArcHalf,1);var u=[];return s.forEach((function(t){u.push.apply(u,v(Object.values(t)))})),u})),o(f(a),"_computeControlPoints",(function(t){var e=Lr.worldFromLatLon(t.from[0],t.from[1],.005),n=Lr.worldFromLatLon(t.to[0],t.to[1],.005),r=In();Rn(r,e,n,.5);var i=Lr.latLonFromWorld(r),o=Lr.worldFromLatLon(i.lat,i.lon,t.alt),a=In();En(a,e,r),Ln(a,a,t.normalFactor);var s=In();Sn(s,o,a);var u=In();En(u,o,a);var l=[];l.push.apply(l,v(o)),l.push.apply(l,v(s)),l.push.apply(l,v(e));var c=[];return c.push.apply(c,v(o)),c.push.apply(c,v(u)),c.push.apply(c,v(n)),{cp0:l,cp1:c}})),o(f(a),"_createInstArray",(function(t){for(var e=Array.from(Array(a.segments+1).keys()),n=[],r=0;r<t;r+=1)e.forEach((function(t){n.push(t)}));return n})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix,a.material.uniforms.u_time=n,a.geometry.isDirty&&a.geometry.updateBuffers(t)})),o(f(a),"draw",(function(t){!a.isReady||a._arcCount<=0||(t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.vertexArrayInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElementsInstanced(t.TRIANGLE_FAN,a.vertexArrayInfo.numElements,t.UNSIGNED_SHORT,0,(a.segments+1)*a._arcCount),t.bindVertexArray(null))})),o(f(a),"rayCastFrom",(function(){return!1})),o(f(a),"hitTest",(function(){return!1})),o(f(a),"onSelectionCB",(function(t){return t})),o(f(a),"onSelection",(function(t,e){var n=a.getNearest(t,e);return n=a.onSelectionCB(n)})),t&&(void 0!==t.numInstances&&(a.numInstances=t.numInstances),void 0!==t.segments&&(a.segments=t.segments),void 0!==t.transform&&(a.transform=t.transform)),a._pointsPerArcHalf=a.segments/2+1;var s={vertex:li,fragment:ci};a.material=new Zn(s),a.material.uniforms={u_segments:a.segments},a.geometry=new Cr;for(var u=[0,-.5,0,0,-.5,1,0,.5,1,0,-.5,0,0,.5,1,0,.5,0],c=0;c<a.capResolution;c+=1){var m=Math.PI/2+(c+0)*Math.PI/a.capResolution,h=Math.PI/2+(c+1)*Math.PI/a.capResolution;u.push.apply(u,[0,0,0]),u.push.apply(u,[.5*Math.cos(m),.5*Math.sin(m),0]),u.push.apply(u,[.5*Math.cos(h),.5*Math.sin(h),0])}for(var p=0;p<a.capResolution;p+=1){var y=3*Math.PI/2+(p+0)*Math.PI/a.capResolution,g=3*Math.PI/2+(p+1)*Math.PI/a.capResolution;u.push.apply(u,[0,0,1]),u.push.apply(u,[.5*Math.cos(y),.5*Math.sin(y),1]),u.push.apply(u,[.5*Math.cos(g),.5*Math.sin(g),1])}var _=Array.from(Array(2*a._pointsPerArcHalf*a.numInstances)).fill(0);return a.geometry.vertices.position={numComponents:3,data:u,divisor:0},a.geometry.vertices.pointA={numComponents:3,data:_,divisor:1,offset:0*Float32Array.BYTES_PER_ELEMENT,perInstance:3*(a.segments+1)},a.geometry.vertices.pointB={numComponents:3,data:_,divisor:1,offset:3*Float32Array.BYTES_PER_ELEMENT,perInstance:3*(a.segments+1)},a.geometry.vertices.inst={numComponents:1,data:[],divisor:1,perInstance:a.segments+1},a.geometry.vertices.arc={numComponents:1,data:[],divisor:a.segments,perInstance:1},a.geometry.vertices.startColor={numComponents:3,data:[],divisor:a.segments+1,perInstance:3,drawType:"DYNAMIC_DRAW"},a.geometry.vertices.endColor={numComponents:3,data:[],divisor:a.segments+1,perInstance:3,drawType:"DYNAMIC_DRAW"},a.geometry.vertices.width={numComponents:2,data:[],divisor:a.segments+1,perInstance:2,drawType:"DYNAMIC_DRAW"},a.geometry.vertices.shouldDraw={numComponents:1,data:[],divisor:a.segments+1,perInstance:1,drawType:"DYNAMIC_DRAW"},a.geometry.vertices.indices={numComponents:1,data:Array.from(Array(6+3*a.capResolution*2).keys()),divisor:0},a}return r}(Hr),hi={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec3 normal;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;varying vec2 vTexture;void main(){vec4 pos=u_worldViewProjection*u_model*position;vTexture=texcoord;gl_Position=pos;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D uTexture;varying vec2 vTexture;void main(){vec4 textureColor=texture2D(uTexture,vTexture);gl_FragColor=vec4(textureColor.rgb,1.0);}"},di={},pi=function(t){u(r,t);var e=h(r);function r(t){var i,a;return n(this,r),o(f(a=e.call(this)),"material",null),o(f(a),"init",(function(t,e){a.geometry=new Cr,a.geometry.vertices=Qt.createSphereVertices(50,128,128),a.geometry.init(t);var n={surface:{src:a.textureSrc.surface,minMag:t.NEAREST}};a.material.init(t),a.material.loadTextures(t,n,(function(){a.material.uniforms.uTexture=a.material.textures.surface,e&&e()})),a.material.uniforms.uModelMatrix=a.modelMatrix})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"rayCastFrom",(function(){return!1})),o(f(a),"hitTest",(function(){return!1})),o(f(a),"onSelection",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix})),o(f(a),"draw",(function(t){a.isReady&&a.shouldDraw&&(t.useProgram(a.material.programInfo.program),t.cullFace(t.FRONT),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElements(t.TRIANGLES,a.geometry.bufferInfo.numElements,t.UNSIGNED_SHORT,0),t.cullFace(t.BACK))})),a.material=new Zn(hi),a.material.uniforms=di,a.textureSrc={surface:t},a}return r}(wr),vi={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec3 normal;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;varying float vAlpha;varying vec2 vTexture;void main(){vec4 pos=u_worldViewProjection*u_model*position;vec4 transformedCamera=vec4(-0.5,1.0,-1.0,1.0)*u_worldViewProjection;vAlpha=pow((1.0+(dot(normal,normalize(transformedCamera.xyz))))/2.0,1.0);vTexture=texcoord;gl_Position=pos;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D uTexture;uniform vec2 u_offset;varying float vAlpha;varying vec2 vTexture;void main(){vec4 textureColor=texture2D(uTexture,vec2(vTexture.x-0.25+u_offset.x,vTexture.y+u_offset.y));float alpha=vAlpha+(1.0-vAlpha)*0.05;alpha*=0.9;gl_FragColor=vec4(textureColor.rgb,textureColor.r);}"},yi={u_offset:[0,0]},gi=function(t){u(r,t);var e=h(r);function r(t){var i,a;return n(this,r),o(f(a=e.call(this)),"material",null),o(f(a),"movementSpeed",[7,0]),o(f(a),"init",(function(t,e){a.geometry=new Cr("sphere"),a.geometry.init(t);var n={surface:{src:a.textureSrc.surface,minMag:t.LINEAR}};a.material.init(t),a.material.loadTextures(t,n,(function(){a.material.uniforms.uTexture=a.material.textures.surface,e&&e()})),a.material.uniforms.uModelMatrix=a.modelMatrix;a.scale=[1.04,1.04,1.04]})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"rayCastFrom",(function(){return!1})),o(f(a),"hitTest",(function(){return!1})),o(f(a),"onSelection",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix,a.material.uniforms.u_offset=[n*a.movementSpeed[0]/1e3,n*a.movementSpeed[1]/1e3]})),o(f(a),"draw",(function(t){a.isReady&&a.shouldDraw&&(t.useProgram(a.material.programInfo.program),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawElements(t.TRIANGLES,a.geometry.bufferInfo.numElements,t.UNSIGNED_SHORT,0))})),a.material=new Zn(vi),a.material.uniforms=yi,a.textureSrc={surface:t},a}return r}(wr),_i={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute vec3 normal;attribute vec2 texcoord;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;varying vec2 vTexture;varying float vAlpha;void main(){vec4 pos=u_worldViewProjection*u_model*position;gl_PointSize=10.0;vec3 transformedNormal=(u_worldViewProjection*u_model*vec4(normal,1.0)).xyz;vec4 transformedCamera=vec4(1.0,1.0,-1.0,1.0)*u_worldViewProjection;vAlpha=pow(dot(position.xyz,normalize(u_cameraPos)),0.2);vTexture=texcoord.xy;gl_Position=pos;}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_surface;varying vec2 vTexture;varying float vAlpha;void main(){vec3 surfaceColor=texture2D(u_surface,vec2(vTexture.x,1.0-vTexture.y)).rgb;float alpha=clamp(vAlpha,0.1,1.0);vec3 color=surfaceColor*alpha;gl_FragColor=vec4(color,1.0);}"},xi={},bi=function(t){u(r,t);var e=h(r);function r(t,i){var a,s;n(this,r),o(f(s=e.call(this)),"material",null),o(f(s),"lookup",null),o(f(s),"currentSelection",-1),o(f(s),"previousSelection",-1),o(f(s),"inAnimation",null),o(f(s),"outAnimation",null),o(f(s),"selection0",236),o(f(s),"selection1",144),o(f(s),"current",236),o(f(s),"dataTexture",void 0),o(f(s),"dataTextureSize",16),o(f(s),"updateCMDs",[]),o(f(s),"highlightAnimationProps",{start:0,stop:1,duration:1e3,onUpdate:function(t){s.material.uniforms.u_animateIn=t}}),o(f(s),"init",(function(t,e){s.geometry.init(t);var n={surface:{src:s.textureSrc.surface,minMag:t.LINEAR}};s.material.init(t),s.material.uniforms.uModelMatrix=s.modelMatrix,s.material.loadTextures(t,n,(function(){s.material.uniforms.u_surface=s.material.textures.surface,e&&e()}))})),o(f(s),"getValueForId",(function(t){return s.lookup.getFromId(t)})),o(f(s),"getValueForCode",(function(t){return s.lookup.getFromCode(t)})),o(f(s),"getValueForName",(function(t){return s.lookup.getFromName(t)})),o(f(s),"createCollisionGeo",(function(){s.collisionGeometry&&s.collisionGeometry instanceof _r||(s.collisionGeometry=gr.create_collision_geometry(s.geometry.vertices.position.data,s.geometry.vertices.texcoord.data,s.geometry.vertices.indices.data))})),o(f(s),"rayCastFrom",(function(t){return s.collisionGeometry.raycast(t.origin,t.direction)})),o(f(s),"hitTest",(function(t){return s.collisionGeometry.hitTest(t.origin,t.direction)})),o(f(s),"onSelectionCB",(function(){})),o(f(s),"onSelection",(function(){})),o(f(s),"onHover",(function(){})),o(f(s),"update",(function(t,e,n){d((a=f(s),l(r.prototype)),"update",a).call(a,e,n),s.material.uniforms.u_model=s.modelMatrix,s.updateCMDs.forEach((function(e){e(t)})),s.updateCMDs=[]})),o(f(s),"draw",(function(t){s.isReady&&s.shouldDraw&&(t.useProgram(s.material.programInfo.program),un(t,s.material.programInfo,s.geometry.bufferInfo),sn(s.material.programInfo,s.material.uniforms),t.drawElements(t.TRIANGLES,s.geometry.bufferInfo.numElements,t.UNSIGNED_INT,0))})),o(f(s),"setCountryHover",(function(){})),o(f(s),"setHighlightId",(function(t){s.previousSelection=s.currentSelection,s.currentSelection=t;var e=s.inAnimation?s.inAnimation.currentValue():1,n=300*e;s.animateIn(s.currentSelection,500),s.animateOut(s.previousSelection,n,e)})),o(f(s),"animateIn",(function(t,e,n){s.material.uniforms.u_idAnimateIn=t,s.inAnimation&&s.inAnimation.stop(),s.material.uniforms.u_animateIn=0,s.inAnimation=new Mr(s.highlightAnimationProps.start,s.highlightAnimationProps.stop,s.highlightAnimationProps.duration,{onUpdate:s.highlightAnimationProps.onUpdate,onComplete:function(){n&&n()}})})),o(f(s),"animateOut",(function(t,e,n,r){s.material.uniforms.u_idAnimateOut=t,s.outAnimation&&s.outAnimation.stop(),s.material.uniforms.u_animateOut=n,s.outAnimation=new Mr(n,0,e,{onUpdate:function(t){s.material.uniforms.u_animateOut=t},onComplete:function(){r&&r()}})})),o(f(s),"addDataset",(function(t){s.lookup=new Er(t,s.textureSrc.id)})),o(f(s),"updateIdState",(function(){})),s.textureSrc={surface:t.surface},s.material=new Zn(_i),s.material.uniforms=xi,s.geometry=new Cr;var u=0,c=new Float32Array(i),m=new Int32Array(i),h=c.subarray(u,u+288e3);u+=288e3;var p=c.subarray(u,u+288e3);u+=288e3;var v=c.subarray(u,u+288e3);u+=288e3;var y=m.subarray(u,u+96e3);return s.geometry.vertices.position={numComponents:3,data:h},s.geometry.vertices.normal={numComponents:3,data:p},s.geometry.vertices.texcoord={numComponents:3,data:v},s.geometry.vertices.indices={numComponents:3,data:y},s}return r}(Ar),wi={vertex:"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 texture;attribute vec3 tangentU;attribute vec3 tangentV;attribute vec2 textureG;attribute float random;uniform mat4 u_model;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform vec3 u_cameraPos;uniform float uPointSize;uniform float uRandomPointSizeDelta;uniform float uRandomPointSizeRatio;uniform float uMinPointAlpha;uniform float uMinPointSize;uniform float u_time;uniform float u_speed;uniform vec2 uOffset;uniform vec3 uRippleCenter;uniform float uRippleProgress;uniform float uRippleWidth;uniform float uRippleHeight;varying vec2 vTexture;varying vec4 vColor;varying float vShine;varying vec2 vTextureG;varying float vTime;varying float vAlpha;mat4 rotationMatrix(vec3 axis,float angle){axis=normalize(axis);float s=sin(angle);float c=cos(angle);float oc=1.0-c;return mat4(oc*axis.x*axis.x+c,oc*axis.x*axis.y-axis.z*s,oc*axis.z*axis.x+axis.y*s,0.0,oc*axis.x*axis.y+axis.z*s,oc*axis.y*axis.y+c,oc*axis.y*axis.z-axis.x*s,0.0,oc*axis.z*axis.x-axis.y*s,oc*axis.y*axis.z+axis.x*s,oc*axis.z*axis.z+c,0.0,0.0,0.0,0.0,1.0);}void main(){vec4 pos=vec4(position,1.0);gl_PointSize=10.0;mat4 rot1=rotationMatrix(tangentU,(texture.x*2.0)-1.0);vec4 pos1=rot1*pos;mat4 rot2=rotationMatrix(tangentV,((texture.y*2.0)-1.0));vec4 pos2=rot2*pos;float rotSizeDelta=max((dot(normalize(u_cameraPos),position)+1.0)/2.0,uMinPointSize);float randomSize=uRandomPointSizeDelta*random*step(random,1.0-uRandomPointSizeRatio);pos.xyz+=pos1.xyz*(uPointSize+randomSize);pos.xyz+=pos2.xyz*(uPointSize+randomSize);vec3 rippleCenter=vec3(0.0,0.0,1.0);float d=1.0-((dot(pos.xyz,uRippleCenter)+1.0)/2.0);float q=smoothstep(uRippleProgress-uRippleWidth,uRippleProgress,d);q-=smoothstep(uRippleProgress,uRippleProgress+uRippleWidth,d);float t=1.0+q*uRippleHeight;pos.xyz*=t;gl_Position=u_worldViewProjection*u_model*pos;gl_Position.xy+=uOffset*gl_Position.w;float c=t/1.04;vTexture=texture;vTextureG=textureG;vShine=q;vTime=(u_time/100.0)*u_speed;vAlpha=max((dot(normalize(u_cameraPos),position)+1.0)/2.0,uMinPointAlpha);}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform vec3 uLeftColorCurrent;uniform vec3 uLeftColorTarget;uniform vec3 uRightColor;uniform float uColorChangeAnimation;uniform vec2 uResolution;uniform float uSeed;uniform float uScale;uniform vec3 uColor;uniform vec3 uRippleColor;uniform vec4 uCardMargin;uniform sampler2D uNoiseTexture;varying vec2 vTexture;varying vec2 vTextureG;varying vec4 vColor;varying float vShine;varying float vTime;varying float vAlpha;void main(){vec4 noiseColor=texture2D(uNoiseTexture,vec2(vTextureG.x+fract(vTime),vTextureG.y));float d=1.0-smoothstep(0.45,0.5,distance(vec2(0.5,0.5),vTexture));vec3 color=mix(uColor,uRippleColor,vShine);float alpha=vAlpha*d*pow(noiseColor.r,2.5);gl_FragColor=vec4(color,alpha);}"},Ai={uPointSize:.005,uRandomPointSizeDelta:0,uRandomPointSizeRatio:0,uMinPointAlpha:0,uMinPointSize:1,uOffset:[0,0],uRippleCenter:[0,0,1],uRippleProgress:-2,uRippleWidth:.2,uRippleHeight:.1,uRippleColor:[1,1,1],uColor:[1,1,1],u_speed:10},Ci=function(t){u(r,t);var e=h(r);function r(t,i,a){var s,u;n(this,r),o(f(u=e.call(this)),"material",null),o(f(u),"lookup",null),o(f(u),"currentSelection",-1),o(f(u),"previousSelection",-1),o(f(u),"inAnimation",null),o(f(u),"outAnimation",null),o(f(u),"dataTexture",void 0),o(f(u),"dataTextureSize",16),o(f(u),"updateCMDs",[]),o(f(u),"highlightAnimationProps",{start:0,stop:1,duration:1e3,onUpdate:function(t){u.material.uniforms.u_animateIn=t}}),o(f(u),"init",(function(t,e){u.geometry.init(t);var n={noise:{src:u.textureSrc.noise,minMag:t.LINEAR}};u.material.init(t),u.material.uniforms.uModelMatrix=u.modelMatrix,u.material.loadTextures(t,n,(function(){u.material.uniforms.uNoiseTexture=u.material.textures.noise,e&&e()}))})),o(f(u),"getValueForId",(function(t){return u.lookup.getFromId(t)})),o(f(u),"getValueForCode",(function(t){return u.lookup.getFromCode(t)})),o(f(u),"getValueForName",(function(t){return u.lookup.getFromName(t)})),o(f(u),"setIdColor",(function(t,e,n){var r=void 0===n?1:n,i=Lr.hexToRGBA(e,r,!1);u.updateCMDs.push((function(e){u.dataTexture.updatePixelId(e,i,t)}))})),o(f(u),"createCollisionGeo",(function(){if(!(u.collisionGeometry&&u.collisionGeometry instanceof _r)){var t=Qt.createSphereVertices(1,128,128);u.collisionGeometry=gr.create_collision_geometry(t.position,t.texcoord,t.indices)}})),o(f(u),"rayCastFrom",(function(t){return u.collisionGeometry.raycast(t.origin,t.direction)})),o(f(u),"hitTest",(function(t){return u.collisionGeometry.hitTest(t.origin,t.direction)})),o(f(u),"onSelectionCB",(function(){})),o(f(u),"onSelection",(function(t,e,n){var r=Lr.latLonFromWorld(n.point);return console.log(r,n),{lat:t,lon:e}})),o(f(u),"onHover",(function(){})),o(f(u),"update",(function(t,e,n){d((s=f(u),l(r.prototype)),"update",s).call(s,e,n),u.material.uniforms.u_model=u.modelMatrix,u.material.uniforms.u_time=n,u.updateCMDs.forEach((function(e){e(t)})),u.updateCMDs=[]})),o(f(u),"draw",(function(t){u.isReady&&u.shouldDraw&&(t.useProgram(u.material.programInfo.program),t.disable(t.CULL_FACE),un(t,u.material.programInfo,u.geometry.bufferInfo),sn(u.material.programInfo,u.material.uniforms),t.drawElements(t.TRIANGLES,u.geometry.bufferInfo.numElements,t.UNSIGNED_INT,0),t.enable(t.CULL_FACE))})),o(f(u),"setCountryHover",(function(t){})),o(f(u),"setHighlightId",(function(t){u.previousSelection=u.currentSelection,u.currentSelection=t;var e=u.inAnimation?u.inAnimation.currentValue():1,n=300*e;u.animateIn(u.currentSelection,500),u.animateOut(u.previousSelection,n,e)})),o(f(u),"animateIn",(function(t,e){u.material.uniforms.u_idAnimateIn=t,u.inAnimation&&u.inAnimation.stop(),u.material.uniforms.u_animateIn=0,u.inAnimation=new Mr(u.highlightAnimationProps.start,u.highlightAnimationProps.stop,u.highlightAnimationProps.duration,{onUpdate:u.highlightAnimationProps.onUpdate,onComplete:function(){e&&e()}})})),o(f(u),"animateOut",(function(t,e,n,r){u.material.uniforms.u_idAnimateOut=t,u.outAnimation&&u.outAnimation.stop(),u.material.uniforms.u_animateOut=n,u.outAnimation=new Mr(n,0,e,{onUpdate:function(t){u.material.uniforms.u_animateOut=t},onComplete:function(){r&&r()}})})),o(f(u),"addDataset",(function(t){u.lookup=new Er(t,u.textureSrc.id)})),o(f(u),"rippleAtLocation",(function(t,e,n){u._ripple instanceof Mr&&u._ripple.stop(),u.material.uniforms.uRippleCenter=Lr.worldFromLatLon(t,e,0);var r=2e3;n&&(n.width&&(u.material.uniforms.uRippleWidth=n.width),n.height&&(u.material.uniforms.uRippleHeight=n.height),n.speed&&(u.material.uniforms.u_speed=n.speed),n.rippleColor&&(u.material.uniforms.uRippleColor=n.rippleColor),n.duration&&(r=n.duration));var i=0-u.material.uniforms.uRippleWidth,o=1+u.material.uniforms.uRippleWidth;u._ripple=new Mr(i,o,r,{onUpdate:function(t){u.material.uniforms.uRippleProgress=t}})})),u.textureSrc={noise:t.noise},u.material=new Zn(wi),u.material.uniforms=Ai,u.geometry=new Cr;var c=0,m=new Float32Array(i),h=new Int32Array(i),p=m.subarray(c,c+114192);c+=114192;var v=m.subarray(c,c+114192);c+=114192;var y=m.subarray(c,c+114192);c+=114192;var g=m.subarray(c,c+76128);c+=76128;var _=m.subarray(c,c+76128);c+=76128;var x=m.subarray(c,c+38064);c+=38064;var b=h.subarray(c,c+57096);return u.geometry.vertices.position={numComponents:3,data:p},u.geometry.vertices.tangentU={numComponents:3,data:v},u.geometry.vertices.tangentV={numComponents:3,data:y},u.geometry.vertices.texture={numComponents:2,data:g},u.geometry.vertices.textureG={numComponents:2,data:_},u.geometry.vertices.random={numComponents:1,data:x},u.geometry.vertices.indices={numComponents:3,data:b},a&&(a.pointSize&&(u.material.uniforms.uPointSize=a.pointSize),a.randomPointSizeVariance&&(u.material.uniforms.uRandomPointSizeDelta=a.randomPointSizeVariance),a.randomPointSizeRatio&&(u.material.uniforms.uRandomPointSizeRatio=a.randomPointSizeRatio),a.minPointAlpha&&(u.material.uniforms.uMinPointAlpha=a.minPointAlpha),a.minPointSize&&(u.material.uniforms.uMinPointSize=a.minPointSize),a.offset&&(u.material.uniforms.uOffset=a.offset),a.color&&(u.material.uniforms.uColor=Lr.hexToRGB(a.color))),u}return r}(Ar),Ti={u_animation:1,u_startsize:4,u_midsize:16,u_endsize:4,u_startColor:[1,1,1,.4],u_midColor:[1,1,1,1],u_endColor:[1,1,1,.4]},Ii=function(t){u(r,t);var e=h(r);function r(t){var i,a;n(this,r),o(f(a=e.call(this,t)),"datastore",void 0),o(f(a),"maxSelectionDistance",300),o(f(a),"maxSelectionCount",1),o(f(a),"maxDataPoints",10),o(f(a),"_segments",600),o(f(a),"_pointsPerArcHalf",300),o(f(a),"_tweens",[]),o(f(a),"dataPointCount",0),o(f(a),"_resourceLoaded",!1),o(f(a),"_isDirty",!0),o(f(a),"_hasGeometry",!1),o(f(a),"useTexture",!1),o(f(a),"createEmptyVertices",(function(){a.geometry.vertices.position={numComponents:3,data:new Array(a._segments).fill(0),perInstance:3},a.geometry.vertices.inst={numComponents:1,data:new Array(a._segments).fill(0),perInstance:1},a.geometry.vertices.indices={numComponents:1,data:Array.from(Array(a._segments).keys()),perInstance:1}})),o(f(a),"addArc",(function(t,e,n){var r=[],i={from:t.from,to:t.to,normalFactor:t.normalFactor||.5,alt:t.alt||.3,startColor:t.startColor||"#ffffff",midColor:t.midColor||"#ffffff",endColor:t.endColor||"#ffffff",startAlpha:t.startAlpha||0,midAlpha:t.midAlpha||1,endAlpha:t.endAlpha||0,startWidth:t.startWidth||4,midWidth:t.midWidth||4,endWidth:t.endWidth||4},o=(Lr.dotBetweenLatLon(t.from,t.to)+1)/2;void 0!==a.transform&&(i=a.transform(t,i)),i.alt=.1+(1-o)*i.alt,a.material.uniforms.u_startsize=i.startWidth,a.material.uniforms.u_midsize=i.midWidth,a.material.uniforms.u_endsize=i.endWidth,a.material.uniforms.u_startColor=Lr.hexToRGBA(i.startColor,i.startAlpha),a.material.uniforms.u_midColor=Lr.hexToRGBA(i.midColor,i.midAlpha),a.material.uniforms.u_endColor=Lr.hexToRGBA(i.endColor,i.endAlpha),r.push.apply(r,v(a._createArcFrom(i)));var s=Array.from(Array(a._segments).keys());if(void 0!==e){a.material.uniforms.u_animation=0;var u=new Mr(0,1,e,{onUpdate:function(t){a.material.uniforms.u_animation=t},onComplete:function(){n&&n()}});a._tweens.push(u)}var l={position:{data:new Float32Array(r)},inst:{data:s}};a.geometry.updateGeometry(l,0),a.shouldDraw=!0})),o(f(a),"_createArcFrom",(function(t){var e=a._computeControlPoints(t),n=new ui(e.cp0),r=new ui(e.cp1),i=n.getLUT(a._pointsPerArcHalf),o=r.getLUT(a._pointsPerArcHalf),s=[];i.reverse().forEach((function(t){s.push(t)})),o.forEach((function(t){s.push(t)})),s.splice(a._pointsPerArcHalf,1);var u=[];return s.forEach((function(t){u.push.apply(u,v(Object.values(t)))})),u})),o(f(a),"_computeControlPoints",(function(t){var e=Lr.worldFromLatLon(t.from[0],t.from[1],.005),n=Lr.worldFromLatLon(t.to[0],t.to[1],.005),r=In();Rn(r,e,n,.5);var i=Lr.latLonFromWorld(r),o=Lr.worldFromLatLon(i.lat,i.lon,t.alt),a=In();En(a,e,r),Ln(a,a,t.normalFactor);var s=In();Sn(s,o,a);var u=In();En(u,o,a);var l=[];l.push.apply(l,v(o)),l.push.apply(l,v(s)),l.push.apply(l,v(e));var c=[];return c.push.apply(c,v(o)),c.push.apply(c,v(u)),c.push.apply(c,v(n)),{cp0:l,cp1:c}})),o(f(a),"_createInstArray",(function(t){for(var e=Array.from(Array(a._segments+1).keys()),n=[],r=0;r<t;r+=1)e.forEach((function(t){n.push(t)}));return n})),o(f(a),"removeAllArcs",(function(){a.shouldDraw=!1})),o(f(a),"init",(function(t,e){if(a.geometry.init(t),a._hasGeometry=!0,a.material.init(t),a.useTexture){var n={texture:{src:a.textureSrc.texture,minMag:t.LINEAR}};a.material.loadTextures(t,n,(function(){e&&e(),a.material.uniforms.u_texture=a.material.textures.texture}))}else e&&e()})),o(f(a),"createCollisionGeo",(function(){})),o(f(a),"update",(function(t,e,n){d((i=f(a),l(r.prototype)),"update",i).call(i,e,n),a.material.uniforms.u_model=a.modelMatrix,a.geometry.needsResize&&a.geometry.reloadBuffers(t),a.geometry.isDirty&&a.geometry.updateBuffers(t)})),o(f(a),"draw",(function(t){(a.isReady||a._hasGeometry)&&a.shouldDraw&&(t.useProgram(a.material.programInfo.program),t.disable(t.DEPTH_TEST),un(t,a.material.programInfo,a.geometry.bufferInfo),sn(a.material.programInfo,a.material.uniforms),t.drawArrays(t.POINTS,0,a._segments-1),t.enable(t.DEPTH_TEST))})),o(f(a),"rayCastFrom",(function(){return!0})),o(f(a),"hitTest",(function(){return!0})),o(f(a),"onSelectionCB",(function(t){return t})),o(f(a),"onSelection",(function(){}));var s={vertex:"#define GLSLIFY 1\nattribute vec4 position;attribute float inst;uniform mat4 u_worldViewProjection;uniform mat4 u_viewInverse;uniform mat4 u_model;uniform vec3 u_cameraPos;uniform float u_startsize;uniform float u_midsize;uniform float u_endsize;uniform vec4 u_startColor;uniform vec4 u_midColor;uniform vec4 u_endColor;varying vec4 v_color;varying float v_tex;varying float v_alpha;float when_gt(float x,float y){return max(sign(x-y),0.0);}float when_lt(float x,float y){return max(sign(y-x),0.0);}float getV(vec3 x){return x.x*x.x+x.y*x.y+x.z*x.z;}void main(){v_tex=inst/600.0;float t0=v_tex*2.0;float t1=(v_tex*2.0-1.0);float firstHalfSize=mix(u_startsize,u_midsize,t0)*(1.0-step(0.5,v_tex));float secondHalfSize=mix(u_midsize,u_endsize,t1)*step(0.5,v_tex);;vec4 firstHalfColor=mix(u_startColor,u_midColor,t0)*(1.0-step(0.5,v_tex));vec4 secondHalfColor=mix(u_midColor,u_endColor,t1)*step(0.5,v_tex);vec4 pos=u_worldViewProjection*u_model*position;gl_PointSize=firstHalfSize+secondHalfSize;gl_Position=pos;v_color=firstHalfColor+secondHalfColor;v_alpha=step(0.3,(1.0+dot(normalize(u_cameraPos),normalize(position.xyz)))/2.0);}",fragment:"precision mediump float;\n#define GLSLIFY 1\nuniform float u_time;uniform float u_animation;varying vec4 v_color;varying float v_tex;varying float v_alpha;void main(){float d=distance(vec2(0.5),gl_PointCoord.xy);float c=1.0-smoothstep(0.4,0.5,d);float alpha=step(1.0-u_animation,1.0-v_tex);gl_FragColor=vec4(v_color.rgb,v_color.a*c*alpha);}"};return t&&(t.maxSelectionCount&&(a.maxSelectionCount=t.maxSelectionCount),t.maxSelectionDistance&&(a.maxSelectionDistance=t.maxSelectionDistance),t.maxDataPoints&&(a.maxDataPoints=t.maxDataPoints),!0===t.useTexture&&void 0!==t.texture&&(a.useTexture=!0,s.fragment=Xr,a.textureSrc={texture:t.texture})),a.material=new Zn(s),a.datastore=new Yr,a.material.uniforms=Ti,a.geometry=new Cr,a.shouldDraw=!1,a.createEmptyVertices(),a}return r}(Hr),Pi=function(){function t(e){var r=this;n(this,t),o(this,"drawables",[]),o(this,"element",void 0),o(this,"definition",void 0),o(this,"size",{width:0,height:0}),this.definition=e,this.element=this.createElement(),this.resizeObserver=new ResizeObserver((function(t){t.length&&(r.size=t[0].contentRect)})),this.resizeObserver.observe(this.element)}return i(t,[{key:"release",value:function(){this.resizeObserver.disconnect()}},{key:"createElement",value:function(){return document.createElement("div")}},{key:"animateIn",value:function(){}},{key:"animateOut",value:function(t){t(this)}},{key:"update",value:function(t){this.drawables.forEach((function(e){return e.update(t)}))}},{key:"setPosition",value:function(t){this.element.style.transform="translate(".concat(t.screen.x,"px, ").concat(t.screen.y,"px)")}}]),t}();t.Arc=Ii,t.Atmosphere=ii,t.Background=ei,t.Callout=Pi,t.CalloutDefinition=function t(e,r,i,a){n(this,t),o(this,"id",Math.random().toFixed(16).substr(2)),o(this,"latitude",0),o(this,"longitude",0),o(this,"altitude",0),o(this,"calloutClass",void 0),o(this,"data",void 0),this.latitude=e,this.longitude=r,this.calloutClass=i,this.data=a},t.CalloutManager=Ur,t.Camera=qn,t.Clouds=gi,t.ConstantWidthArcs=mi,t.CustomGlobe=bi,t.DataStore=Yr,t.Drawable=wr,t.GKUtils=Lr,t.Geometry=Cr,t.GlobeKitView=Vr,t.Icosphere=Pr,t.IcosphereLookup=Dr,t.Instanced=fi,t.Lookup=Er,t.Lowpoly=Qr,t.PointGlobe=Ci,t.Points=Kr,t.QuadNormal=si,t.Renderer=gn,t.Scene=Kn,t.ShaderMaterial=Zn,t.SkySphere=pi,t.Tween=Mr,Object.defineProperty(t,"__esModule",{value:!0})}));
